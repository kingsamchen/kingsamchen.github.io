<!DOCTYPE html>
<html lang="default">
  <head><meta name="generator" content="Hexo 3.9.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Gone with the ruins">













  <link rel="alternate" href="/atom.xml" title="KCçš„åºŸå¢Ÿå †">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0">



<link rel="canonical" href="http://kingsamchen.github.io/">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0">






  



  









    <title> KCçš„åºŸå¢Ÿå † </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">KCçš„åºŸå¢Ÿå †</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            é¦–é¡µ
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            å½’æ¡£
          
        </li>
      </a>
    
      <a href="/friends/">
        <li class="mobile-menu-item">
          
          
            Friends
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            å…³äº
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">KCçš„åºŸå¢Ÿå †</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              é¦–é¡µ
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              å½’æ¡£
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/friends/">
            
            
              Friends
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              å…³äº
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  <section id="posts" class="posts">
    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2020/05/04/atoi-with-overflow-handled/">atoi With Overflow Handled</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-05-04
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>leetcode ä¸Šæœ‰ä¸€é¢˜æ˜¯è®©ä½ å®ç°ä¸€ä¸ª <code>atoi()</code>ï¼Œä½†æ˜¯å› ä¸ºå‡½æ•°ç±»å‹æ˜¯ 32-bit intï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å†…éƒ¨è½¬æ¢åˆ° 64-bit intï¼Œé¿å…éœ€è¦ç›´æ¥å¤„ç†æº¢å‡ºçš„æƒ…å†µã€‚</p>
<p>å¦‚æœè¦é’ˆå¯¹ <code>int64</code> å®ç°ä¸€ä¸ª <code>atoi()</code> åˆè¯¥å¦‚ä½•åšï¼Ÿ</p>
<p>æˆ‘ç¿»äº†ä¸€ä¸‹ golang çš„æ ‡å‡†åº“æºç ï¼Œå¤§è‡´æ¢³ç†äº†ä¸€ä¸‹</p>
<p>(1) å¦‚æœå¯¹è±¡æ˜¯ <code>int32</code>ï¼Œå¹¶ä¸”è¾“å…¥å­—ç¬¦ä¸²æœ‰æ•ˆæ•°æ®é•¿åº¦å°äº10ä½ï¼Œåˆ™ä¸€å®šä¸ä¼šæº¢å‡ºï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¤„ç†</p>
<p>(2) å¦åˆ™ç»Ÿä¸€èµ° <code>int64</code> å¤„ç†ï¼›<code>int64</code> å†…éƒ¨ä¼šå…ˆå¤„ç†æ‰ç¬¦å·ä½ <code>neg</code>ï¼Œç„¶åè½¬æˆ <code>uint64</code></p>
<p>(3) æº¢å‡ºå¤„ç†çš„æ ¸å¿ƒéƒ¨åˆ†ï¼š</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cutoff is the smallest number such that cutoff*base &gt; maxUint64.</span></span><br><span class="line"><span class="comment">// Use compile-time constants for common cases.</span></span><br><span class="line"><span class="keyword">var</span> cutoff <span class="keyword">uint64</span></span><br><span class="line"><span class="keyword">switch</span> base &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">	cutoff = maxUint64/<span class="number">10</span> + <span class="number">1</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">	cutoff = maxUint64/<span class="number">16</span> + <span class="number">1</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	cutoff = maxUint64/<span class="keyword">uint64</span>(base) + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> n &gt;= cutoff &#123;</span><br><span class="line">	<span class="comment">// n*base overflows</span></span><br><span class="line">	<span class="keyword">return</span> maxVal, rangeError(fnParseUint, s0)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">maxVal := <span class="keyword">uint64</span>(<span class="number">1</span>)&lt;&lt;<span class="keyword">uint</span>(bitSize) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">n *= <span class="keyword">uint64</span>(base)</span><br><span class="line"></span><br><span class="line">n1 := n + <span class="keyword">uint64</span>(d)</span><br><span class="line"><span class="keyword">if</span> n1 &lt; n || n1 &gt; maxVal &#123;</span><br><span class="line">	<span class="comment">// n+v overflows</span></span><br><span class="line">	<span class="keyword">return</span> maxVal, rangeError(fnParseUint, s0)</span><br><span class="line">&#125;</span><br><span class="line">n = n1</span><br></pre></td></tr></table></figure>
<p>(4) <code>cutoff</code> æ˜¯é˜²æ­¢æº¢å‡ºçš„ç¬¬ä¸€é‡æ …æ </p>
<p>å¯¹äº <code>uint64</code> æ¥è¯´</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cutoff     = 1844674407370955162</span><br><span class="line">UINT64_MAX = 18446744073709551615</span><br></pre></td></tr></table></figure>
<p>parse çš„æ—¶å€™å¦‚æœå½“å‰æ•°å·²ç» &gt;= cutoff é‚£ä¹ˆåé¢çš„æ•°å­—ä¸ç®¡æ˜¯å‡ éƒ½ç»å¯¹æº¢å‡ºã€‚</p>
<p>ä½†æ˜¯å³ä½¿ cutoff è¿™é‡Œæ»¡è¶³ï¼ŒåŠ ä¸Šåä¸€ä½æ•°å­—ä¹‹åä»ç„¶å¯èƒ½ä¼šæº¢å‡ºï¼Œæ‰€ä»¥è¿™é‡Œè¦åšæº¢å‡ºå¤„ç†ã€‚</p>
<p>å› ä¸ºç±»å‹æ˜¯ uint64ï¼Œæ‰€ä»¥åªå¯èƒ½å‘ç”Ÿä¸Šæº¢å‡ºï¼Œæ•°å€¼ä¼š wrap-aroundï¼Œæ‰€ä»¥ç”¨ <code>n + uint64(d) &lt; n</code> æ¥åˆ¤æ–­</p>
<p><code>n1 &gt; maxVal</code> æ˜¯ç”¨æ¥å¤„ç† int32 çš„æ—¶å€™çš„æƒ…å†µï¼ˆå‡½æ•°çš„è¾“å…¥ç±»å‹å·²ç»è¢«è½¬æˆäº† 64-bitï¼‰</p>
<p>(5) å¦‚æœè¾“å…¥ç±»å‹æœ¬èº«å°±æ˜¯æ— ç¬¦å·ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œå°±ç»“æŸäº†ã€‚</p>
<p>å¦‚æœæ˜¯æœ‰ç¬¦å·ï¼Œéœ€è¦åˆ¤æ–­æœ€ç»ˆç»“æœæ˜¯å¦è½åœ¨èŒƒå›´é‡Œï¼Œå¦å¤–è¦æ³¨æ„è¡¥ç ä½“ç³»ä¸‹ä¸¤ç«¯çš„å€¼æ˜¯ä¸å¯¹ç§°çš„ã€‚</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2020/04/19/allow-connections-from-lan-for-trojan-qt5/">Allow Connections From LAN for Trojan-qt5</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-04-19
        </span>
        
          <div class="post-category">
            
              <a href="/categories/CODE-LIFE/">CODE-LIFE</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œæœºåœºçš„æœåŠ¡å•†æŠŠåè®®ä» SS åˆ‡æ¢åˆ°äº† Trojanã€‚ä½†æ˜¯ä¹‹å‰çš„ SS windows å®¢æˆ·ç«¯åªæ”¯æŒ SS åè®®ï¼Œæ‰€ä»¥åˆ‡æ¢ååªèƒ½æ¢ Trojan-qt5 ä½œä¸ºå®¢æˆ·ç«¯ã€‚</p>
<p>ä½†æ˜¯è¿™ä¸ªå®¢æˆ·ç«¯åšçš„å®åœ¨ä¸æ€ä¹ˆæ ·ï¼Œä½œè€…ä¼¼ä¹æ˜¯åœ¨åŸæ¥çš„ ss-qt5 çš„åŸºç¡€ä¸Šåšçš„ä¿®æ”¹ï¼Œé›†æˆäº† libtrojanï¼›ä»¥è‡³äºä¹‹å‰ SS-Windows ç”¨çš„å¥½å¥½çš„ <em>Allow Connections From LAN</em> åŠŸèƒ½åˆ°è¿™é‡Œæ²¡æ³•ç”¨äº†ã€‚</p>
<p>æ›´æ”¹ socks5 ç›‘å¬åœ°å€ä¸º <code>INETADDR_ANY</code> ç¡®å®èƒ½è®©å±€åŸŸç½‘å†…çš„å…¶ä»–ä¸»æœºé“¾æ¥ socks5 ä»£ç†ï¼Œä½†æ˜¯ HTTP ä»£ç†å°±ç¥å¥‡çš„ä¸èƒ½ç”¨äº†â€¦</p>
<p>è¯•éªŒäº†ä¸€ç•ªç»“æœå‘ç°è¦ä½¿ HTTP ä»£ç†èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œsocks5 ä»£ç†ç›‘å¬åœ°å€å¿…é¡»æ˜¯ <code>localhost</code>â€¦ ğŸ¤ª</p>
<p>å› ä¸ºæˆ‘çš„ Linux å¼€å‘ç¯å¢ƒæ˜¯æ­å»ºåœ¨è™šæ‹Ÿæœºé‡Œå¹¶é€šè¿‡ X11 è½¬å‘åˆ°å®¿ä¸»æœºçš„ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨æ¥è‡ª LAN çš„è¿æ¥ä¼šä¸¥é‡å½±å“å¼€å‘æ•ˆç‡ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><ol>
<li>è‡ªå·±å†™ä¸€ä¸ª tcp socket è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œå¹¶ç›‘å¬ <code>INETADDR_ANY</code>ï¼ŒMint æŠŠè½¬å‘å™¨ä½œä¸ºä»£ç†</li>
<li>ç”¨ netcat å®ç°</li>
<li>æ‰¾å…¶ä»–æ›¿ä»£å“</li>
</ol>
<p>å…ˆè€ƒè™‘ (1)ï¼Œç„¶è€Œå‘ç° netcat å¯ä»¥å®ç°å•æ¬¡è¿æ¥è½¬å‘ï¼Œä½†æ˜¯åç»­çš„åŒä¸€ä¸ªè¿æ¥çš„é€šä¿¡ä¼šç›´æ¥ hang ä½ï¼Œå¯èƒ½å“ªé‡Œå§¿åŠ¿ä¸å¯¹</p>
<p>å†è€ƒè™‘ (2)ï¼Œå‘ç°å¯ä»¥ç”¨ socatã€‚</p>
<p>WSL é‡Œé€šè¿‡ apt å®‰è£…ï¼Œç„¶å</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat tcp<span class="_">-l</span>:10086,fork,reuseaddr tcp:127.0.0.1:10081</span><br></pre></td></tr></table></figure>
<p>Mint æŠŠå®¿ä¸»æœºçš„ 10086 ç«¯å£ä½œä¸ºä»£ç†ç«¯å£</p>
<p>å—¯ï¼Œå‘ç°å·¥ä½œéå¸¸é¡ºç•…â€¦</p>
<p>è¿™æ ·å°±ä¸ç”¨è€ƒè™‘ (3) äº†ï¼Œä¸ç„¶å“ªæ€•ç”¨ ASIO ä¹Ÿå·®ä¸å¤šè¦ç™¾æ¥è¡Œä»£ç ã€‚</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2020/04/11/randomly-generate-base62-for-url-shortening/">Randomly Generate Base62 for URL Shortening</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-04-11
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>Last week I wrote a post about how to design an URL shortening service, like TinyURL, and came up with 2 strategies to encode an URL, and one of which is to randomly generate base64 sequence.</p>
<p>Although I knew it works, in theory, I was not so confident deep in mind.</p>
<p>So I wrote some code and made a simulation for generating 10^8 6-digit and 8-digit base62 sequences, respectively.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Alphabet</span> &#123;</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">char</span>, 62&gt; arr;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="title">Alphabet</span><span class="params">()</span></span></span><br><span class="line">        : arr()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> ch = <span class="string">'a'</span>; ch &lt;= <span class="string">'z'</span>; ++ch) &#123;</span><br><span class="line">            arr[ch - <span class="string">'a'</span>] = ch;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> ch = <span class="string">'A'</span>; ch &lt;= <span class="string">'Z'</span>; ++ch) &#123;</span><br><span class="line">            arr[ch - <span class="string">'A'</span> + <span class="number">26</span>] = ch;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> ch = <span class="string">'0'</span>; ch &lt;= <span class="string">'9'</span>; ++ch) &#123;</span><br><span class="line">            arr[ch - <span class="string">'0'</span> + <span class="number">52</span>] = ch;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">operator</span> <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">char</span>, 62&gt;()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">char</span>, 62&gt; kAlphabet = Alphabet();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="function">default_random_engine <span class="title">engine</span><span class="params">(<span class="built_in">std</span>::random_device&#123;&#125;())</span></span>;</span><br><span class="line">    <span class="built_in">std</span>::uniform_int_distribution&lt;&gt; dist(<span class="number">0</span>, <span class="number">61</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; keys;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">size_t</span> kNum = <span class="number">100000000</span>;  <span class="comment">// 10^8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; kNum; ++i) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> key;</span><br><span class="line">        key.reserve(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> k = <span class="number">0</span>; k &lt; <span class="number">8</span>; ++k) &#123;</span><br><span class="line">            key.append(<span class="number">1</span>, kAlphabet[dist(engine)]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        keys.insert(<span class="built_in">std</span>::move(key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"keys-size="</span> &lt;&lt; keys.size() &lt;&lt; <span class="string">"; total="</span> &lt;&lt; kNum &lt;&lt; <span class="string">"\n"</span></span><br><span class="line">              &lt;&lt; <span class="string">"unique ratio="</span> &lt;&lt; <span class="keyword">static_cast</span>&lt;<span class="keyword">double</span>&gt;(keys.size()) / kNum;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The result shows</p>
<ul>
<li>for generating 10^8 6-digit sequences, unique ratio of one-time generation is 0.9991</li>
<li>for the 8-digit case, the unique ratio of one-time generation is high as 0.99999975</li>
</ul>
<p>Even for 6-digit sequences, probability of two consecutive repeated generation is only 0.000001; and we can generate at least 1 million keys in less than 1 second.</p>
<p>Therefore, this strategy is indeed feasible in practice.</p>
<p>Notwithstanding, there is still one concernn we need to pay: the success ratio of one-time generation may drop dramatically after years, when number of generated combinations exceeds a threshould, like half of the entire combination space.</p>
<p>Unfortunately, I donâ€™t know what this threshould is in probability thoery; but if that day came, we can extend our sample space by extend length of base62 sequence, XD.</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2020/04/04/how-to-design-a-url-shortening-system/">How To Design a URL Shortening Service</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-04-04
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        
          
        

        
          <h2 id="1-Encoding-Actual-URL"><a href="#1-Encoding-Actual-URL" class="headerlink" title="1. Encoding Actual URL"></a>1. Encoding Actual URL</h2><p>The path part, which we would call it <em>key</em>, of an encoded URL can consist of 6 ~ 8 digits in base62, up to desired uniqueness rate.</p>
<h3 id="Randomly-Generated"><a href="#Randomly-Generated" class="headerlink" title="Randomly Generated"></a>Randomly Generated</h3><p>We can randomly generate those digits each within the range [0, 61].</p>
<p>Then we must check if the generated key is unique by consulting our key storage.</p>
<blockquote>
<p>Aside: this checking process can be optimized with data structures like bloom-filter, provided we have to deal hundres of million records.</p>
</blockquote>
<p>If we are unlucky, we may have a key collision; in this case, just re-generate another key until its unique.</p>
<p>To make encoding more efficient, we can have a standalone <em>Key Generation Service(KGS)</em> that generates those random key beforehand, and store them.<br>
          <div class="read-more">
            <a href="/2020/04/04/how-to-design-a-url-shortening-system/" class="read-more-link">é˜…è¯»æ›´å¤š</a>
          </div>
        
      
    </p></div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2020/02/08/how-to-learn-cmake-as-the-beginner/">CMake å…¥é—¨æŒ‡å—</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-02-08
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        
          
        

        
          <p>è¿™ç¯‡æ–‡ç« æ¥è‡ªäºæˆ‘åœ¨çŸ¥ä¹ä¸Šçš„è¿™ä¸ª<a href="https://www.zhihu.com/question/58949190/answer/999701073" target="_blank" rel="noopener">å›ç­”</a>ã€‚</p>
<p>å¤©çŸ¥é“ä¸ºä»€ä¹ˆå½“åˆä¼šèŠ±æ—¶é—´å†™ä¸€ä¸ªè¿™ä¹ˆä¸¥è‚ƒçš„ç­”æ¡ˆï¼Œè€ƒè™‘åˆ°å›½å†…ç¤¾åŒºçš„å®¡æŸ¥åŠ›åº¦ä¿ä¸å‡†å“ªå¤©æˆ‘çš„å¸å·å°±GGäº†ï¼Œè¿™é‡Œç‰¹æ„åšä¸€ä¸ªå¤‡ä»½ã€‚</p>
<hr>
<p>ä½œä¸ºä¸€ä¸ªä»2018å¹´ä¸‹åŠå¹´å¼€å§‹åˆ°ç°åœ¨æ–­æ–­ç»­ç»­æŠ˜è…¾äº†ä¸€å¹´åŠ CMake çš„äººï¼Œåˆšå¥½ç»å†äº† CMake ä»æ‡µé€¼åˆ°å…¥é—¨é˜¶æ®µã€‚</p>
<p>æ³¨ï¼šè™½ç„¶é—®é¢˜æ˜¯17å¹´æçš„ï¼Œä½†æ˜¯è€ƒè™‘åˆ° CMake çš„é¢‘ç¹è¿­ä»£å’Œæœ€ä½³å®è·µçš„å˜åŒ–ï¼Œå¸Œæœ›ä»¥ä¸‹å†…å®¹ä»æœ‰å¸®åŠ©ã€‚</p>
<h3 id="Why-CMake-ï¼Ÿ"><a href="#Why-CMake-ï¼Ÿ" class="headerlink" title="Why CMake ï¼Ÿ"></a>Why CMake ï¼Ÿ</h3><p>å…ˆå›ç­”æ‹¬å·ä¸­çš„é—®é¢˜ï¼š<strong>è¢«é€¼çš„</strong>ã€‚</p>
<p>è¿™ä¸‰ä¸ªå­—æ˜¯è®¤çœŸçš„ã€‚</p>
<p>ä¸ç®¡ CMake æ˜¯å¦æ˜¯ä¸€ä¸ªä¼˜ç§€çš„æ„å»ºå·¥å…·ï¼Œä¸ç®¡ä½ æ˜¯å¦è®¤åŒ CMakeï¼Œéƒ½æ— æ³•å¦è®¤ CMake ç›®å‰æ˜¯ C++ çš„ de facto build system[^1]ã€‚</p>
<p>æ‰€ä»¥åœ¨ç¤¾åŒºä»¥åŠç”Ÿæ€çš„å½±å“ä¸‹ï¼Œä½¿ç”¨ CMake ä½œä¸ºæ„å»ºå·¥å…·çš„é¡¹ç›®ä¼šè¶Šæ¥è¶Šå¤šã€‚<br>
          <div class="read-more">
            <a href="/2020/02/08/how-to-learn-cmake-as-the-beginner/" class="read-more-link">é˜…è¯»æ›´å¤š</a>
          </div>
        
      
    </p></div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2019/12/21/syn-queue-and-accept-queue/">SYN Queue and Accept Queue</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-12-21
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        
          
        

        
          <h2 id="0x00-A-Single-Queue-or-Two-Queues"><a href="#0x00-A-Single-Queue-or-Two-Queues" class="headerlink" title="0x00 A Single Queue or Two Queues"></a>0x00 A Single Queue or Two Queues</h2><p>TCP/IP stack has two options to implement the backlog queue for a socket in the <code>LISTEN</code> state.</p>
<p><strong>Door #1: A Single Queue</strong></p>
<p>A single queue can contain connections in two different states:</p>
<ul>
<li>SYN RECEIVED</li>
<li>ESTABLISHED</li>
</ul>
<p>And only connections in <code>ESTABLISHED</code> state can be returned to the application by calling the <code>accept()</code> syscall.</p>
<p>Therefore, the length of this queue is determined by the <code>backlog</code> argument of the <code>listen()</code> syscall.</p>
<p><strong>Door #2: A SYN Queue &amp; An Accept Queue</strong></p>
<p>In this case, connections in state <code>SYN RECEIVED</code> are added to the SYN queue, and later moved to the accept queue when their state changes to <code>ESTABLISHED</code>.<br>
          <div class="read-more">
            <a href="/2019/12/21/syn-queue-and-accept-queue/" class="read-more-link">é˜…è¯»æ›´å¤š</a>
          </div>
        
      
    </p></div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2019/12/08/toml-to-golang-struct/">Toml to Golang Struct</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-12-08
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>ä¹‹å‰å†™æŸä¸ªä¸œè¥¿çš„å‰¯äº§å“ï¼Œæœ¬è´¨ä¸Šå’Œ <a href="https://xuri.me/toml-to-go/" target="_blank" rel="noopener">https://xuri.me/toml-to-go/</a> ä¸€æ ·ã€‚</p>
<p>è§£æ Toml ä»ç„¶ä¾èµ– github.com/BurntSushi/toml è¿™ä¸ªåº“ã€‚</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Eliminates _ and capitalizes the key. The key needs to be exported.</span></span><br><span class="line"><span class="comment">// e.g hello_world -&gt; HelloWorld</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">normalizeStructKey</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	str := strings.ReplaceAll(key, <span class="string">"_"</span>, <span class="string">" "</span>)</span><br><span class="line">	str = strings.Title(str)</span><br><span class="line">	str = strings.ReplaceAll(str, <span class="string">" "</span>, <span class="string">""</span>)</span><br><span class="line">	<span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generates golang strcut from a given toml file.</span></span><br><span class="line"><span class="comment">// Result needs re-format.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">translate</span><span class="params">(data <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	def := <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> key, value := <span class="keyword">range</span> data &#123;</span><br><span class="line">		key = normalizeStructKey(key)</span><br><span class="line">		vt := reflect.ValueOf(value)</span><br><span class="line">		<span class="keyword">if</span> vt.Kind() == reflect.Map &#123;</span><br><span class="line">			def += key + <span class="string">" struct &#123;\n"</span> + translate(value.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)) + <span class="string">"\n&#125;\n"</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> vt.Kind() == reflect.Slice &#123;</span><br><span class="line">			s := <span class="string">"[]interface&#123;&#125;"</span></span><br><span class="line">			<span class="keyword">if</span> vt.Len() &gt; <span class="number">0</span> &#123;</span><br><span class="line">				s = reflect.ValueOf(vt.Index(<span class="number">0</span>).Interface()).Type().String()</span><br><span class="line">			&#125;</span><br><span class="line">			def += key + <span class="string">" []"</span> + s + <span class="string">"\n"</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			def += key + <span class="string">" "</span> + vt.Type().String() + <span class="string">"\n"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> def</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, err := toml.DecodeFile(tomlPath, &amp;data); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">inner := translate(data)</span><br></pre></td></tr></table></figure>
<p>æ”¯æŒç»“æ„åµŒå¥—ã€‚</p>
<p>ä¸è¿‡ç”Ÿæˆçš„æ–‡æœ¬å¤§æ¦‚éœ€è¦ gofmt ä¸€ä¸‹æ‰ç¬¦åˆæ ¼å¼è§„èŒƒã€‚</p>

        
      
    </div>

    

    

  </article>

    
  </section>

  
  <nav class="pagination">
    
    
      <a class="next" href="/page/2/">
        <span class="next-text">ä¸‹ä¸€é¡µ</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


          </div>
          

        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://hexo.io/">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2020

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Kingsley Chen</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>

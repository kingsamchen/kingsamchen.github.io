<!DOCTYPE html>
<html lang="default">
  <head><meta name="generator" content="Hexo 3.9.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Gone with the ruins">













  <link rel="alternate" href="/atom.xml" title="KC的废墟堆">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0">



<link rel="canonical" href="http://kingsamchen.github.io/page/16/">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0">






  



  









    <title> KC的废墟堆 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">KC的废墟堆</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/friends/">
        <li class="mobile-menu-item">
          
          
            Friends
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">KC的废墟堆</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/friends/">
            
            
              Friends
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  <section id="posts" class="posts">
    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/08/08/an-example-of-bad-api-design-getenvironmentvariable/">GetEnvironmentVariable, API 设计的反面教材</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-08-08
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>本次 post 的主角 <code>GetEnvironmentVariableW()</code> 用于获取某个环境变量的值，它的文档可以参见<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms683188.aspx" target="_blank" rel="noopener">这里</a>，看的时候记得仔细研究一下返回值细节。</p>
<p>这个 API 的设计可以说是一个生动的反面教材。</p>
<p>根据 MSDN，它的返回值如下：</p>
<ul>
<li>如果成功，则返回保存到缓存中的值的字符数，<strong>不包括 terminating null character</strong></li>
<li>如果缓冲区不够，那么就返回需要的缓冲区大小，以字符数计数，且<strong>包含 terminating null character</strong></li>
<li>如果函数失败，则<strong>返回 0</strong> （具体细节由 <code>GetLastError()</code> 给出）</li>
</ul>
<p>这里不吐槽在返回值非 0 的前提下，存在两种计数的返回值，我们考虑一种很 rare 的情况：环境变量的值是一个 empty string 时，这个 API 应该返回什么</p>
<p>Windows 上是可以通过 <code>SetEnvironmentVariableW()</code> 将某个环境变量的值设置为空字符串的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">wchar_t</span>* env_name = <span class="string">L"KCPath"</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">wchar_t</span>* str = <span class="string">L""</span>;</span><br><span class="line">BOOL rv = SetEnvironmentVariableW(env_name, str);</span><br><span class="line">assert(rv);</span><br></pre></td></tr></table></figure>
<p>那么此时用 <code>GetEnvironmentVariableW()</code> 获取值时，会返回 0 （因为不包含 terminating null，字符数为 0）。那么问题来了，如果我事先不知道这是一个空字符串，那么我怎么知道这个返回 0 意味着失败还是空字符串？</p>
<p>答案是没法区分，即使你再进一步调用 <code>GetLastError()</code>。</p>
<p>为什么？</p>
<p>因为 <code>GetLastError()</code> 的文档说的很清楚：在大部分 API <strong>失败</strong>时， calling thread 的 last error code 会被设置；而有部分（少量）API在成功时，也会设置 last error code。</p>
<p>但是很遗憾，通过实验验证，环境变量相关的 API 不属于后者。</p>
<p>这意味着存在一种可能：首先调用了某个环境变量的API，例如 <code>GetEnvironmentVariableW()</code>，但是他失败了，于是 last error code 被设置了；然后紧接着的代码片段利用 <code>GetEnvironmentVariableW()</code> 获取了某个环境变量的值，而这个值是 empty string，于是 API 返回 0；此时你调用了一下 <code>GetLastError()</code>，他返回了一开始调用 API 错误设置的那个错误值，于是这下你就以为后面的调用失败了….</p>
<p>来上一个 PoC 吧</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">wchar_t</span>* env_name = <span class="string">L"KCPath"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">wchar_t</span>* str = <span class="string">L""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Failed, and last error code will be set.</span></span><br><span class="line">    DWORD size_needed = GetEnvironmentVariableW(env_name, <span class="literal">nullptr</span>, <span class="number">0</span>);</span><br><span class="line">    assert(size_needed == <span class="number">0</span>);</span><br><span class="line">    assert(GetLastError() == ERROR_ENVVAR_NOT_FOUND);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set an empty string.</span></span><br><span class="line">    BOOL rv = SetEnvironmentVariableW(env_name, str);</span><br><span class="line">    assert(rv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Request buffer size from the API.</span></span><br><span class="line">    <span class="comment">// Returned size includes null-terminate character.</span></span><br><span class="line">    size_needed = GetEnvironmentVariableW(env_name, <span class="literal">nullptr</span>, <span class="number">0</span>);</span><br><span class="line">    assert(size_needed == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wchar_t</span> buf[MAX_PATH] &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    DWORD size_read = GetEnvironmentVariableW(env_name, buf, MAX_PATH);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// WAT? is last call failed?</span></span><br><span class="line">    assert(size_read == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> err = GetLastError();</span><br><span class="line">    <span class="comment">// Boom!</span></span><br><span class="line">    assert(err == ERROR_ENVVAR_NOT_FOUND);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个故事告诉我们，一个接口的返回值语义的清晰和不重叠是多么的重要。</p>
<p>最后：这个故事来自于我一个很意外的单元测试用例；我一开始一度以为问题出在 <code>GetEnvironmentVariableW()</code> 不能正确处理空字符串值，以至于这篇 post 最开始的标题是 <em>the werid behavior of GetEnvironmentVariable</em>；但是在我编写 PoC 的阶段我却发现问题怎么也复现不出来…经过快有半小时的跟踪分析后，我才最终确定真正的 root cause；这也告诉我们一个道理，verification 是多么的重要…</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/08/01/monthly-read-posts-in-july-2017/">Monthly Read Posts in June 2017</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-08-01
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p><a href="https://medium.com/swlh/starting-a-tech-startup-with-c-6b5d5856e6de" target="_blank" rel="noopener">Starting a tech startup with C++</a></p>
<p>又名，Facebook 开源项目宣传广告。</p>
<p>不过实话说，以 Facebook 写 C++ 那部分代码的恣意姿态，如果团队的平均水平够不到中上的槛，弄不好项目还没发布自己就先挂了。</p>
<p>Andrei Alexendrescu：我仿佛听见有人在背后黑我…</p>
<hr>
<p><a href="https://metricpanda.com/tips-for-productive-debugging-with-gdb" target="_blank" rel="noopener">Tips for Productive Debugging with GDB</a><br><a href="https://www.youtube.com/watch?v=PorfLSr3DDI&amp;t=24s" target="_blank" rel="noopener">CppCon 2015: Greg Law “ Give me 15 minutes &amp; I’ll change your view of GDB”</a></p>
<p>GDB Tips…</p>
<p>第二个是 CppCon 2015 的一个 talk，感觉还凑合吧。不过实话说，15分钟我都能撸一发了，何必浪费时间在这个上…上个靠谱的前端不才应该是正确的姿势么…</p>
<hr>
<p><a href="https://www.youtube.com/watch?v=PorfLSr3DDI&amp;t=24s" target="_blank" rel="noopener">CppCOn 2015: Visualize Template Instantiation</a></p>
<p>这个 talk 的团队基于 Eclipse 做了一个 Cevelop，杀手锏功能就是 able to visualize template instantiation</p>
<p>不过比较蛋疼的是演示关键部分的时候，摄像机没有给对位置…</p>
<p>（希望 JetBrains 早点吧这个功能抄过去…）</p>
<p>PS：这个 speaker 神似我的初中语文老师….</p>
<hr>
<p><a href="http://mariusbancila.ro/blog/2016/10/31/a-better-date-and-time-c-library/" target="_blank" rel="noopener">A better date and time C++ library</a></p>
<p>安利了 Howard Hinnant 写的一个 date lib。</p>
<p>而且据说这个 lib 很有机会进入标准库；现在标准库的 chrono 只是针对 timing 设计而没有对 date 的有力支持确实太蛋疼了</p>
<hr>
<p><a href="http://www.jianshu.com/p/71cf3ce064b8" target="_blank" rel="noopener">理解基于 TCP 的应用层通信协议</a></p>
<p>大水文一篇，基本没有一点营养。</p>
<p>不客气地说，现在国内开发者刊物上，大部分内容都是这种没有什么营养、容易误导读者，而且还浪费时间的文章。</p>
<p>挂出来批判一下</p>
<p><a href="http://jm.taobao.org/2017/06/08/20170608/" target="_blank" rel="noopener">就是要你懂 TCP</a><br><a href="http://jm.taobao.org/2017/06/01/20170601/" target="_blank" rel="noopener">就是要你懂 TCP | 最经典的TCP性能问题</a><br><a href="http://jm.taobao.org/2017/05/25/525-1/" target="_blank" rel="noopener">关于TCP 半连接队列和全连接队列</a></p>
<p>阿里中间件团队官方博客的三篇 TCP 相关分享。</p>
<p>算是有水平的内容文。</p>
<p>第一篇介绍了一下 TCP 的基础内容；第二篇介绍了 delayed ack 和 nagle’s algorithm；第三篇涉及 sync queue 和 accept queue 的处理问题</p>
<p><a href="http://ithare.com/tcp-peculiarities-for-games-part-1/" target="_blank" rel="noopener">TCP Peculiarities for Games, part 1</a><br><a href="http://ithare.com/tcp-peculiarities-as-applied-to-games-part-ii/" target="_blank" rel="noopener">TCP Peculiarities as Applied to Games, Part II</a></p>
<p>一个游戏服务端开发大牛的两篇关于游戏服务端 TCP 开发相关的文章。</p>
<p>两篇文章内容不光已经涵盖了前面阿里中间件团队的前两篇内容，还谈到了一些容易被忽略的点，例如 Head-of-Line Blocking。</p>
<p>第二篇还专门针对游戏服务端的业务特点，给了一些建议</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/07/24/terminate-child-processes-on-close-using-job-object/">利用 Job 内核对象实现父进程关闭时自动结束所有子进程</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-07-24
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>投稿工具的压制功能一直来都有一个问题：如果主进程被强行结束了（例如利用任务管理器），那么创建的 ffmpeg 压制进程仍然会继续运行。</p>
<p>因为 ffmpeg 是以二进制的方式部署的，因此不存在修改它的代码，自己和主进程建立 IPC 监控的方式。</p>
<p>至于采用远线程注入的方式来强行 HACK，我一直对这种无视客观规律的霸道方式都不太感冒，毕竟我们又不是做安全软件。</p>
<p>所以我想到了曾经在 Windows 核心编程中看到的一个方法：使用 Job 内核对象。</p>
<p>核心方法总结起来就是一句话：将 ffmpeg 压制进程加入到一个 Job 对象中，利用 Job 对象的 <em>Kill-On-Close</em> 特性，在 Job 内核对象被释放时，Job 内的所有进程都会被系统结束。</p>
<p>于是我写了一个 demo snippet，解决了几个坑之后验证了我的想法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;conio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">LaunchAndWait</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::wstring&amp; cmdline, HANDLE job)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">wchar_t</span> buf[<span class="number">255</span>] &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    wcscpy_s(buf, cmdline.c_str());</span><br><span class="line"></span><br><span class="line">    STARTUPINFO startup &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    startup.cb = <span class="keyword">sizeof</span>(startup);</span><br><span class="line">    PROCESS_INFORMATION process_information &#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!CreateProcessW(<span class="literal">nullptr</span>,</span><br><span class="line">                        buf,</span><br><span class="line">                        <span class="literal">nullptr</span>,</span><br><span class="line">                        <span class="literal">nullptr</span>,</span><br><span class="line">                        FALSE,</span><br><span class="line">                        CREATE_SUSPENDED | CREATE_BREAKAWAY_FROM_JOB,   <span class="comment">// important</span></span><br><span class="line">                        <span class="literal">nullptr</span>,</span><br><span class="line">                        <span class="literal">nullptr</span>,</span><br><span class="line">                        &amp;startup,</span><br><span class="line">                        &amp;process_information)) &#123;</span><br><span class="line">        <span class="keyword">auto</span> err = GetLastError();</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"Failed to create process: "</span> &lt;&lt; err;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!AssignProcessToJobObject(job, process_information.hProcess)) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"Failed to assign process to job: "</span> &lt;&lt; GetLastError();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ResumeThread(process_information.hThread);</span><br><span class="line"></span><br><span class="line">    CloseHandle(process_information.hProcess);</span><br><span class="line">    CloseHandle(process_information.hThread);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BOOL is_in_job;</span><br><span class="line">    IsProcessInJob(GetCurrentProcess(), <span class="literal">nullptr</span>, &amp;is_in_job);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Is the main process in job: "</span> &lt;&lt; is_in_job &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Wait for constructing job object!\n"</span>;</span><br><span class="line"></span><br><span class="line">    HANDLE job = CreateJobObjectW(<span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (!job) &#123;</span><br><span class="line">        <span class="keyword">auto</span> err = GetLastError();</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"Failed to create job: "</span> &lt;&lt; err &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Enforce limits.</span></span><br><span class="line">    JOBOBJECT_EXTENDED_LIMIT_INFORMATION job_limits;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;job_limits, <span class="number">0</span>, <span class="keyword">sizeof</span>(job_limits));</span><br><span class="line">    job_limits.BasicLimitInformation.LimitFlags = JOB_OBJECT_LIMIT_KILL_ON_JOB_CLOSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!SetInformationJobObject(job, JobObjectExtendedLimitInformation, &amp;job_limits, <span class="keyword">sizeof</span>(job_limits))) &#123;</span><br><span class="line">        <span class="keyword">auto</span> err = GetLastError();</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"Failed to set job information: "</span> &lt;&lt; err &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Job object created! Launch test subjects...\n"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> r = LaunchAndWait(<span class="string">LR"(C:\Windows\notepad.exe)"</span>, job);</span><br><span class="line">    assert(r);</span><br><span class="line"></span><br><span class="line">    _getch();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终的产品代码思路是完全一样的，当然代码不可能像上面这样随意。</p>
<p>这里有两个比较隐蔽的坑（MSDN 上不一定能看到）需要注意一下：</p>
<p>第一个是创建进程时最好带上 <code>CREATE_BREAKAWAY_FROM_JOB</code>，因为 Job 属性存在自动继承性：如果一个进程属于一个 Job，那么他创建的子进程会自动关联到这个 Job。</p>
<p><code>explorer</code> 和 VS 都是存在于 Job 中的，因此如果在这两个环境下运行程序， <code>IsProcessInJob()</code> 会返回 <code>true</code></p>
<p>第二个坑特别隐蔽：我一开始的 test subject 是 calc.exe，在 Windows 10 上这是一个 UWP 程序，然而无论我怎么做，calc 进程都活得好好的，一点不像是被约束的样子。。。甚至所有 API 的调用都并没有返回错误。</p>
<p>而当我将 test subject 换成 Win32 程序 notepad.exe 之后，功能就可以正常跑了….</p>
<p>我猜想这大概和 UWP 程序的一些安全特性有关，不过因为本身对安全并没有偏执的热爱，所以在这个点上就没有继续深入了。</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/07/23/send-specific-cookie-in-urlfetcher/">Send Specific Cookie in URLFetcher</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-07-23
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p>使用 <code>URLFetcher</code> 作为网络请求的基础组件有一个优势：如果 server 的 response header 指明了 <code>set-cookie</code>，那么 <code>URLFetcher</code> 在发出下一个请求时会自动往 request header 中设置 cookie。</p>
<p>这为使用某些需要在请求时附带 cookie 的 API 提供了便利；但是同时也在某一些场合下导致了一些问题。</p>
<p>如果你需要为某个 API 请求的 request header 中携带自定义的 cookie 数据，例如 <code>cookie: buvid=xxxx</code>，那么，即使你在发送请求前通过 <code>AddExtraRequestHeader()</code> 添加了 cookie 头，你也会惊奇地发现，出去的请求并没有携带你设置的 cookie，而是只有 <code>URLFetcher</code> 自己设置的，服务端提供的 cookie 值。</p>
<p>不要问为什么这个时候要用 cookie 传递这个信息，而不是某个独有的 request header，亦或者 query-string；你永远不知道和你对接的人是一个怎样的智障；毕竟，没有谁会真的去读 RFC。</p>
<p>自定义 cookie 丢失的原因大概如下：</p>
<ol>
<li>你首先设置了 cookie，然后发出请求</li>
<li><code>URLFetcher</code> 在内部实际进行网络请求前，会设置服务端的 cookie 值（因为之前的请求存在 <code>set-cookie</code>）</li>
<li>因为 RFC 规定，一个 request header 中， cookie header line 有且仅有一个，也就是说</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookie: buvid=xxx</span><br><span class="line">cookie: sig=xxx</span><br></pre></td></tr></table></figure>
<p>是不合法的；虽然可以通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cookie: buvid=xxx; sig=xxx</span><br></pre></td></tr></table></figure>
<p>来传递多个value，但是这要求 <code>URLFetcher</code> 在添加 cookie 时要能够 aware 到这点；很可惜，根据情况来看这点不成立</p>
<ol>
<li>于是 <code>URLFetcher</code> 粗暴的替换了你设置的 cookie 值</li>
</ol>
<p>扫了一遍代码之后，我想到一个 workaround，实践证明确实可以：</p>
<p>发请求前设置 <code>URLFetcher</code> 的 load flag，加上 <code>LOAD_DO_NOT_SEND_COOKIE</code>，阻止 <code>URLFetcher</code> 自己设置 cookie 的行为，完全由自己控制请求的 cookie。</p>
<p>话说用 <code>URLFetcher</code> 被坑了好多次（算上 chromium 其他的 lib，次数可以翻翻），还好每次都能够凭借“优秀工程师的第六感”蒙中问题的 root cause，进而化险为夷。我突然感觉自己理解了什么叫 <em>文章本天成，妙笔偶得之</em>。</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/07/07/bypass-proxy-in-urlfetcher/">Bypass Proxy in URLFetcher</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-07-07
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p><code>net::URLFetcher</code> 默认情况下会使用系统代理，对于针对应用于浏览器而设计的网络组件来说，这是合情合理的；并且这也方便了测试对于网络接口的调试，因为只需要打开 Fiddler 或者 Charles，就可以看到应用发出去的 HTTP 请求。</p>
<p>但是有时候我们又希望默认情况下不开启代理支持，比如：在我用 <code>net::URLFetcher</code> 重写某直播姬的网络通信组件后，出现了不少傻逼用户因为不知道自己系统上为什么会各种乱七八糟的本地代理而导致无法登陆。</p>
<p>这个时候产品的策略就应该改为：默认不使用代理，如果有特殊需要，通过命令行参数启动。</p>
<p>因为产品项目用的 chromium 的代码比较老（估计是 2x 的），这个版本的 <code>net::URLFetcher</code> 只要是使用 <code>URLRequestContextBuilder</code> 创建的 <code>URLRequestContext</code>，那么就一定会使用系统代理，这是写死在代码里的…</p>
<p>而且 <code>URLRequestContextBuilder</code> 也没有提供额外的途径让我们修改；而一旦创建完 <code>URLRequestContext</code>，此时再设置新的 <code>ProxyService</code> 是没有用的…</p>
<p>我觉得这是一个设计上的失误，不知道新版本的代码有没有针对这块做了什么改动。</p>
<p>万幸，<code>URLFetcher</code> 对象可以通过 <code>SetLoadFlags()</code>，使用标志 <code>LOAD_BYPASS_PROXY</code> 来强迫当前 fetcher 对象绕过代理。</p>
<p>于是设计就变成：如果没有外部设置，fetcher 在发出请求前设置 <code>LOAD_BYPASS_PROXY</code>。</p>
<h3 id="Afterthoughts"><a href="#Afterthoughts" class="headerlink" title="Afterthoughts"></a>Afterthoughts</h3><p>在研究代码过程中我发现 <code>URLRequestContext</code> 理论上是可以使用自己定义的子类的；builder 创建的是内部实现的一个 <code>BasicURLRequestContext</code>。chromium 在这里的设计颇有点<strong>机制策略分离</strong>的意味。</p>
<p>不过因为这个问题发现在新版本即将提测前，因此就将这个想法列为后续的 TODO 了。</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/07/02/monthly-read-posts-in-jun-2017/">Monthly Read Posts in June 2017</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-07-02
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p><a href="https://github.com/nixzhu/dev-blog/blob/master/2015-10-08-navi.md" target="_blank" rel="noopener">一种头像缓存策略</a></p>
<p>本来还以为有什么惊天地的策略…这不是很普通的策略嘛…</p>
<p><a href="http://foonathan.net/blog/2016/07/23/move-safety.html" target="_blank" rel="noopener">Move Safety</a></p>
<p>这篇 post 引入了一个 move-safety 的概念；和 exception safety 类似，move safety 描述了一个实例被移动之后的 post-condition invariant.</p>
<p>Why do we need move safety? Because <code>std::move()</code> creates artificial temporaries, and we might want to use them again after the move operation.</p>
<p>4-Level Move Safety</p>
<ul>
<li>No move guarantee: copy only</li>
<li>Strong move safety: moved object is valid and well-defined; like std::unique_ptr</li>
<li>Basic move safety: moved object is valid, but its state is unspecified; like std::string, due to possible SSO.It is what the standard library guarantees for all types unless otherwise specified.</li>
<li>No move safety: the state is invalid, and you can only call its destructor, or assign it a new value.</li>
</ul>
<p><a href="https://blog.tartanllama.xyz/c++/2016/07/18/stack-and-heap/" target="_blank" rel="noopener">Stack and Heap</a></p>
<p>这篇 post 挺有意思。</p>
<p>作者观点是，无论 <em>heap</em> 还是 <em>stack</em> 来描述一个 C++ object 的 storage location 都是不准确的，因为标准并未规定 storage location 具体是什么，而规定了所谓的 storage duration：<strong>Storage duration defines the minimum potential lifetime of the storage that contains the object</strong>.</p>
<p>4 standard-defined storage duration:</p>
<ul>
<li>Static storage duration</li>
<li>Automatic storage duration</li>
<li>Thread storage duration</li>
<li>Dynamic storage duration</li>
</ul>
<p><a href="http://www.drdobbs.com/cpp/mixin-based-programming-in-c/184404445" target="_blank" rel="noopener">Mix-in Based Programming in C++</a><br><a href="https://yanniss.github.io/practical-fmtd.pdf" target="_blank" rel="noopener">Paper: Mixed based programming in C++</a></p>
<p>第一篇是介绍 mix-in 的 post，第二篇是在 mix-in 基础上提出一种 mix-in layer 的 paper。</p>
<p>mix-in 是一个挺有意思的 patter，但是因为没有自身语言支持，在 C++ 里的实现有时候会遇到比较 tricky 的问题。</p>
<p>第一篇 post 就提到了一个核心问题：如何有效地解决 mix-in classes 的 construction problem。但是讲真，post 里给出的 solution 有点诡异过头了；如果现实中的工程问题需要这样的一个解决方案，弃用 mix-in 弄不好是一个更靠谱的做法。</p>
<p>至于第二篇 paper，其实核心所谓的 mix-in layer，概括起来就是</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Next</span> &gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">NUMBER</span> :</span> <span class="keyword">public</span> Next &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Workspace</span> :</span> <span class="keyword">public</span> Next::Workspace &#123;</span><br><span class="line">        <span class="comment">// Workspace role members</span></span><br><span class="line">    &#125;；</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vertex</span> :</span> <span class="keyword">public</span> Next::Vertex &#123;</span><br><span class="line">        <span class="comment">// Vertex role members</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>paper 中还提到了对工程中使用 mix-in 的一些建议和 recommended practice，看看也还不错。</p>
<p><a href="https://insouciant.org/tech/connection-management-in-chromium/" target="_blank" rel="noopener">Connection Management in Chromium</a></p>
<p>Chromium 官方研发写的 post。</p>
<p>提到了他们试图解决 connection latency &amp; parallelism 的问题。</p>
<p>于是就有这么几个点：</p>
<p>Handshakes (including TCP handshake &amp; SSL handshake) are costly. Therefore, a better connection management is on demand.</p>
<p>Optimizations on transport layer (TCP or SPDY)</p>
<p>.etc</p>
<p><a href="https://www.preney.ca/paul/archives/486" target="_blank" rel="noopener">Apply tuple to function efficiently</a></p>
<p>Yet another implementation of apply-on-tuple</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/06/15/use-base-bind-with-std-function/">Use base::Bind With std::function</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-06-15
        </span>
        
          <div class="post-category">
            
              <a href="/categories/PROGRAMMING/">PROGRAMMING</a>
            
          </div>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <p><code>base::Bind()</code> 和 <code>base::Callback</code> 可以看作是对标准库 <code>std::bind()</code> 和 <code>std::function</code> 的模拟；因为 chromium 项目早在 C++ 11 正式通过前就已经存在好多年了。</p>
<p>我为直播姬设计新的网络通信基础组件时，接口的回调 handler 通常设计为 <code>std::function</code> 对象，因为它可以“吸收”任何函数对象，大多数情况下这个设计运转的非常良好；但是这里有一个略微棘手的问题： <code>base::Callback</code> 对象无法被 <code>std::function</code> 使用。</p>
<p>问题本质很简单，因为 <code>base::Callback</code> 不是一个 function object，因为它不支持以函数形式调用（没有提供 <code>operator()</code> 的重载），instead，它提供了一个 <code>Run()</code> 函数来执行这个 callback…</p>
<p>虽然我之前吐槽过好多次 chromium 的很多架构设计完全是 Java-Style 的，但是这里并不打算再拎出来批判一次，我们要聚焦的是如何解决这个问题。</p>
<p>解决思路很简单：既然它不是一个 function object，那么我们就给他包一层 function object 的皮就好了：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"base/bind.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableCallback</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> R, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallableCallback</span>&lt;R(Args...)&gt; &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">callback_t</span> = base::Callback&lt;R(Args...)&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">CallableCallback</span><span class="params">(<span class="keyword">callback_t</span> callback)</span></span></span><br><span class="line">        : callback_(callback)</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">R <span class="title">operator</span><span class="params">()</span><span class="params">(Args... args)</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callback_.Run(args...);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">callback_t</span> callback_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Callback&gt;</span><br><span class="line">auto MakeCallable(Callback callback)-&gt;CallableCallback&lt;typename Callback::RunType&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> Sig = <span class="keyword">typename</span> Callback::RunType;</span><br><span class="line">    <span class="keyword">return</span> CallableCallback&lt;Sig&gt;(callback);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>辅助函数 <code>MakeCallable()</code> 可以将一个 <code>base::Callback</code> 对象转换成一个 function object。</p>
<p>一个简单的示例如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Inc</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ++i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Foo</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp;, <span class="built_in">std</span>::<span class="built_in">string</span>, <span class="keyword">int</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Test()</span><br><span class="line">        : msg_(<span class="string">"test"</span>), weak_ptr_factory_(<span class="keyword">this</span>)</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Bark</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; data &lt;&lt; <span class="string">":\t"</span> &lt;&lt; msg_ &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> msg_;</span><br><span class="line">    base::WeakPtrFactory&lt;Test&gt; weak_ptr_factory_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- test case 1 ---\n"</span>;</span><br><span class="line">    <span class="built_in">std</span>::function&lt;<span class="keyword">int</span>(<span class="keyword">int</span>)&gt; fn(MakeCallable(base::Bind(&amp;Inc)));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; fn(<span class="number">5</span>) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"--- test case 2 ---\n"</span>;</span><br><span class="line">    Test* ptr = <span class="keyword">new</span> Test();</span><br><span class="line">    <span class="built_in">std</span>::function&lt;<span class="keyword">void</span>()&gt; mfn(</span><br><span class="line">        MakeCallable(base::Bind(&amp;Test::Bark, ptr-&gt;weak_ptr_factory_.GetWeakPtr(), <span class="string">"inside"</span>)));</span><br><span class="line">    mfn();</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"release test instance\n"</span>;</span><br><span class="line">    <span class="keyword">delete</span> ptr;</span><br><span class="line">    mfn();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小巧优雅纯天然</p>

        
      
    </div>

    

    

  </article>

    
  </section>

  
  <nav class="pagination">
    
      <a class="prev" href="/page/15/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">上一页</span>
      </a>
    
    
      <a class="next" href="/page/17/">
        <span class="next-text">下一页</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


          </div>
          

        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2020

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Kingsley Chen</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>

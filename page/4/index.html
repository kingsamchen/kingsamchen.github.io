<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>KCçš„åºŸå¢Ÿå †</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Gone with the ruins">
<meta property="og:type" content="website">
<meta property="og:title" content="KCçš„åºŸå¢Ÿå †">
<meta property="og:url" content="http://kingsamchen.github.io/page/4/index.html">
<meta property="og:site_name" content="KCçš„åºŸå¢Ÿå †">
<meta property="og:description" content="Gone with the ruins">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KCçš„åºŸå¢Ÿå †">
<meta name="twitter:description" content="Gone with the ruins">
  
    <link rel="alternate" href="/atom.xml" title="KCçš„åºŸå¢Ÿå †" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">KCçš„åºŸå¢Ÿå †</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Will you serve in Heaven, or rule in Hell</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://kingsamchen.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-monthly-read-posts-in-nov-2016" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/04/monthly-read-posts-in-nov-2016/" class="article-date">
  <time datetime="2016-12-04T13:53:00.000Z" itemprop="datePublished">2016-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PROGRAMMING/">PROGRAMMING</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/04/monthly-read-posts-in-nov-2016/">Monthly Read Posts in Nov 2016</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://eli.thegreenplace.net/2011/09/06/stack-frame-layout-on-x86-64" target="_blank" rel="external">Stack Frame Layout on X86-64</a></p>
<p><strong>Main observations</strong></p>
<p>For AMD64 X64 ABI compiliant platforms (such as Linux), the major changes include:</p>
<ul>
<li>Introduces a red-zone storage area on the stack</li>
<li>Officially makes frame pointer explicitly optional</li>
</ul>
<p>For Windows X64 ABI(though depictated in supplementary):</p>
<ul>
<li>No red-zone; instead, a pre-allocated home-space is enforced for every function call</li>
<li>Cleanup of old calling convention legacy; no more worry about cdecl/fastcall/stdcall etc.</li>
</ul>
<p><a href="http://www.golgi.io/security-ssl-tls/" target="_blank" rel="external">Understanding Security in IoT: SSL/TLS</a><br><a href="http://insights.thoughtworkers.org/talk-about-https/" target="_blank" rel="external">æˆ‘ä¹Ÿæƒ³æ¥è°ˆè°ˆHTTPS</a></p>
<p><strong>Why HTTPS</strong></p>
<p>Why HTTP is not secure?</p>
<p>Because it transports information in plain text and with no anti-eavesdroping protection.</p>
<p><strong>How does it work</strong></p>
<p>After TCP connection is established, the client and server will futher start TLS/SSL handshake:</p>
<ol>
<li>Client-Hello</li>
<li>Server-Hello</li>
<li>Authentication and Key Exchange</li>
<li>Server-Finish</li>
<li>Client-Finish</li>
</ol>
<p><strong>Extra Bonus</strong></p>
<p>How to use openssl for https.</p>
<p>å¸§å“¥åœ¨ä»–çš„<a href="http://blog.syscallx.com" target="_blank" rel="external">æŠ€æœ¯åšå®¢åˆ†ç«™</a>ä¸Šæœ‰ä¸‰ç¯‡å’Œ TLS/SSL åè®®å®ç°ç›¸å…³çš„ postsï¼Œå¯ä»¥æ”¾åˆ°ä¸‹ä¸ªæœˆçš„ reading list é‡Œ</p>
<p><a href="http://thereignn.ghost.io/on-dry-and-the-cost-of-wrongful-abstractions/" target="_blank" rel="external">ON DRY AND THE COST OF WRONGFUL ABSTRACTIONS</a></p>
<p><strong>Insight</strong></p>
<p>Duplicating code sometimes can be a good thing (when the cost imposed by abstractions is too high); namely, context matters.</p>
<p><strong>Reasons</strong></p>
<p>Programmers spend far more time reading code (to understand logic behind) than writing code.</p>
<p>Abstractions cut both ways: every abstraction comes at a cost.</p>
<p>Every abstraction imposes an extra layer of knowledge, which places cognitive load on brain, and in turn, increases the time spent on understanding that piece of code.</p>
<p>In some extreme cases(everything is encapsulated in abstractions), the abstraction lost its value, and became a wrongful one.</p>
<p><strong>Conclusion</strong></p>
<p>Always abstract if the cost of abstraction does not surpass the cost of duplicating code.</p>
<p>But, itâ€™s just hard to get it right in real practice.</p>
<p><strong>Extra Comments</strong></p>
<p>ä¹‹å‰çœ‹è¿‡ä¸€ç¯‡ç±»ä¼¼çš„ postï¼Œæ ‡é¢˜å¤§æ¦‚æ˜¯ <em>dependency versus redundancy</em>ï¼Œå°è±¡ä¸­é‡Œé¢å™è¿°çš„è§‚ç‚¹æ¯”è¿™è¾¹æ›´åŠ çš„å…·ä½“ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kingsamchen.github.io/2016/12/04/monthly-read-posts-in-nov-2016/" data-id="cj5tqy2py002fa04nylw7xksr" class="article-share-link">Share</a>
      
        <a href="http://kingsamchen.github.io/2016/12/04/monthly-read-posts-in-nov-2016/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DRY/">DRY</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/https/">https</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/monthly-read-posts/">monthly read posts</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stack-frame-layout/">stack frame layout</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/x86-64-ABI/">x86-64 ABI</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-disable-crash-fast-in-debug-mode-due-to-invalid-parameters-when-using-breakpad" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/20/disable-crash-fast-in-debug-mode-due-to-invalid-parameters-when-using-breakpad/" class="article-date">
  <time datetime="2016-11-20T04:30:16.000Z" itemprop="datePublished">2016-11-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PROGRAMMING/">PROGRAMMING</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/20/disable-crash-fast-in-debug-mode-due-to-invalid-parameters-when-using-breakpad/">é¿å…ä½¿ç”¨ breakpad æ—¶è°ƒè¯•æ¨¡å¼ä¸‹æŸäº›é”™è¯¯è·³è¿‡è°ƒè¯•å™¨è‡ªåŠ¨å¼•å‘å´©æºƒå¤„ç†</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h3><p>æŸä¸ªå°æœ‹å‹ï¼ˆè™½ç„¶å’Œæˆ‘åŒå¹´åŒå±Šâ€¦ï¼‰å†™ä»£ç æ—¶ä¸æ³¨æ„ï¼Œå‡ºç°æœªçŸ¥é”™è¯¯ï¼Œä½†æ˜¯å³ä½¿è°ƒè¯•å™¨å¯ç”¨æ‰€æœ‰æ–­ç‚¹é€‰é¡¹ï¼Œä¹Ÿå¹¶æ²¡æœ‰æ–­åœ¨å‡ºç°é”™è¯¯çš„åœ°æ–¹ï¼Œè€Œæ˜¯ç›´æ¥è¿›å…¥äº†æˆ‘å†™çš„ crash handlerã€‚</p>
<h3 id="åˆ†æè¿‡ç¨‹"><a href="#åˆ†æè¿‡ç¨‹" class="headerlink" title="åˆ†æè¿‡ç¨‹"></a>åˆ†æè¿‡ç¨‹</h3><p>åœ¨è°ƒç”¨ä¼šå‡ºç°é”™è¯¯çš„å‡½æ•°å‰åŠ å…¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">*<span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>*&gt;(<span class="number">0x0</span>) = <span class="number">0xDEADBEEF</span>;</div></pre></td></tr></table></figure>
<p>è°ƒè¯•è¿è¡Œï¼Œdebugger æˆåŠŸæ–­ä¸‹ï¼›è¯´æ˜ç›¸å…³åŠŸèƒ½å‡æ­£å¸¸ï¼Œé—®é¢˜åº”è¯¥åªå’Œè¯¥å‡½æ•°äº§ç”Ÿçš„é”™è¯¯æœ‰å…³ã€‚</p>
<p>æ‰“å¼€ crash handler ç”Ÿæˆçš„ dump æ–‡ä»¶ï¼Œè®¾ç½®ç¬¦å·è¡¨ï¼Œå‘ç°é”™è¯¯å‘ç”ŸåŸå› æ˜¯ï¼š <code>vector::operator[]</code> è®¿é—®ä¸‹æ ‡è¶Šç•Œï¼Œä½†æ˜¯è¯¥é”™è¯¯ç›´æ¥è§¦å‘ crash handler</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å»æ‰ client å®‰è£… crash handler å‰çš„</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">_CrtSetReportMode(_CRT_ASSERT, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<p>å³å¯è§£å†³é—®é¢˜ã€‚</p>
<h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><p>å› ä¸ºæ ‡å‡†è§„å®š <code>vector::operator[]</code> æ“ä½œä¸åš bounds checkingï¼Œæœ‰é—®é¢˜æƒ…å†µä¸‹ç›´æ¥å¯¼è‡´ undefined behaviorï¼›MSVC ä¸ºäº†æ›´å¿«è¯Šæ–­é—®é¢˜ï¼ŒDebug æ¨¡å¼ä¸‹ä¼šå¯¹è¿™ä¸ªæ“ä½œè¿›è¡Œ CRT ASSERTã€‚</p>
<p>è€Œ <code>_CrtSetReportMode()</code> å±è”½äº† CRT ASSERTï¼Œæ‰€ä»¥ç›´æ¥è¿›å…¥äº† crash handlerã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kingsamchen.github.io/2016/11/20/disable-crash-fast-in-debug-mode-due-to-invalid-parameters-when-using-breakpad/" data-id="cj5tqy2oi000oa04ngsuryl6l" class="article-share-link">Share</a>
      
        <a href="http://kingsamchen.github.io/2016/11/20/disable-crash-fast-in-debug-mode-due-to-invalid-parameters-when-using-breakpad/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/google-breakpad/">google-breakpad</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/invalid-paramter/">invalid paramter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/operator/">operator[]</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-recommend-csapp-3e-course-video-and-bomb-lab" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/19/recommend-csapp-3e-course-video-and-bomb-lab/" class="article-date">
  <time datetime="2016-11-19T04:26:19.000Z" itemprop="datePublished">2016-11-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PROGRAMMING/">PROGRAMMING</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/19/recommend-csapp-3e-course-video-and-bomb-lab/">æ¨è CSAPP:3e è¯¾ç¨‹è§†é¢‘ä»¥åŠ Bomb Lab</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ç»è¿‡å·®ä¸å¤š 7 å¹´æ—¶é—´ï¼ˆ2008 ~ 2015ï¼‰ï¼ŒCSAPP ç»ˆäºå‡ºäº† 3rd editionï¼›æ ¹æ®å®˜æ–¹çš„ changelogï¼Œæ–°ç‰ˆå…¨é¢ç”¨ x64 çš„ä½“ç³»ç»“æ„å»æ›¿ä»£äº†æ—§ç‰ˆçš„ ia-32ã€‚</p>
<p>ä¸ç®¡æ‰‹å¤´æœ‰æ²¡æœ‰ç¬¬ä¸‰ç‰ˆçš„ä¹¦ï¼ˆè®²é“ç†å…¶å®æŒºè´µçš„ï¼Œæœºå·¥çš„ç¿»è¯‘ç‰ˆ 2016/12 ä¼šå‘è¡Œï¼Œä½†æ˜¯ä¸çŸ¥é“è‹±æ–‡ç‰ˆ/å½±å°ç‰ˆä»€ä¹ˆæ—¶å€™å‘ï¼‰ï¼Œè¯¾ç¨‹çš„åœ¨çº¿è§†é¢‘éƒ½æ˜¯å¾ˆå¥½çš„ä¸€ä¸ªè¡¥å……æ‰‹æ®µã€‚</p>
<p>è§†é¢‘åœ°å€ï¼š<a href="https://scs.hosted.panopto.com/Panopto/Pages/Sessions/List.aspx#folderID=%22b96d90ae-9871-4fae-91e2-b1627b43e25e%22&amp;maxResults=10&amp;folderQuery=%22introduction%20to%20computer%20system%22&amp;page=3" target="_blank" rel="external">csapp:3e coruse videos</a></p>
<p><strong>æ¸©é¦¨æç¤ºï¼šéœ€è¦æ¢¯å­ éœ€è¦æ¢¯å­ éœ€è¦æ¢¯å­</strong></p>
<p>å¦å¤–é¡ºæ‰‹å¼ºçƒˆå»ºè®®å°è¯•ä¸€ä¸‹è¯¾ç¨‹æä¾›çš„ labsï¼Œä¾‹å¦‚å‰ä¸¤å¤©åœ¨ç©çš„ bomb labï¼Œç®€ç›´æ˜¯ä¸“é—¨é‡èº«ä¸º chapter 3 ç›¸å…³å†…å®¹å®šåˆ¶çš„ï¼Œå¯ä»¥è¿…é€Ÿå¸®åŠ©å­¦ä¹ è€…ç†Ÿæ‚‰æ±‡ç¼–å’Œæœ€åŸºæœ¬çš„é€†å‘çŸ¥è¯†ã€‚</p>
<p>ä¸æ­¤å½¢æˆå¼ºçƒˆåå·®çš„æ˜¯å›½å†…é«˜æ ¡çš„è¯¾ç¨‹å’Œè®­ç»ƒæ–¹å¼ï¼Œç®€ç›´ä½•åšé“§ã€‚</p>
<p>labs åœ°å€ï¼š<a href="http://csapp.cs.cmu.edu/3e/labs.html" target="_blank" rel="external">csapp:3e labs</a></p>
<p><strong>ï¼ˆå†æ¬¡ï¼‰æ¸©é¦¨æç¤ºï¼šéœ€è¦æ¢¯å­ éœ€è¦æ¢¯å­ éœ€è¦æ¢¯å­</strong></p>
<p>æœ€åè´´ä¸€å¼  bomb lab é€šå…³æˆªå›¾</p>
<p><img src="/img/csapp_bomb_lab.png" alt=""></p>
<p>ï¼ˆè‡ªç™½ï¼šå‰å››å…³æˆ‘çœŸçš„æ˜¯éå¸¸è®¤çœŸçš„ç©çš„ï¼Œåé¢ä¸¤å…³å®åœ¨å¤ªé•¿äº†ï¼Œ<code>disas</code> å‡ºæ¥çš„å†…å®¹éƒ½è¦å¥½æœºå±å¹•æ‰èƒ½æ˜¾ç¤ºå®Œï¼Œå®åœ¨æ²¡è€å¿ƒäº†å°±ç›´æ¥â€œçœ¼ç®—æ ˆå¹³è¡¡ï¼Œæ‰‹æ”¹RIPâ€ç»™è¿‡å»äº†â€¦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kingsamchen.github.io/2016/11/19/recommend-csapp-3e-course-video-and-bomb-lab/" data-id="cj5tqy2pt0027a04n3xg1oous" class="article-share-link">Share</a>
      
        <a href="http://kingsamchen.github.io/2016/11/19/recommend-csapp-3e-course-video-and-bomb-lab/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/computer-architecture/">computer architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/csapp/">csapp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-install-ycm-plugin-on-WSL" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/03/install-ycm-plugin-on-WSL/" class="article-date">
  <time datetime="2016-10-03T05:52:18.000Z" itemprop="datePublished">2016-10-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PROGRAMMING/">PROGRAMMING</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/03/install-ycm-plugin-on-WSL/">åœ¨ WSL çš„ VIM é‡Œå®‰è£… YCM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>æ³¨ 1ï¼šæ­¤å¤„çš„ WSL æŒ‡çš„æ˜¯ <em>Windows Subsytem for Linux</em>ï¼Œä¸æ˜¯â€œçŒ¥çæµâ€</p>
<p>æ³¨ 2ï¼šå¦‚æœæ˜¯åœ¨ä¸­å›½å¹¶ä¸”æ²¡æœ‰ä¸“ç”¨çš„å…¨å±€ç§‘å­¦ä¸Šç½‘çº¿è·¯ï¼ˆæ¯”å¦‚åœ¨è‡ªå·±å®¶é‡Œï¼‰ï¼Œå»ºè®®æ‰¾ä¸€ä¸ªç±»ä¼¼ SS çš„æ¢¯å­ï¼Œè®© WSL é‡Œçš„ç½‘ç»œæ“ä½œèµ°ä»£ç†ï¼Œæé«˜é€Ÿåº¦ï¼Œé¿å…å› ä¸ºæŸäº›è¿æ¥è¢«å’Œè°å¯¼è‡´æ‚²å‰§å‘ç”Ÿã€‚</p>
<p>å¦‚æœæœ‰ SSï¼Œé‚£ä¹ˆè¿›å…¥ WSL åæ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export http_proxy=http://127.0.0.1:1080</div><div class="line">export https_proxy=http://127.0.0.1:1080</div></pre></td></tr></table></figure>
<p>å¯¹å½“å‰ç”¨æˆ·è®¾ç½®ä»£ç†ã€‚</p>
<p>å¦‚æœéœ€è¦ä½¿ç”¨ apt-get æ“ä½œï¼Œé‚£ä¹ˆéœ€è¦é¦–å…ˆ <code>su</code> è¿›å…¥ root è´¦æˆ·ï¼Œåœ¨ root ä¸‹è®¾ç½®ä»£ç†ã€‚</p>
<p>æ­¤å¤„è®¾ç½®çš„ç¯å¢ƒå˜é‡åœ¨æŸä¸ª terminal é€€å‡ºåè‡ªåŠ¨é”€æ¯ï¼Œä¸‹æ¬¡è¿›å…¥ terminal éœ€è¦é‡å¤è®¾ç½®ã€‚å¦‚æœä½ çš„ä»£ç†éå¸¸ç¨³å®šéå¸¸å¿«ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘æ”¹å†™ profileï¼Œé¿å…æ¯æ¬¡æ‰‹è¾“ã€‚</p>
<p><em><strong>Special thanks to @xqq here</strong></em></p>
<h3 id="æ›´æ–°è‡ªå¸¦çš„-VIM"><a href="#æ›´æ–°è‡ªå¸¦çš„-VIM" class="headerlink" title="æ›´æ–°è‡ªå¸¦çš„ VIM"></a>æ›´æ–°è‡ªå¸¦çš„ VIM</h3><p>å› ä¸º WSL é‡Œçš„ ubuntu æ˜¯ 14.04 LTSï¼Œå› æ­¤é‡Œé¢é™„å¸¦çš„ vim å¹¶ä¸æ»¡è¶³<strong>æœ€æ–°</strong>çš„ YCM çš„æœ€ä½ç‰ˆæœ¬è¦æ±‚ï¼Œå¦‚æœä¸å‡çº§ä¼šå‡ºç° ycm å·¥ä½œå¼‚å¸¸ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo add-apt-repository ppa:pkg-vim/vim-daily</div><div class="line">sudo apt-get update &amp;&amp; sudo apt-get upgrade</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…æ„å»ºåŸºç¡€ä¾èµ–"><a href="#å®‰è£…æ„å»ºåŸºç¡€ä¾èµ–" class="headerlink" title="å®‰è£…æ„å»ºåŸºç¡€ä¾èµ–"></a>å®‰è£…æ„å»ºåŸºç¡€ä¾èµ–</h3><p>ä¸»è¦åŒ…æ‹¬ï¼šCMake å’Œ python-dev packages</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install build-essential cmake</div><div class="line">sudo apt-get install python-dev python3-dev</div></pre></td></tr></table></figure>
<h3 id="å®‰è£…-VIM-æ’ä»¶ç®¡ç†å™¨-Vundle"><a href="#å®‰è£…-VIM-æ’ä»¶ç®¡ç†å™¨-Vundle" class="headerlink" title="å®‰è£… VIM æ’ä»¶ç®¡ç†å™¨ Vundle"></a>å®‰è£… VIM æ’ä»¶ç®¡ç†å™¨ Vundle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim</div></pre></td></tr></table></figure>
<p>æ’ä»¶è®¾ç½®å‚è€ƒ <a href="https://github.com/VundleVim/Vundle.vim" target="_blank" rel="external">è¿™é‡Œ</a></p>
<h3 id="å®‰è£…-YCM"><a href="#å®‰è£…-YCM" class="headerlink" title="å®‰è£… YCM"></a>å®‰è£… YCM</h3><p>è™½ç„¶æˆ‘ä»¬å®‰è£…äº† vundleï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ä¼šç›´æ¥é€šè¿‡ vundle è£… ycmï¼Œå› ä¸ºå¤ªæ…¢äº†ã€‚</p>
<p>å½“ç„¶å¦‚æœä½ åœ¨å›½å¤–æˆ–è€…æœ‰ç§‘å­¦ä¸Šç½‘ä¸“çº¿ï¼Œé‚£å°±æ— æ‰€è°“äº†â€¦ä¸è¿‡è°è®©æˆ‘ä»¬æ˜¯ç©·å±Œä¸å‘¢ã€‚</p>
<p>é¦–å…ˆè¿›å…¥ç›®å½• <code>~/.vim/bundle</code>ï¼Œç„¶åæŠŠ YCM çš„ repo æ‹‰ä¸‹æ¥ï¼Œè®°å¾—è¦ç”¨ <code>--recursive</code>ï¼Œå› ä¸ºç°åœ¨çš„ ycm ä¾èµ–çš„ç¬¬ä¸‰æ–¹æ¨¡å—å¤ªå¤šäº†â€¦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone --recursive https://github.com/Valloric/YouCompleteMe.git</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ“ä½œå¯¹ä½ çš„æ¢¯å­æ˜¯ä¸€ä¸ªæå¤§çš„è€ƒéªŒï¼Œå¦‚æœä¸­é€” clone æŒ‚äº†ï¼Œå°±è¿›å…¥ ycm çš„ç›®å½•ï¼Œæ¥ç€ç”¨ submodule update å»ç»§ç»­æ‹–ä»£ç å³å¯ã€‚</p>
<p>æƒ³å½“åˆæˆ‘çš„ SS åœ¨è¿™é‡Œæ–­äº† 5-6 æ¬¡ï¼Œæ¯ä¸€æ¬¡ connection lost éƒ½è®©æˆ‘é—®å€™äº†ä¸€éå…šå’Œå›½å®¶â€¦</p>
<p>ä»£ç æ‹‰å®Œä¹‹åè¿˜æ²¡ç»“æŸï¼Œè¿™ä¸ªæ—¶å€™æ‰“å¼€ <code>.vimrc</code>ï¼ŒæŠŠ ycm åŠ åˆ° vundle çš„è®¾ç½®åˆ—è¡¨é‡Œï¼Œç„¶åæ‰“å¼€ vim èµ°ä¸€é <code>PluginInstall</code>ã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ° ycm è¢«é£å¿«çš„å®‰è£…å®Œäº†ï¼ˆå…¶å®ä¹Ÿå°±æ ¡éªŒäº†ä¸€ä¸‹ğŸ˜ï¼‰</p>
<h3 id="ç¼–è¯‘-ycm"><a href="#ç¼–è¯‘-ycm" class="headerlink" title="ç¼–è¯‘ ycm"></a>ç¼–è¯‘ ycm</h3><p>æºä»£ç æ‹–å®Œäº†å°±è¯¥è½®åˆ°ç¼–è¯‘äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd ~/.vim/bundle/YouCompleteMe</div><div class="line">./install.py --clang-completer</div></pre></td></tr></table></figure>
<p>è„šæœ¬é¦–å…ˆä¼šå»ä¸‹è½½ clang-3.9ï¼Œç„¶åèµ°ä¸€é cmake çš„ç¼–è¯‘ï¼Œç­‰ä¸€ä¼šå„¿å°±å¥½ã€‚</p>
<h3 id="Debut"><a href="#Debut" class="headerlink" title="Debut"></a>Debut</h3><p>æ¥ä¸€å¼ æœ€ç»ˆæ•ˆæœå›¾</p>
<p><img src="img/wsl_vim_ycm.jpg" alt=""></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kingsamchen.github.io/2016/10/03/install-ycm-plugin-on-WSL/" data-id="cj5tqy2oy001da04ni5nppljb" class="article-share-link">Share</a>
      
        <a href="http://kingsamchen.github.io/2016/10/03/install-ycm-plugin-on-WSL/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bash-on-windows/">bash on windows</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wsl/">wsl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ycm/">ycm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-build-and-integrate-the-newest-version-of-breakpad-on-windows" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/24/build-and-integrate-the-newest-version-of-breakpad-on-windows/" class="article-date">
  <time datetime="2016-09-24T03:12:02.000Z" itemprop="datePublished">2016-09-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PROGRAMMING/">PROGRAMMING</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/24/build-and-integrate-the-newest-version-of-breakpad-on-windows/">åœ¨ Windows ä¸Šæ„å»ºå¹¶æ¥å…¥æœ€æ–°å‘å¸ƒåˆ†æ”¯çš„ breakpad</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>æ–°ç›´æ’­å§¬é¡¹ç›®é‡æ„çš„å·®ä¸å¤šäº†ï¼Œäºæ˜¯å‰å‡ å¤© leader å¯¹æˆ‘è¯´ï¼šç»„ç»‡å·²ç»å†³å®šäº†ï¼Œä½ æ¥æ¥å…¥ crash dump çš„å¤„ç†æ”¶é›†ï¼</p>
<p>äºæ˜¯æˆ‘å°±å¿µäº†å¥å£å·ï¼š<em>Hail Hydra</em>ï¼Œç„¶åå¼€å§‹ç ”ç©¶æ€ä¹ˆæ¥å…¥ <a href="https://chromium.googlesource.com/breakpad/breakpad/" target="_blank" rel="external">google-breakpad</a>ã€‚</p>
<p>breakpad ä¸€ç›´æ˜¯ chromium æ”¶é›† crash dump çš„å¾¡ç”¨é›å½¢ï¼ˆåœ¨å…¶ä¹‹ä¸ŠåŠ äº†ä¸€äº›ç§è´§ï¼‰ï¼Œä¸è¿‡ä¹‹å‰åœ¨åšå¤§å±è±¹çš„æ—¶å€™ä¸€ç›´éƒ½æ˜¯åˆ«äººåœ¨è´Ÿè´£è¿™å—åŠŸèƒ½ï¼Œæ‰€ä»¥å¹¶ä¸ç†Ÿæ‚‰ï¼›ä¸è¿‡æ²¡åƒè¿‡çŒªè‚‰è¿˜æ˜¯è§è¿‡çŒªè·‘çš„ã€‚</p>
<p>é¡¹ç›®æœ€æ–°çš„å‘å¸ƒåˆ†æ”¯æ˜¯ <strong>chrome_53</strong>ï¼Œ é‚£å°±é€‰æ‹©ä»è¿™ä¸ª remote branch åˆ‡å‡ºä¸€ä¸ª local branchã€‚ä½†æ˜¯åˆ‡å®Œä¹‹åæˆ‘å°±å‘ç°ä¸å¯¹åŠ²äº†ï¼šç‰¹ä¹ˆä»¥å‰ä¸€ç›´éšåŒ…é™„å¸¦çš„ <code>gyp</code> ç›®å½•å‘¢ï¼Ÿï¼Ÿï¼Ÿéš¾é“æœ€æ–°çš„å‘å¸ƒç‰ˆæœ¬ä¿®æ”¹äº† Windows ä¸Šçš„æ„å»ºæµç¨‹ï¼Ÿ</p>
<p>æŒ‰ç…§ Google çš„ä¸€è´¯å°¿æ€§ï¼Œè¿™æ˜¯ææœ‰å¯èƒ½çš„ï¼Œçœ‹çœ‹éš”å£ chromium çš„ tool-chain æ”¹äº†å¤šå°‘æ¬¡å°±çŸ¥é“äº†ï¼›äºæ˜¯æ‰“å¼€å®˜æ–¹é¡¹ç›®çš„ README çœ‹çœ‹ build instructionsï¼Œå—¯ï¼Œæœç„¶æ”¹äº†ï¼Œè¸é©¬ç›´æ¥æŠŠ build on Windows çš„ç›¸å…³å†…å®¹ç»™åˆ äº†ï¼ WTFï¼Ÿï¼Ÿï¼</p>
<p>Google ä¸€ä¸‹å‘ç°è™½ç„¶ gyp å’Œ doc è¢«ç§»é™¤äº†ï¼Œä½†æ˜¯ä¹‹å‰çš„ gyp æ„å»ºæ–¹æ¡ˆè¿˜æ˜¯å¯ä»¥ç”¨çš„ã€‚ï¼ˆå—¯ï¼Œæˆ‘æ—¥ä½ ä¸ªä»™äººæ¿ï¼‰</p>
<p>ç ”ç©¶äº†ä¸€ä¸‹ï¼Œå¯ç”¨çš„æ„å»ºæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨æœ¬åœ° clone ä¸€ä¸ª <a href="https://chromium.googlesource.com/external/gyp" target="_blank" rel="external">gyp</a>ï¼Œç›´æ¥ç”¨ <code>master</code> åˆ†æ”¯å°±å¥½ï¼Œå¹¶ä¸”ä¿è¯ <code>gyp.bat</code> åœ¨ç¯å¢ƒå˜é‡ <code>%PATH%</code> ä¸­ï¼ˆæ— æ‰€è°“æ˜¯ä½ æ‰‹åŠ¨æ·»åŠ è¿˜æ˜¯åœ¨å‘½ä»¤è¡Œä¸­ç”¨ <code>set path</code> æ·»åŠ ï¼‰</li>
<li>æ‰“å¼€æ–‡ä»¶ <code>breakpad\src\client\windows\breakpad_client.gyp</code>ï¼Œæ³¨é‡Šæ‰ <code>targets : dependencies</code> åˆ—è¡¨ä¸­çš„æœ€åä¸‰ä¸ªå’Œ test æœ‰å…³çš„ä¾èµ–å¼•ç”¨ï¼›å› ä¸ºæŸäº›æµ‹è¯•å·¥ç¨‹çš„ç¼–è¯‘ä¾èµ– <code>gtest</code>ï¼Œä½†æ˜¯å½“å‰é¡¹ç›®å¹¶ä¸é™„å¸¦ï¼Œæ‰€ä»¥ä½ ç›´æ¥ç¼–è¯‘è‚¯å®šä¼šä¸€å¨é”™è¯¯ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ä¸æ„å»ºæµ‹è¯•å·¥ç¨‹ã€‚å½“ç„¶å¦‚æœä½ éœ€è¦çš„åŒ–ï¼Œè‡ªå·±æ ¹æ® gyp è®¾ç½®ä¸€ä¸‹ gtest ç›®å½•ã€‚</li>
<li>åœ¨ breakpad çš„é¡¹ç›®ç›®å½•æ‰“å¼€ cmdï¼Œç”¨ <code>SET GYP_MSVS_VERSION=2013</code> è®¾ç½®ç›®æ ‡ Visual Studio å·¥ç¨‹çš„ç‰ˆæœ¬ï¼›å¦‚æœè¦ç”Ÿæˆ VS 2015 çš„æ–‡ä»¶ï¼Œç‰ˆæœ¬æ”¹æˆ 2015 å°±å¥½äº†</li>
<li>è¿è¡Œ <code>gyp.bat --no-circular-check src\client\windows\breakpad_client.gyp -Dwin_release_RuntimeLibrary=0 -Dwin_debug_RuntimeLibrary=1</code>ï¼›æœ€åä¸¤ä¸ªå‚æ•°è®¾ç½®çš„æ˜¯ <code>/MT(d)</code> è¿˜æ˜¯ <code>/MD(d)</code><ul>
<li>0ï¼š<code>/MT</code></li>
<li>1ï¼š<code>/MTd</code></li>
<li>2ï¼š<code>/MD</code></li>
<li>3ï¼š<code>/MDd</code></li>
</ul>
</li>
<li>ç”Ÿæˆçš„é¡¹ç›®æ–‡ä»¶åœ¨ç›®å½• <code>src\client\windows\</code> ä¸­ï¼Œç›´æ¥æ‰“å¼€ç¼–è¯‘å³å¯ï¼›ï¼ˆVisual Studio 2015 ç¼–è¯‘å¯èƒ½ä¼šå‡ºç° warning C4091ï¼Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œç›´æ¥å±è”½æ‰è¿™ä¸ªé”™è¯¯ï¼‰</li>
</ol>
<h3 id="ä½¿ç”¨ä¸Šè¦æ³¨æ„çš„å‡ ä¸ªå‘"><a href="#ä½¿ç”¨ä¸Šè¦æ³¨æ„çš„å‡ ä¸ªå‘" class="headerlink" title="ä½¿ç”¨ä¸Šè¦æ³¨æ„çš„å‡ ä¸ªå‘"></a>ä½¿ç”¨ä¸Šè¦æ³¨æ„çš„å‡ ä¸ªå‘</h3><p>Disclaimersï¼šå› ä¸ºæœåŠ¡ç«¯æš‚æ—¶ä¸æ”¯æŒï¼Œè€ƒè™‘åˆ°ç®€æ˜“æ€§ï¼Œæˆ‘åœ¨ç›´æ’­å§¬é‡Œç”¨çš„æ˜¯è¿›ç¨‹å†…æŠ“ dumpã€‚</p>
<p>ä¸€ä¸ªç®€å•é è°±çš„ demo</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> &#123;</div><div class="line"></div><div class="line"><span class="keyword">using</span> google_breakpad::ExceptionHandler;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">wchar_t</span> kCrashDumpDirName[] = <span class="string">L"crash_dumps"</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">wchar_t</span> kHintMessage[] = <span class="string">L"æˆ‘...æŒ‚äº†...å›§rz"</span>;</div><div class="line"></div><div class="line"><span class="comment">// We leak the object on purpose.</span></div><div class="line">ExceptionHandler* exception_handler = <span class="literal">nullptr</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">OnMinidumpGenerated</span><span class="params">(<span class="keyword">const</span> <span class="keyword">wchar_t</span>* dump_path, <span class="keyword">const</span> <span class="keyword">wchar_t</span>* minidump_id, <span class="keyword">void</span>* context,</span></span></div><div class="line">                         EXCEPTION_POINTERS* exinfo, MDRawAssertionInfo* assertion, <span class="keyword">bool</span> succeeded)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (succeeded)</div><div class="line">    &#123;</div><div class="line">        MessageBoxW(<span class="literal">nullptr</span>, kHintMessage, <span class="string">L"Error"</span>, MB_OK);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> succeeded;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">InstallCrashHandler</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// This is needed for CRT to not show dialog for invalid param</span></div><div class="line">    <span class="comment">// failures and instead let the code handle it.</span></div><div class="line">    _CrtSetReportMode(_CRT_ASSERT, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::wstring dump_dir_path = SetupCrashDumpDirectory(kCrashDumpDirName);</div><div class="line">    exception_handler = <span class="keyword">new</span> ExceptionHandler(dump_dir_path,</div><div class="line">                                             <span class="literal">nullptr</span>,</div><div class="line">                                             OnMinidumpGenerated,</div><div class="line">                                             <span class="literal">nullptr</span>,</div><div class="line">                                             ExceptionHandler::HANDLER_ALL,</div><div class="line">                                             MiniDumpNormal,</div><div class="line">                                             <span class="string">L""</span>,</div><div class="line">                                             <span class="literal">nullptr</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;   <span class="comment">// namespace</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> APIENTRY <span class="title">wWinMain</span><span class="params">(HINSTANCE instance, HINSTANCE prev, <span class="keyword">wchar_t</span>*, <span class="keyword">int</span>)</span></span></div><div class="line">&#123;</div><div class="line">    InstallCrashHandler();</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¦–å…ˆè¦ä¿è¯é¡¹ç›®çš„ include directory ä¸­ä¸€å®šè¦åŒ…å« <code>breakpad\src\</code> è¿™ä¸ªè·¯å¾„ï¼Œå› ä¸º breakpad å†…éƒ¨ä»£ç çš„ include æ˜¯åŸºäºè¿™ä¸ªå‡è®¾</p>
<p>åªéœ€è¦åœ¨ exe æ–‡ä»¶çš„å…¥å£å‡½æ•°ï¼ˆ<code>main</code> æˆ–è€… <code>WinMain</code>ï¼‰ä¸­è®¾ç½® breakpad çš„ <code>exception handler</code> å³å¯ï¼Œå“ªæ€•ä½ çš„é¡¹ç›®æœ‰å¾ˆå¤šé¢å¤–çš„ DLLsï¼›Handler æ˜¯è¿›ç¨‹å…¨å±€çš„ï¼Œè¿™ç‚¹ç”±æ“ä½œç³»ç»Ÿä¿è¯ï¼ˆæœ¬æ¥ breakpad å°±æ˜¯åŸºäºæ“ä½œç³»ç»Ÿæä¾›çš„ API åšçš„ä¸€ä¸ª wrapperï¼‰ã€‚</p>
<p>ä¸è¿‡è¦æ³¨æ„åœ¨è‡ªå·±çš„ä»£ç ä¸­ï¼Œå°¤å…¶æ˜¯ç”¨çš„ç¬¬ä¸‰æ–¹çš„ DLLï¼Œä¸è¦å‡ºç°ç”¨äº† <code>SetUnexpectedHandler()</code> å¯¼è‡´ override äº† breakpad çš„ handler çš„æƒ…å†µã€‚å› ä¸ºè¿™ä¸ªæˆ‘è¢«å‘è¿‡ä¸€ä¸‹åˆ -â€˜â€™-</p>
<p>ä¿å­˜ crash dump çš„æ–‡ä»¶å¤¹ä¸€å®šè¦<strong>äº‹å…ˆå­˜åœ¨</strong>ï¼Œbreakpad ä¸ä¼šå¸®ä½ åˆ›å»ºï¼Œäº‹å®ä¸Šï¼Œå¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œbreakpad çš„ handler ç”šè‡³å·¥ä½œä¸æ­£å¸¸ï¼Œè¿˜æ˜¯èµ°å› Windows çš„å´©æºƒåé¦ˆæµç¨‹å»äº†ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª exception filter callbackï¼Œç”¨æ¥è¿‡æ»¤ä¸€äº›å¼‚å¸¸ï¼Œè¿™é‡Œä¸éœ€è¦ç›´æ¥å¡«ç©ºã€‚</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ mini dump å†™å®Œä¹‹åçš„å›è°ƒï¼Œç”¨æ¥åšä¸€äº›æç¤ºç”¨æˆ·çš„å–„åæ“ä½œï¼Œå‚æ•° <code>succeeded</code> æç¤º dump æ˜¯å¦æˆåŠŸå†™å…¥ï¼›é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ª routine è¿”å›å breakpad ä¼š<strong>è‡ªåŠ¨ç»“æŸç¨‹åº</strong>ï¼Œé¿å…å¼‚å¸¸é€ æˆæ›´è¿›ä¸€æ­¥çš„ç ´åï¼Œè¿™æ˜¯éå¸¸åˆç†çš„åšæ³•ï¼Œæ‰€ä»¥ä¸è¦åœ¨è¿™ä¸ª callback é‡Œåšä¸€äº› non-trivial çš„äº‹æƒ…ã€‚</p>
<h3 id="ç‹ä¹‹é„™è§†"><a href="#ç‹ä¹‹é„™è§†" class="headerlink" title="ç‹ä¹‹é„™è§†"></a>ç‹ä¹‹é„™è§†</h3><p>æœ€åé„™è§†ä¸€ä¸‹ google breakpad team è¿™ç§ä¸æƒ³åšå…¼å®¹å°±ç´¢æ€§åˆ æ‰ç›¸å…³å†…å®¹çš„åšæ³•ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kingsamchen.github.io/2016/09/24/build-and-integrate-the-newest-version-of-breakpad-on-windows/" data-id="cj5tqy2o2000ca04ns3t5ecw4" class="article-share-link">Share</a>
      
        <a href="http://kingsamchen.github.io/2016/09/24/build-and-integrate-the-newest-version-of-breakpad-on-windows/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/breakpad/">breakpad</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cant/">cant</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cpp-is-fine-it-is-you-that-suck" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/03/cpp-is-fine-it-is-you-that-suck/" class="article-date">
  <time datetime="2016-09-03T09:10:39.000Z" itemprop="datePublished">2016-09-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PROGRAMMING/">PROGRAMMING</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/03/cpp-is-fine-it-is-you-that-suck/">C++ is fine, it&#39;s you that suck</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>è¿™ç¯‡ä¸»è¦å†…å®¹æ˜¯åæ§½ï¼Œå¹²è´§ä¸å¤šã€‚</p>
<p>æ›¾ç»æˆ‘ä»¥ä¸ºåªè¦æ˜¯æˆ‘è®¾è®¡çš„ä»£ç ç»“æ„é‡Œï¼ŒåŸºæœ¬ä¸ä¼šç¢°åˆ°éœ€è¦ multiple inheritance çš„æƒ…å†µï¼Œæ›´ä¸ç”¨è¯´éœ€è¦ virtual inheritanceï¼Œç»“æœæ²¡æƒ³åˆ°è¿™å‘¨å°±è¢«å•ªå•ªå•ªæ‰“è„¸äº†ã€‚</p>
<p>èµ·å› åœ¨äºæˆ‘è¦ä¸ºåº•å±‚çš„ obs properties ä½“ç³»è®¾è®¡ä¸€ä¸ª wrapperï¼Œä¸ºä¸Šå±‚æä¾›ç±»ä¼¼çš„ç­‰ä»·ç‰©ã€‚</p>
<p>properties æè¿°äº†ä¸€ä¸ª obs source æ‰€å…·å¤‡çš„ç‰¹æ€§é›†åˆï¼Œä¸åŒçš„ obs source æ‹¥æœ‰ä¸åŒçš„ propertiesï¼›è€Œ properties å®è´¨ä¸Šåˆæ˜¯ä¸€ä¸ªç”±ä¼—å¤šä¸åŒç±»å‹çš„ property æ„æˆçš„é›†åˆï¼Œå› æ­¤ä¸åŒç±»å‹çš„ property æ‰æ˜¯æ“ä½œçš„åŸºæœ¬å•ä½ã€‚</p>
<p>ä¸€ä¸ª source çš„ properties å¯èƒ½å®é™…ä¸ŠåŒ…å«ï¼š</p>
<ul>
<li>æè¿°æ•°å€¼ç±»å‹çš„ int-property or float-property</li>
<li>æè¿°æ–‡å­—ä¿¡æ¯çš„ text-property</li>
<li>æè¿°ä¸€ç³»åˆ—å­å±æ€§çš„ list-property</li>
<li>etc.</li>
</ul>
<p>ä½†æ˜¯è›‹ç–¼çš„åœ°æ–¹åœ¨äºï¼Œåœ¨ obs core è¿™ä¸€å±‚ï¼Œé€»è¾‘ä¸Šä¸åŒç±»å‹çš„ property å´å…·æœ‰ç›¸åŒç±»å‹çš„æ•°æ®ç±»å‹ï¼Œéƒ½ç”± <code>obs_property_t</code> æ¥è¡¨ç¤ºï¼›</p>
<p>äºæ˜¯ï¼Œé™¤äº†é€šåƒçš„è¯¸å¦‚ <code>get_name()</code>, <code>get_description()</code> æ“ä½œä¹‹å¤–ï¼Œobs è¿˜æä¾›äº†è¿”å›å…·ä½“ç±»å‹çš„å‡½æ•°æ¥å£ï¼Œä»¥åŠåˆ†åˆ«é’ˆå¯¹æŸä¸ªç±»å‹çš„ä¸€ç»„æ“ä½œå‡½æ•°æ¥å£ã€‚</p>
<p>è€ƒè™‘åˆ°å‡ ä¸ªåŸåˆ™</p>
<ul>
<li>proxy layer æœ¬èº«æ˜¯ä¸€ä¸ªå±è”½åº•å±‚ç»†èŠ‚çš„æ¨¡å—ï¼Œåªèƒ½åœ¨è¾¹ç•Œæš´éœ²å¿…è¦çš„æ¥å£</li>
<li>properties è¦åæ˜ å‡ºæ˜¯ property çš„åºåˆ—å®¹å™¨ï¼ˆèƒ½å¤Ÿä¾¿åˆ©å®šä½åˆ°æŸä¸ª propertyï¼‰</li>
<li>property æ— è®ºæ˜¯å…±æœ‰çš„æ“ä½œè¿˜æ˜¯ç‰¹å®šçš„æ“ä½œéƒ½è¦æš´éœ²ç»™å¤–ç•Œï¼Œå¹¶ä¸”è¦å±è”½åº•å±‚å®ç° property çš„ç»†èŠ‚</li>
</ul>
<p>æœ€é€‚åˆæˆ‘çš„å®ç°åè€Œæ˜¯æ‹¥æœ‰å¦‚ä¸‹ä¸¤æ¡ hierarchical path çš„å¤šç»§æ‰¿è®¾è®¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">                 Property [pure]</div><div class="line">                 /        \</div><div class="line">                /          \</div><div class="line">SpecificProperty[pure]     PropertyImpl [å®ç°åŸºç¡€æ“ä½œï¼Œå…¼å®¹ properties çš„å­˜å‚¨]</div><div class="line">                \          /</div><div class="line">                 \        /</div><div class="line">             SpecificPropertyImpl</div></pre></td></tr></table></figure>
<p>å·¦ä¾§ä¸¤ä¸ªåŸºç±»éƒ½æ˜¯ pure abstract classï¼Œè´Ÿè´£å¯¹å¤–æš´éœ²æ¥å£ï¼Œå³ä¾§çš„ impl class æ˜¯åœ¨ proxy layer ä¸­çš„å®é™…ç±»å‹ã€‚</p>
<p>ç”±äºè€ƒè™‘åˆ° <em>properties contains a series of property</em> çš„äº‹å®ï¼Œ<code>PropertyImpl</code> å®é™…ä¸Šå¯¹å¤–è¡¨ç°å‡ºå€¼ç±»å‹è¯­ä¹‰ï¼ˆå—¯å“¼ï¼Œæˆ‘æ‰ä¸ä¼šè¯´æˆ‘ç¡¬ç”Ÿç”Ÿçš„åœ¨å¦å¤–çš„ <code>properties</code> wrapper ä¸Šç»™åŠ ä¸Šäº†è¿­ä»£å™¨æ”¯æŒâ€¦ï¼‰ã€‚</p>
<p>ä¸Šé¢ç»§æ‰¿å‡ºç°äº†è±å½¢ç»§æ‰¿ï¼Œäºæ˜¯ virtual inheritance å°±è¿›æ¥äº†ï¼Œä¸ç„¶ <code>Property</code> çš„ææ„å‡½æ•°å°±æœ‰ä¸¤ä»½ï¼Œå¹¶ä¸”è¿˜ä¼šæ‰§è¡Œä¸¤æ¬¡ã€‚</p>
<p>è€ƒè™‘ä¸Šå±‚åœ¨æŸäº›æ—¶å€™éœ€è¦ä» <code>Property</code> è·å¾—æ›´ä¸ºå…·ä½“çš„ <code>SpecificProperty</code>ï¼Œä»¥æ‰§è¡Œä¸€äº›ç‰¹å®šçš„å±æ€§æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ©ç”¨ <code>dynamic_cast</code> åšä¸€äº› down-castã€‚</p>
<p>ç„¶è€Œâ€¦..è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæ•´ä¸ªç¨‹åºæ˜¯åŸºäº chromium çš„æ¡†æ¶å¼€å‘ï¼Œè€Œ chromium å¼ºåˆ¶æŠŠ RTTI å…³é—­äº†â€¦</p>
<p>äºæ˜¯ä¸€ä¸ªæ™šä¸ŠåŠ ä¸Šä¸€ä¸ªç™½å¤©ï¼Œæœ€åç»ˆäºæƒ³å‡ºä¸€ä¸ª workaround ç»™ç»•äº†è¿‡å»â€¦è€Œåœ¨æ„æƒ³æœ€ç»ˆçš„ workaround æœŸé—´ï¼Œæˆ‘ç”šè‡³æœ‰å†²åŠ¨è¦è‡ªå·±è‰¹ memory layout æ¥è®¡ç®—åç§»â€¦</p>
<p>å…³é—­ RTTI æ˜¯ä¸€ä¸ªéå¸¸å…·æœ‰ä»£è¡¨æ€§çš„è¡Œä¸ºï¼Œå’Œå¤šé‡ç»§æ‰¿ï¼Œè™šç»§æ‰¿ç±»ä¼¼ï¼Œå¾ˆå¤šäººè®¤ä¸ºè¿™äº›ä¸œè¥¿æ˜¯éå¸¸ evil çš„ï¼›å› ä¸ºä»–ä»¬ä¸å…‰å¸¦æ¥äº†æ€§èƒ½å¼€é”€ï¼Œå¹¶ä¸”å®é™…ä½œç”¨éƒ½å¯ä»¥è—‰ç”±å„ç§ workaround å®ç°ã€‚äºæ˜¯å…ˆæŠŠä½ çš„è®¾è®¡æ‰¹åˆ¤ä¸€ç•ªï¼Œå†æ¥ç€æ»”æ»”ä¸ç»çš„ç»™ä½ è®²è§£å„ç§å¯èƒ½å¯ä»¥ç”¨å¾—ä¸Šçš„ idiomsâ€¦</p>
<p>ç„¶è€Œï¼Œå·¥ç¨‹è®¾è®¡æ˜¯éå¸¸ non-trivial çš„ï¼Œç°å®ä¸–ç•Œæ˜¯éå¸¸ cruel çš„ï¼Œä½ æ°¸è¿œä¸çŸ¥é“ä½ é¢ä¸´çš„ä¼šæ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œå°¤å…¶æ˜¯é‡åˆ°ä½ çš„ code base ä¸­å­˜åœ¨æ¥æºäºå…¶ä»–ä¸å—æ§åˆ¶çš„ä»£ç çš„æ—¶å€™ã€‚</p>
<p>æˆ–è®¸æ˜¯å¯¹è¿™ç§äººå·²ç»æ„Ÿåˆ°äº†åŒå€¦ï¼Œç”šè‡³æ˜¯æ— è¯­ï¼ŒBjarne Stroustrup ç‰¹æ„åœ¨ä»–çš„ FAQ é‡Œæåˆ°äº†è¿™ä¹ˆä¸¤ç‚¹ï¼š</p>
<ul>
<li>language-supported inheritance is typically superior to workarounds for ease of programming, for detecting logical problems, for maintainability, and often for performance <a href="https://isocpp.org/wiki/faq/multiple-inheritance#mi-needed" target="_blank" rel="external">FAQ</a></li>
<li>It <em>really</em> bothers me when people think they know whatâ€™s best for <em>your</em> problem even though theyâ€™ve never seen <em>your</em> problem!! How can anybody possibly know that multiple inheritance wonâ€™t help <em>you</em> accomplish <em>your</em> goals without knowing <em>your</em> goals?!?!?!?!!! <a href="https://isocpp.org/wiki/faq/multiple-inheritance#mi-not-evil" target="_blank" rel="external">FAQ</a></li>
</ul>
<p>C++ ä¹‹æ‰€ä»¥å‘å±•æˆä»Šå¤©è¿™æ ·ï¼Œæˆä¸ºä¸€ä¸ª multi-paradigm çš„è¯­è¨€ï¼Œæœ¬å°±æ¥æºäº BS è®¤ä¸ºä¸–ç•Œå¤ªè¿‡ undeterministicï¼Œä¾é å•ä¸€çš„èŒƒå¼å¾ˆéš¾ç²¾å‡†æœ‰æ•ˆçš„è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ã€‚</p>
<p>å›åˆ°å‰é¢ RTTI çš„é—®é¢˜ï¼Œåæ¥å¹´å‰ï¼Œå„å¤§ä¸»æµç¼–è¯‘å™¨ ï¼ˆMSVC, GCC ç­‰ï¼‰æ˜¯é»˜è®¤å…³é—­ RTTI çš„ï¼Œç†ç”±æ˜¯ for better performanceï¼›è€Œç°åœ¨ï¼ŒRTTI çš„æ˜¯é»˜è®¤æ‰“å¼€çš„ï¼Œè¿™è‡³å°‘æ„å‘³ç€ä¸»æµç¼–è¯‘å™¨è®¤ä¸º RTTI æ‰€å¸¦æ¥çš„ side-effect penalty å·²ç»æ˜¯ negligibleã€‚</p>
<p>æ‰“å¼€ RTTI çš„å‰¯ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ‰€æœ‰ <strong>polymorphic class</strong> çš„ vtable å¤šäº†ä¸€ä¸ª slot ä¸“é—¨å­˜æ”¾ç±»å‹ä¿¡æ¯ã€‚</p>
<p><em>If you donâ€™t want to use a feature, just donâ€™t use it</em></p>
<p>ç›¸è¾ƒä¹‹ä¸‹ï¼Œç¦ç”¨å¼‚å¸¸å°±çœŸçš„æ˜¯éå¸¸ä¸ç†æ™ºçš„è¡Œä¸ºäº†ã€‚</p>
<p>æ›´é‡è¦çš„ï¼Œä¸è¦å› ä¸ºå­˜åœ¨æŸä¸ª feature å°±ä¸æ˜çœŸç›¸çš„ä¹±ç”¨ï¼Œæ‰å‘é‡Œäº†åˆæ„¤æ„¤ä¸å¹³çš„æä¸ªå¤§æ–°é—»ï¼Œå››å¤„å®£æ‰¬è¿™ä¸ª feature ç®€ç›´æ˜¯ shitï¼Œå¹¶ä¸” C++ æ˜¯ a pile of shitã€‚</p>
<p><strong><em>Remember, C++ is fine, it is you that suck</em></strong></p>
<h3 id="Bonus"><a href="#Bonus" class="headerlink" title="Bonus"></a>Bonus</h3><p>æœ€åè´´ä¸¤ä¸ª presentationï¼Œåˆ†åˆ«æ˜¯ Bjarne Stroustrup å’Œ Herb Sutter åœ¨ CppCon 2015 ä¸Šçš„åˆ†äº«ã€‚</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=1OEu9C51K2A" target="_blank" rel="external">Bjarne Stroustrup: Writing Good C++ 14</a></li>
<li><a href="https://www.youtube.com/watch?v=hEx5DNLWGgA" target="_blank" rel="external">Herb Sutter: Writing Good C++ 14 By Default</a></li>
</ul>
<p>ä½œä¸ºå¼€ç¯‡åˆ†äº«ï¼Œè¿™ä¸¤ä¸ª talks åº”è¯¥è¯´æ˜¯ä¸º write moder c++ programs å¥ å®šäº†ä¸€ä¸ªåŸºè°ƒï¼Œé‡Œé¢å¯¹ resource ownership, type safety, data-safety éƒ½åšäº†éå¸¸ç²¾å½©çš„å™è¿°ï¼Œå¹¶ä¸”è¿˜è”æ‰‹æç‚¼äº†ä¸€ä¸ª C++ Core Guidelines å‡ºæ¥ã€‚</p>
<p>å½“ç„¶é‡Œé¢ä¹Ÿæœ‰å„ç§ç§è´§ï¼Œä¾‹å¦‚ BS åæ§½ xx coding styleï¼ŒBS æ¨é”€ VS çš„é™æ€åˆ†æåŠŸèƒ½â€¦</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kingsamchen.github.io/2016/09/03/cpp-is-fine-it-is-you-that-suck/" data-id="cj5tqy2oi000ra04nngd7q28d" class="article-share-link">Share</a>
      
        <a href="http://kingsamchen.github.io/2016/09/03/cpp-is-fine-it-is-you-that-suck/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rant/">rant</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-get-correct-system-version-on-windows-10" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/30/get-correct-system-version-on-windows-10/" class="article-date">
  <time datetime="2016-07-30T15:45:38.000Z" itemprop="datePublished">2016-07-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PROGRAMMING/">PROGRAMMING</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/30/get-correct-system-version-on-windows-10/">åœ¨ Windows 10 ä¸Šè·å–æ­£ç¡®çš„ç³»ç»Ÿç‰ˆæœ¬</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>å¤§çº¦ä» Windows 8 å¼€å§‹ï¼Œå¾®è½¯å¼€å§‹è§‰å¾—å¤§å®¶ä¹‹å‰é‚£ç§ä¸åŒç³»ç»Ÿç‰ˆæœ¬ç»™ä¸åŒçš„ä»£ç çš„æ–¹å¼å¤ªä¸å’Œè°äº†ï¼Œæ€ä¹ˆå¯ä»¥æ discrimination å‘¢ï¼Ÿè¦å’Œè°ï¼Œè¦æœ‰çˆ±ï¼äºæ˜¯æŠŠå¸¸ç”¨çš„ <code>GetVersionEx()</code> ç»™æ ‡è®°æˆäº† deprecatedï¼Œå¹¶ä¸”å»ºè®®å¤§å®¶ä½¿ç”¨å¦å¤–ä¸€å¥—æ›´åŠ æ”¿æ²»æ­£ç¡®çš„ version verification APIã€‚</p>
<p>ç„¶åå°±åˆ°äº† Windows 10ï¼Œå¾®è½¯å‘ç°å¤§å®¶è¿™ä¸ªç‰ˆæœ¬æ­§è§†è¿˜æ˜¯æå¾—å¾ˆä¸¥é‡å•Šï¼Œå¤ªä¸å’Œè°äº†ï¼Œäºæ˜¯ä¸å…‰æŠŠåŸæ¥çš„ version verification ç»™ deprecate äº†ï¼Œç”šè‡³ <code>GetVersionEx()</code> è¿”å›çš„ç»“æœéƒ½ç»™å¼ºè¡Œæ”¹æˆå’Œ windows 8.1 ä¸€æ ·ã€‚</p>
<p>è¿™ä¸‹æ²¡æ³•ç®€å•åŒºåˆ† Windows 8.1 å’Œ Windows 10 äº†ï¼Œè€¶ï¼Œone Windows, a universal windows platform! Hail Microsoft!</p>
<p>å½“ç„¶å¾®è½¯è¿˜æ˜¯ç•™äº†ä¸€æ¡åè·¯ï¼Œå¦‚æœçœŸçš„éœ€è¦è·å¾—æ­£ç¡®çš„ Windows ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»™ EXE æŒ‚ä¸€ä¸ª manifestï¼Œå¾€é‡Œé¢åŠ å…¼å®¹ç‰ˆæœ¬çš„ UUID itemã€‚</p>
<p>ä½†æ˜¯è¿™æ ·åšå°±éå¸¸éº»çƒ¦ï¼Œè€Œä¸”ä¼¼ä¹å°±ç®—åŠ äº† manifestï¼Œç¨‹åºä¹Ÿå¾—ä½¿ç”¨æ­£ç¡®çš„ SDK ç‰ˆæœ¬ã€‚</p>
<p>äºæ˜¯å°±æœ‰å…¶ä»–éå¸¸è§„çš„æ–¹å¼ï¼Œæ¯”å¦‚ <code>RtlGetVersion()</code>ã€‚</p>
<p><code>RtlGetVersion()</code> éå¸¸ç¥å¥‡ï¼Œ<code>GetVersionEx()</code> å®é™…ä¸Šå†…éƒ¨è°ƒç”¨çš„å°±æ˜¯è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ <code>RtlGetVersion()</code> ä¸ä¼šåšé¢å¤–çš„æ¨¡ç³Šç‰ˆæœ¬å·çš„äº‹æƒ…ã€‚</p>
<p>è¿™ä¸ª API ä½äº <em>ntdll.dll</em> ä¸­ï¼Œæ‰€ä»¥ç›´æ¥åŠ¨æ€è°ƒç”¨å°±å¥½ï¼ˆæˆ–è€…ä½ æœ‰ DDKï¼Œç›´æ¥ç”¨ DDK æä¾›çš„é‚£ä»½å£°æ˜ä¹Ÿå¯ä»¥ï¼‰ã€‚</p>
<p>äºæ˜¯åªéœ€è¦</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DECLARE_DLL_FUNCTION(fn, type, dll) \</span></div><div class="line">    auto fn = reinterpret_cast<span class="meta-string">&lt;type&gt;(GetProcAddress(GetModuleHandleW(L##dll), #fn))</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">VersionNumber</span> &#123;</span></div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> major_version;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> minor_version;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetSystemVersion</span><span class="params">(VersionNumber&amp; version_number)</span> <span class="keyword">noexcept</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">constexpr</span> NTSTATUS kStatusSuccess = <span class="number">0L</span>;</div><div class="line">    DECLARE_DLL_FUNCTION(RtlGetVersion, NTSTATUS(WINAPI*)(PRTL_OSVERSIONINFOW), <span class="string">"ntdll.dll"</span>);</div><div class="line">    <span class="keyword">if</span> (!RtlGetVersion) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    RTL_OSVERSIONINFOW ovi &#123; <span class="keyword">sizeof</span>(ovi) &#125;;</div><div class="line">    <span class="keyword">if</span> (RtlGetVersion(&amp;ovi) != kStatusSuccess) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    version_number.major_version = ovi.dwMajorVersion;</div><div class="line">    version_number.minor_version = ovi.dwMinorVersion;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å°±å¯ä»¥è¾¾åˆ°ç”Ÿå‘½çš„ä¼Ÿå¤§å’Œè°ã€‚</p>
<p>RANT #1: æœ‰å¦å¤–ä¸€ç§æ–¹å¼çš„æ€è·¯æ˜¯é€šè¿‡è·å– <em>kernel32.dll</em> æˆ–å…¶ä»–ç³»ç»Ÿ DLL çš„æ–‡ä»¶ç‰ˆæœ¬ï¼Œæ¯”å¦‚ chromium å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚ä½†æ˜¯æ€»è§‰å¾—è¿™ç§æ–¹å¼å¤ªå®¹æ˜“ç©è„±ã€‚</p>
<p>RANT #2: å® <code>DECLARE_DLL_FUNCTION</code> æ˜¯ä»æŸèŠ±ä¹‹å‰çš„ä¸€ç¯‡ <a href="http://flowercode.org/archives/51" target="_blank" rel="external">post</a> æ”¹çš„ã€‚æˆ‘è§‰å¾—ä»–ç»™çš„å®é—®é¢˜å¤ªå¤§ï¼Œå®ç”¨æ€§æ¯”è¾ƒå·®ã€‚</p>
<p>API åŸå‹æ²¡æœ‰å¿…è¦åˆ†ç¦»å‡ºæ¥ï¼Œå¤ªç´¯èµ˜ï¼›å¦‚æœç¡¬è¦è¯´åˆ†ç¦»æœ‰ä»€ä¹ˆå¥½å¤„çš„è¯ï¼Œå¤§æ¦‚å°±æ˜¯è¿™äº› API éƒ½ä¿å­˜åœ¨ä¸€ä¸ªå•ç‹¬çš„ <em>.h</em> é‡Œï¼Œä¸ç”¨è‡ªå·±æ‰‹å†™ã€‚ä½†æ˜¯è¿™æ ·åˆä¼šå¼•å…¥å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå¾ˆå®¹æ˜“ç©è„±è¿å ODRï¼Œç„¶åæ‰“å‡º GGï¼Œ<code>extern</code> éƒ½æ‹¯æ•‘ä¸äº†ã€‚</p>
<p>å…¶å® <code>DECLARE_DLL_FUNCTION</code> é•¿ç°åœ¨è¿™ä¸ªæ ·å­æœ‰ä¸ªåŸå› æ˜¯æ²¡å‘ç°ä»€ä¹ˆç®€å•æœ‰æ•ˆçš„æ–¹æ³•ä»å‡½æ•°æŒ‡é’ˆçš„åŸå‹å£°æ˜ä¸­åˆ†ç†å¤„å˜é‡åâ€¦</p>
<p>RANT #3: å¾®è½¯åˆ»æ„æ¨¡ç³Šç³»ç»Ÿç‰ˆæœ¬ä¼°è®¡æ˜¯å¸Œæœ›å¤§å®¶å°½é‡èµ° UWP çš„æ–¹å¼ï¼Œæ¯•ç«Ÿå¯ä»¥é€šè¿‡é“¾æ¥åˆ°ä¸åŒç‰ˆæœ¬çš„ SDK æ¥åŒºåˆ†æ”¯æŒçš„ç³»ç»Ÿï¼Œè€Œåˆ†å‘åˆæ˜¯ç›´æ¥é€šè¿‡ microsoft app store å®Œæˆã€‚ä½†æ˜¯å¯¹äº native code app æ¥è¯´ï¼Œè¿™æ ·åšç®€ç›´å°±æ˜¯è‡ªå·±æŒ–å‘åˆ«äººè·³ï¼Œå¿«èµ¶ä¸Š Apple ä¸€æ ·æ— èµ–äº†ã€‚</p>
<p>Bonus: æ¬¢è¿ä½¿ç”¨ <code>kbase::OSInfo::IsVersionOrGreater()</code> æ¥è§£å†³ç‰ˆæœ¬æ£€æŸ¥ï¼ŒSample å¯ä»¥çœ‹<a href="https://github.com/kingsamchen/KBase/blob/master/Docs/os_info.md" target="_blank" rel="external">è¿™é‡Œ</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kingsamchen.github.io/2016/07/30/get-correct-system-version-on-windows-10/" data-id="cj5tqy2oy001ba04nz4piielw" class="article-share-link">Share</a>
      
        <a href="http://kingsamchen.github.io/2016/07/30/get-correct-system-version-on-windows-10/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/system-version/">system version</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows/">windows</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CODE-LIFE/">CODE-LIFE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PROGRAMMING/">PROGRAMMING</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/01/monthly-read-posts-in-july-2017/">Monthly Read Posts in June 2017</a>
          </li>
        
          <li>
            <a href="/2017/07/24/terminate-child-processes-on-close-using-job-object/">åˆ©ç”¨ Job å†…æ ¸å¯¹è±¡å®ç°çˆ¶è¿›ç¨‹å…³é—­æ—¶è‡ªåŠ¨ç»“æŸæ‰€æœ‰å­è¿›ç¨‹</a>
          </li>
        
          <li>
            <a href="/2017/07/23/send-specific-cookie-in-urlfetcher/">Send Specific Cookie in URLFetcher</a>
          </li>
        
          <li>
            <a href="/2017/07/07/bypass-proxy-in-urlfetcher/">Bypass Proxy in URLFetcher</a>
          </li>
        
          <li>
            <a href="/2017/07/02/monthly-read-posts-in-jun-2017/">Monthly Read Posts in June 2017</a>
          </li>
        
          <li>
            <a href="/2017/06/15/use-base-bind-with-std-function/">Use base::Bind With std::function</a>
          </li>
        
          <li>
            <a href="/2017/06/05/activate-the-first-application-instance-when-there-is-one/">ç¦æ­¢ç¨‹åºå¤šå®ä¾‹å¹¶å­˜å¹¶ä¸”è‡ªåŠ¨æ¿€æ´»ç¬¬ä¸€ä¸ªå®ä¾‹</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-17/">C++ 17</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DRY/">DRY</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVP/">MVP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SFINAE/">SFINAE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithms/">algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/appending-file/">appending file</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/base-Bind/">base::Bind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash-on-windows/">bash on windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bitfields/">bitfields</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/breakpad/">breakpad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/buddy-allocator/">buddy-allocator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cant/">cant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chromium/">chromium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/computer-architecture/">computer architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/conditional-move/">conditional move</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/connection-management/">connection management</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cookie/">cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cppcon/">cppcon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csapp/">csapp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-type-promotion/">data type promotion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-structures/">data-structures</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exception/">exception</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/function-object/">function object</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/function-pointer/">function pointer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gdb/">gdb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gibberish/">gibberish</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-pages/">git-pages</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google-breakpad/">google-breakpad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heap/">heap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inno-setup/">inno setup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/installer/">installer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/invalid-paramter/">invalid paramter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iterator/">iterator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/job/">job</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda/">lambda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linker/">linker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/minidump/">minidump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mix-in/">mix-in</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mixin/">mixin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/monthly-read-posts/">monthly read posts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/move-safety/">move safety</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/multiple-instance/">multiple instance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/multithreading/">multithreading</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/net-lib/">net lib</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/non-capturing-lambda/">non-capturing lambda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth-2-0/">oauth 2.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obs-studio/">obs-studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/operator/">operator[]</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/owner-semantics/">owner semantics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/path/">path</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/performance/">performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rant/">rant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/resignation/">resignation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/restful-api/">restful api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/resumable-download/">resumable download</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shared-ptr/">shared_ptr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stack/">stack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stack-frame-layout/">stack frame layout</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/std-apply/">std::apply</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/std-function/">std::function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/std-unique-ptr/">std::unique_ptr</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stl/">stl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/string-view/">string_view</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/system-version/">system version</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/template/">template</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ternary-search-tree/">ternary-search-tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thumbnails/">thumbnails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tokenizer/">tokenizer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/trie/">trie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tuple/">tuple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/urlfetcher/">urlfetcher</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/urlrequest/">urlrequest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/view-semantics/">view semantics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/work-flow/">work flow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wsl/">wsl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/x86-64-ABI/">x86-64 ABI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ycm/">ycm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/æ–­ç‚¹ä¸‹è½½/">æ–­ç‚¹ä¸‹è½½</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/è§†é¢‘å‹åˆ¶/">è§†é¢‘å‹åˆ¶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/é€ è½®å­/">é€ è½®å­</a></li></ul>
    </div>
  </div>


  
    <div class="widget-wrap">
  <h3 class="widget-title">Blog Rolls</h3>
    <div class="widget">
    <ul>
      <li><a href="http://www.daozhihun.com/">åˆ€ä¹‹é­‚ | å¤§æœ¨è€å¸ˆæˆé•¿æ—¥è®°</a></li>
      <li><a href="http://blog.mistysoul.net/">Sean | å¤§æœ¨è€å¸ˆçš„ç§äººä¿å§†</a></li>
      <li><a href="http://blog.nlogn.cn/">å¸§å“¥ | ç¡…è°·è°ˆæ’¸ç®¡</a></li>
      <li><a href="https://blog.chichou.me/">ChiChou | é¦–å¸­å®‰å…¨åœ°çƒä»ªåˆ‡å›¾æ€»å¥¸</a></li>
      <li><a href="http://www.fleurer-lee.com">Fleurer-lee | Få”çš„è¯»ä¹¦ç¬”è®°ï¼ˆå¤§é‡å¹²è´§ï¼‰</a></li>
      <li><a href="http://vizee.org/">Vizee | å³å°†èµ°ä¸Šäººç”Ÿå·…å³°æ¨èè‰çš„ç« æ€»</a></li>
      <li><a href="http://thecjw.0ginr.com/blog/">TheCJW | çˆ±å¼¹æ£‰èŠ±çš„å°ä¼Ÿ</a></li>
      <li><a href="http://newbiecoder.0ginr.com/blog/">Newbie Coder | èŒèŒå“’çš„ç‚‰å­</a></li>
      <li><a href="http://madstrawberry.me/">è£´è‰è“ | æ„¤æ€’çš„è€å¸æœº</a></li>
      <li><a href="http://beanbee.net/">é™ˆè€å¸ˆ | Beanbee.Max</a></li>
      <li><a href="http://sunus.me/">Sunus | æå¸ˆå‚…é£Ÿå“å‚CEO</a></li>
      <li><a href="http://www.tolower.net/">Lower | å–Šå¤§æœ¨å¤§å“¥çš„å°å¼Ÿ</a></li>
      <li><a href="http://mrljdx.com/">Mrljdx | å¤§ä¿å¥è€å¸æœº</a></li>
    </ul>
  </div>
</div>
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Kingsley Chen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'kingsamchen-github-io';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script type="text/x-mathjax-config"> 
MathJax.Hub.Config({ 
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} 
}); 
</script>
<script type="text/javascript"
   src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
  </div>
</body>
</html>
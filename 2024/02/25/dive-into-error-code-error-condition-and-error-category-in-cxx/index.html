<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Gone with the ruins"><title>Dive into error_code, error_condition and error_category in C++ | KCçš„åºŸå¢Ÿå †</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Dive into error_code, error_condition and error_category in C++</h1><a id="logo" href="/.">KCçš„åºŸå¢Ÿå †</a><p class="description">Will you serve in Heaven, or rule in Hell</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/source-code-reading/"><i class="fa fa-archive"> æºç åˆ†æ</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Dive into error_code, error_condition and error_category in C++</h1><div class="post-meta">2024-02-25<span> | </span><span class="category"><a href="/categories/PROGRAMMING/">PROGRAMMING</a></span></div><a class="disqus-comment-count" data-disqus-identifier="2024/02/25/dive-into-error-code-error-condition-and-error-category-in-cxx/" href="/2024/02/25/dive-into-error-code-error-condition-and-error-category-in-cxx/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-yet-another-error-code-family"><span class="toc-text">Why yet-another error-code family</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Goals"><span class="toc-text">Goals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#std-error-code"><span class="toc-text">std::error_code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#std-error-condition"><span class="toc-text">std::error_condition</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#std-errc"><span class="toc-text">std::errc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#std-error-category"><span class="toc-text">std::error_category</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Practice%EF%BC%9ACreating-an-error-code"><span class="toc-text">Practiceï¼šCreating an error code</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#what-about-std-make-error-code"><span class="toc-text">what about std::make_error_code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Testing-against-error-code-directly"><span class="toc-text">Testing against error code directly</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Error-enums"><span class="toc-text">Error enums</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Practice-Let%E2%80%99s-design-our-http-client-error-family"><span class="toc-text">Practice: Letâ€™s design our http client error-family</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x0-Original-error-code"><span class="toc-text">0x0 Original error code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x1-Using-general-condition-to-separate-client-x2F-server-errors"><span class="toc-text">0x1 Using general condition to separate client&#x2F;server errors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x3-Extending-error-handling-condition"><span class="toc-text">0x3 Extending error handling condition</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-text">References</span></a></li></ol></div></div><div class="post-content"><p>æœ€è¿‘æŠ½äº†ç‚¹æ—¶é—´ï¼Œé‡æ–°è¯»äº†ä¸€ä¸‹ Christopher Kohlhoff æ—©å¹´å†™çš„å‡ ç¯‡ä»‹ç» <code>std::error_code</code> ç”±æ¥çš„æ–‡ç« ï¼ˆåé¢ç®€ç§°â€œç³»åˆ—æ–‡ç« â€ï¼‰ï¼Œä»¥åŠ <code>Boost.System</code> è¿™ä¸ª lib çš„ç›¸å…³æ–‡æ¡£ï¼ˆåé¢ç®€ç§° Boost Doc)ã€‚</p>
<p>å¹¶ä¸”ä¸ºäº†ç¡®ä¿è‡ªå·±ç†è§£äº†è¿™äº›å†…å®¹ï¼Œä»¥ http status code ä¸ºåŸºç¡€å®ç°äº†å¯ä»¥æ ¹æ®å¤„ç†åœºæ™¯æ‰©å±•çš„é”™è¯¯ç ä½“ç³»ã€‚</p>
<h2 id="Why-yet-another-error-code-family"><a href="#Why-yet-another-error-code-family" class="headerlink" title="Why yet-another error-code family"></a>Why yet-another error-code family</h2><p>ä¸ºä»€ä¹ˆä¸ç”¨å¼‚å¸¸äºŒè¦å¼•å…¥ä¸€å¥—å…¨æ–°çš„é”™è¯¯ç ç³»åˆ—ï¼Œç³»åˆ—æ–‡ç« å¼€å¤´è®²äº†å¾ˆå¤šç†ç”±ï¼Œä½†æ˜¯åœ¨æˆ‘çœ‹æ¥ç›´åˆ‡è¦å®³çš„å°±ä¸¤æ¡ï¼š</p>
<ol>
<li>åœ¨ä»¥ callback handler ä¸ºä¸»è¦æ‰‹æ®µçš„å¼‚æ­¥é€»è¾‘å¤„ç†ä¸­ï¼Œä¼ é€’é”™è¯¯ç æ¯”èµ·ä¼ é€’å¼‚å¸¸è¦è½»æ¾ä¸”è‡ªç„¶çš„è®¸å¤šï¼Œå› ä¸ºå¾ˆå¯èƒ½å‘ç”Ÿé”™è¯¯å’Œå¤„ç†é”™è¯¯ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹<br>åˆ«å¿˜äº† exception ptr ä¹Ÿæ˜¯ç›´åˆ° C++ 11 æ‰è¢«æ­£å¼å¼•å…¥ï¼Œå¹¶ä¸”ä½¿ç”¨é—¨æ§›æ›´é«˜</li>
<li>ä¸ç®¡å‡ºäºä½•ç§åŸå› ï¼Œæœ‰äº›å¼€å‘é¢†åŸŸä¼šé»˜è®¤ç¦ç”¨å¼‚å¸¸</li>
</ol>
<h2 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h2><p>æ·±å…¥æ¢ç©¶æ¯ä¸ªå…·ä½“ç±»å‹å‰ï¼Œæœ€å¥½å…ˆäº†è§£ä¸€ä¸‹è¿™å¥—ä½“ç³»çš„ç›®çš„ï¼Œçœ‹çœ‹å®ƒæƒ³è§£å†³çš„é—®é¢˜ã€‚</p>
<p>ç³»åˆ—æ–‡ç« ç»™å‡ºçš„ç›®çš„å¯ä»¥å½’ç»“ä¸ºä¸‰ç‚¹ï¼š</p>
<ol>
<li>ç»Ÿä¸€ Windows å’Œ POSIX å¹³å°ä¸Šçš„é”™è¯¯ç æœºåˆ¶ï¼Œå°¤å…¶æ˜¯å¤„ç†é”™è¯¯è¿™å—</li>
<li>èƒ½å¤Ÿæ”¯æŒä¿å­˜æœ€åŸå§‹çš„é”™è¯¯ç ï¼Œç”¨ä»¥æŸ¥é”™æ”¯æŒ</li>
<li>å…è®¸ç”¨æˆ·æ ¹æ®è‡ªèº«éœ€æ±‚å®ç°æ‰©å±•</li>
</ol>
<p>å…¶ä¸­å‰ä¸¤ç‚¹é’ˆå¯¹çš„æ˜¯è°ƒç”¨ C lib å‡½æ•°ä»¥åŠå¹³å°æä¾›çš„å‡½æ•°è°ƒç”¨ï¼Œä¾‹å¦‚ Win32 APIã€‚å› ä¸º ASIO æ˜¯ä¸€ä¸ªIOäº‹ä»¶æ¡†æ¶ç½‘ç»œåº“ï¼Œéœ€è¦å¯†åˆ‡åœ°å’Œç³»ç»Ÿæ‰“äº¤é“ã€‚</p>
<p>å¯¹äº POSIX ç³»ç»Ÿæ¥è¯´ï¼Œä¸ç®¡æ˜¯ C lib å‡½æ•°è¿˜æ˜¯ syscallï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡ï¼š</p>
<ul>
<li>å‡½æ•°è¿”å›é 0</li>
<li>è®¾ç½® <code>errno</code> ä¸ºå…·ä½“é”™è¯¯ç ï¼Œä¾‹å¦‚ <code>EINVAL</code></li>
</ul>
<p>æ¥åšé”™è¯¯æ±‡æŠ¥ã€‚</p>
<p>è€Œ Windows ä¸Šå°±å¤æ‚è®¸å¤šï¼š</p>
<ul>
<li>msvcrt æä¾›çš„ C lib å‡½æ•°ä¹Ÿä¼šä½¿ç”¨ <code>errno</code>ï¼Œå¹¶ä¸”å‡ºäºå…¼å®¹æ€§ï¼Œmsvcrt æä¾›äº†å¤§éƒ¨åˆ† POSIX <code>errno</code> çš„<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/cpp/c-runtime-library/errno-constants">å®šä¹‰</a>ï¼Œä½†æ˜¯ç›¸å½“ä¸€éƒ¨åˆ†é”™è¯¯ç ä¸ä¼šè¢« Windows ä½¿ç”¨</li>
<li>Win32 API çš„å…·ä½“é”™è¯¯ç éœ€è¦é€šè¿‡ <code>GetLastError()</code> è·å–</li>
<li>ç½‘ç»œ socket ç›¸å…³çš„å‡½æ•°ï¼Œä¸ç®¡æ˜¯ BSD&#x2F;socket compliant çš„å‡½æ•°ï¼Œè¿˜æ˜¯ <code>WSA-</code> æ‰“å¤´çš„ä¸“æœ‰å‡½æ•°ï¼Œéƒ½å¾—ä½¿ç”¨ <code>WSAGetLastError()</code> <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/winsock/windows-sockets-error-codes-2">è·å–</a></li>
</ul>
<p>æˆ‘è¦æ˜¯ Christopher æˆ‘ä¹Ÿèƒ½ç»™çƒ¦æ­»â€¦</p>
<p>è‡³äºç¬¬ä¸‰ç‚¹ä¹Ÿæ˜¯ç†æ‰€å½“ç„¶ï¼Œå¦‚æœä½ è¿™å¥—é”™è¯¯ç ä½“ç³»ç”¨æˆ·è‡ªèº«çš„ä»£ç é€»è¾‘è¿˜ä¸èƒ½ä½¿ç”¨ï¼Œé‚£è¿˜ä¸å¦‚å›é€€åˆ°æœ€åŸå§‹çš„ int é”™è¯¯ç æ—¶ä»£å‘¢ã€‚</p>
<p>å¹¶ä¸”è®¾è®¡ä¸Šæœ€å¥½ä¿ç•™è¶³å¤Ÿçš„çµæ´»æ€§ï¼Œè®©ç”¨æˆ·ä»£ç <strong>ç”¨</strong>èµ·æ¥ç‰¹åˆ«èˆ’æœã€‚</p>
<p>åæ§½ä¸€å¥ï¼Œåœ¨ä½¿ç”¨ä½“éªŒä¸Šï¼Œæˆ‘è§‰å¾— abseil çš„ <code>Status</code>&#x2F;<code>StatusOr</code> åšçš„æ˜¯çœŸçš„æŒºå·®çš„ ğŸ¤£</p>
<h2 id="std-error-code"><a href="#std-error-code" class="headerlink" title="std::error_code"></a>std::error_code</h2><p><code>std::error_code</code> ç”¨ 0&#x2F;unset æ¥è¡¨ç¤ºæˆåŠŸï¼Œè¿™ä¸ªå±äºæ²¿è¢­ä¼ ç»Ÿäº†ã€‚å¹¶ä¸”å®šä¹‰äº† <code>operator bool</code> æ‰€ä»¥ä½¿ç”¨ä¸Šå¯ä»¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::error_code ec;</span><br><span class="line"><span class="comment">// use with ec</span></span><br><span class="line"><span class="keyword">if</span> (ec) &#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦å¤– <code>std::error_code</code> ä¿å­˜çš„æ˜¯è°ƒç”¨è¿”å›çš„<strong>åŸå§‹å€¼</strong>ï¼Œæ‰€ä»¥ç”¨ <code>ec.value()</code> è·å–çš„å…·ä½“å€¼<strong>å¯èƒ½</strong>æ˜¯å¹³å°ç›¸å…³çš„ã€‚</p>
<p>ä»¥ç³»åˆ—æ–‡ç« ä¸­çš„ä¾‹å­æ¥è¯´ï¼šè°ƒç”¨ <code>create_directory()</code> å¦‚æœå› ä¸ºæ–‡ä»¶å¤¹å·²ç»å­˜åœ¨è€Œå¤±è´¥ï¼Œåœ¨ POSIX ä¸Šè¿™ä¸ªå€¼æ˜¯ <code>EEXIST</code>ï¼Œä½†æ˜¯åœ¨ Windows ä¸Šåˆ™æ˜¯ <code>ERROR_ALREADY_EXISTS</code>ï¼Œå®ƒä»¬çš„å…·ä½“æ•°å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>æ‰€ä»¥å¯ä»¥å¾—å‡ºæ¨è®ºï¼šå¦‚æœéœ€è¦é’ˆå¯¹ç‰¹å®šé”™è¯¯è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”è¿™ä¸ªé”™è¯¯æ¥æºæ˜¯<strong>å¹³å°è°ƒç”¨</strong>ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>ec.value()</code> æœ‰å¾ˆé«˜çš„æ¦‚ç‡æ˜¯ç”¨é”™äº†ã€‚</p>
<p>ğŸ’¡ æ³¨æ„åˆ°ä¸Šæ–‡åŠ ç²—çš„â€œå¯èƒ½â€äºŒå­—ï¼Œåé¢ä¼šä»‹ç»ä¾‹å¤–æƒ…å†µ</p>
<p>ä¸€èˆ¬æ¥è¯´åŸå§‹å€¼çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯å†™æ—¥å¿—è¿™ç§ report error çš„åœºåˆï¼Œç”¨ä»¥åç»­è¾…åŠ© trouble shootingã€‚</p>
<h2 id="std-error-condition"><a href="#std-error-condition" class="headerlink" title="std::error_condition"></a>std::error_condition</h2><p><code>std::error_condition</code> çš„è®¾è®¡ç›®çš„å°±æ˜¯ç”¨ä½œï¼šå¤„ç†æŸç§é”™è¯¯æƒ…å†µï¼ˆ<em>error condition</em>)</p>
<p>æŸç§é”™è¯¯æƒ…å†µå…¶å®æ˜¯ä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡æ¦‚å¿µï¼Œä¹Ÿåº”è¯äº†è®¡ç®—æœºç§‘å­¦ä¸­åˆ›å»ºä¸€ä¸ªä¸­é—´å±‚æ¥è§£å†³é—®é¢˜çš„æ€è·¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ª <code>file_exists</code> çš„ error conditionï¼Œæ—¢èƒ½è¡¨ç¤º POSIX ä¸Šçš„ <code>EEXIST</code>ï¼Œä¹Ÿèƒ½è¡¨ç¤º Windows ä¸Šå¯¹åº” <code>ERROR_ALREADY_EXISTS</code>ã€‚</p>
<p>è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±èƒ½å¤„ç†è¿™ç§ç‰¹å®šçš„é”™è¯¯æƒ…å†µäº†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::error_code ec;</span><br><span class="line"><span class="built_in">create_directory</span>(<span class="string">&quot;/some/path&quot;</span>, ec);</span><br><span class="line"><span class="keyword">if</span> (ec == file_exists) &#123;</span><br><span class="line">    <span class="comment">// handle already exists</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ›´ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ª <code>low_system_resource</code> çš„ error conditionï¼Œæ—¢èƒ½è¡¨ç¤ºç³»ç»Ÿå†…å­˜èµ„æºä¸è¶³ï¼Œä¹Ÿèƒ½è¡¨ç¤ºç³»ç»Ÿç£ç›˜ä¸è¶³ï¼›å³æˆ‘ä»¬å°†å¤šä¸ªåŸºæœ¬çš„ error code&#x2F;case å…³è”åˆ°ä¸€ä¸ª error condition ä¸Šã€‚</p>
<p>æ‰€ä»¥å¦‚ä½•å®šä¹‰ error conditionï¼Œå…¶å®ç€é‡è€ƒè™‘çš„æ˜¯ï¼šåœ¨æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œéœ€è¦ä»å“ªäº›æƒ…å†µæ¥å¤„ç†è¿™äº›é”™è¯¯ï¼›ä¾§é‡ç‚¹æ˜¯<strong>å¦‚ä½•å¤„ç†é”™è¯¯</strong>ã€‚</p>
<p>ç³»åˆ—æ–‡ç« ä¸­å°± error condition çš„æŠ½è±¡æ„ä¹‰è¿˜ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼šå‡è®¾ä½ æ˜¯ä¸€ä¸ª database çš„ä½œè€…ï¼Œä½ éœ€è¦æä¾›ä¸€äº›æ¦‚å¿µä¸Šçš„ error codes è®©ç”¨æˆ·é’ˆå¯¹æ€§å¤„ç†ã€‚å¯¹äºâ€œè¡¨ä¸å­˜åœ¨â€è¿™ç§é”™è¯¯ï¼Œä»è®¾è®¡å±‚é¢ä¸Šçœ‹æš´éœ²ç»™ç”¨æˆ· table_not_exist è‚¯å®šæ˜¯è¦å¥½è¿‡ç›´æ¥æš´éœ² no_such_file_or_directory ç”šè‡³äº ENOENT è¿™ç§æ— æ„ä¹‰æš´éœ²å†…éƒ¨ç»†èŠ‚çš„ã€‚</p>
<h3 id="std-errc"><a href="#std-errc" class="headerlink" title="std::errc"></a>std::errc</h3><p>C++ æ ‡å‡†åº“å®šä¹‰äº†ä¸€ä¸ª <code>enum class std::errc</code>ï¼Œæ¯ä¸ª entry éƒ½å¯¹åº”ï¼ˆèƒ½è‡ªåŠ¨è½¬æ¢ä¸º <code>std::error_condition</code>ï¼‰ä¸€ä¸ª error conditionã€‚</p>
<p>äº‹å®ä¸Šï¼Œè¿™ä¸ª <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/error/errc">errc</a> æ˜¯æ ¹æ® POSIX errno list å‡ ä¹ 1:1 å»ºæ¨¡çš„ï¼Œæ‰€ä»¥èƒ½è¦†ç›–å‡ ä¹æ‰€æœ‰ç³»ç»Ÿå¹³å°ç›¸å…³çš„é”™è¯¯æƒ…å†µã€‚</p>
<p><code>std::error_condition::value()</code> è¿”å›çš„å°±æ˜¯ errc ä¸­æ¯ä¸ª entry çš„ raw enum valueï¼›ç±»ä¼¼çš„ï¼Œnon-zero è¡¨ç¤ºé”™è¯¯æƒ…å†µ</p>
<h2 id="std-error-category"><a href="#std-error-category" class="headerlink" title="std::error_category"></a>std::error_category</h2><p>ä¸ç®¡æ˜¯ <code>std::error_code</code> è¿˜æ˜¯ <code>std::error_condition</code> ï¼ŒåŒä¸€ä¸ªæ•°å€¼åœ¨ä¸åŒçš„åœºåˆä¸‹ä»£è¡¨çš„æ„ä¹‰éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚error category å†³å®šäº†è¿™ä¸ª error code æˆ– error condition åº”è¯¥å¦‚ä½•è¢«è§£é‡Šã€‚</p>
<p><code>std::error_category</code> æ˜¯æŠ½è±¡åŸºç±»ï¼Œéœ€è¦æ ¹æ®éœ€æ±‚å®ç°å…·ä½“æ´¾ç”Ÿ categoryã€‚</p>
<p>æ ‡å‡†åº“æä¾›äº†å‡ ä¸ªé¢„ç½®çš„ error categoryï¼Œé‡ç‚¹æ˜¯ <code>std::system_category</code> å’Œ <code>std::generic_category</code>ã€‚</p>
<p>åœ¨ POSIX ç³»ç»Ÿä¸Šè¿™ä¿©æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œè€Œåœ¨ Windows ä¸Šï¼Œå‰è€…ç›´æ¥å¯¹åº” non-msvcrt é‚£éƒ¨åˆ†é”™è¯¯ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚ Win32 APIï¼‰ï¼Œåè€…é’ˆå¯¹ msvcrt çš„é”™è¯¯ä¸Šä¸‹æ–‡ã€‚</p>
<p>error category çš„è§£é‡ŠåŠŸèƒ½ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li><p>æä¾› <code>default_error_condition()</code> æ”¯æŒå°†ä¸€ä¸ª <code>std::error_code</code> è½¬æ¢ä¸ºå¯¹åº”çš„ <code>std::error_condition</code><br>system category é‡å†™äº†è¿™ä¸ªå‡½æ•°ï¼Œå°†èƒ½åŒ¹é… POSIX errno çš„åŸå§‹é”™è¯¯ç æ˜ å°„åˆ°å¯¹åº” POSIX errno ä¸Šå¹¶ä¸”å°è£…è¿› generic category çš„ error condition ä¸­ã€‚<br>è¿™ä¸ªå‡½æ•°ä¼šè¢«è‡ªåŠ¨åº”ç”¨äº <code>std::error_category::equivalent</code> çš„ä¸‹é¢è¿™ä¸ªé‡è½½çš„é»˜è®¤å®ç°</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Default behavior: default_error_condition(code) == condition.</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">equivalent</span><span class="params">(<span class="type">int</span> code,</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">const</span> std::error_condition&amp; condition)</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡å†™å¦å¤–ä¸€ä¸ª equivalent é‡è½½</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Default behavior: *this == code.category() &amp;&amp; code.value() == condition</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">equivalent</span><span class="params">(<span class="type">const</span> std::error_code&amp; code,</span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">int</span> condition)</span> <span class="type">const</span> <span class="keyword">noexcept</span></span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>è‡ªå·±å®šä¹‰ error category æ—¶è¿™ä¸¤éƒ¨åˆ†ï¼ˆä¸‰ä¸ªè™šå‡½æ•°ï¼‰çš„é‡å†™éƒ½æ˜¯å¯é€‰çš„ï¼›å¦‚æœä¸åšä»»ä½•è°ƒæ•´é‚£ä¹ˆè½¬æ¢å‰åéƒ½æ²¡æœ‰å˜åŒ–ã€‚</p>
<p>åœ¨è¯­ä¹‰ä¸Šï¼Œerror category çš„è¿™ä¸ªè§£é‡ŠåŠŸèƒ½çš„æœ¬è´¨æ˜¯ï¼šå®šä¹‰ä¸€ä¸ª error code å’Œä¸€ä¸ª error condition æ˜¯å¦ç­‰ä»·</p>
<p>ğŸ’¡ C++ ä¸­ equivalence å’Œ equals æ˜¯å…·æœ‰æ˜æ˜¾è¯­ä¹‰åŒºåˆ«çš„</p>
<p><code>std::error_condition::operator==</code> (operator!&#x3D; ç±»ä¼¼) å…·æœ‰å¦‚ä¸‹<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/error/error_condition/operator_cmp">é‡è½½</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// true if either code.category().equivalent(code.value(), cond) or cond.category().equivalent(code, cond.value())</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>==( <span class="type">const</span> std::error_code&amp; code,</span><br><span class="line">                 <span class="type">const</span> std::error_condition&amp; cond ) <span class="keyword">noexcept</span>;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>==( <span class="type">const</span> std::error_condition&amp; cond,</span><br><span class="line">                 <span class="type">const</span> std::error_code&amp; code ) <span class="keyword">noexcept</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¹Ÿæ˜¯å‰é¢ error code èƒ½å’Œä» errc è‡ªåŠ¨æ„å»ºçš„ error condition æ¯”è¾ƒç­‰ä»·çš„åŸºç¡€</p>
<h2 id="Practiceï¼šCreating-an-error-code"><a href="#Practiceï¼šCreating-an-error-code" class="headerlink" title="Practiceï¼šCreating an error code"></a>Practiceï¼šCreating an error code</h2><p>å†ç»§ç»­æ·±å…¥å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å¦‚ä½•åœ¨è‡ªå·±ä»£ç ä¸­è°ƒç”¨ c libs æˆ–å¹³å°è°ƒç”¨ååˆ›å»ºå¯¹åº”çš„ <code>std::error_code</code> èƒ½å¤ŸåŠ æ·±æˆ‘ä»¬çš„ç†è§£ã€‚</p>
<p>é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼Œåœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œè‚¯å®šæ˜¯å·²ç»æ‹¿åˆ°äº†é”™è¯¯ç ï¼Œä¸ç®¡æ˜¯ <code>errno</code> è¿˜æ˜¯ <code>GetLastError()</code> ç„¶åéœ€è¦å°†ä»–å°è£…è¿› error codeï¼›å¹¶ä¸”è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ˜¯ä¸åº”è¯¥éœ€è¦çŸ¥é“å…·ä½“çš„é”™è¯¯ç çš„å€¼ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åˆ›å»º error code éœ€è¦é€šè¿‡ <code>std::error_code</code> çš„æ„é€ å‡½æ•°æ¥è¿›è¡Œ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Windows</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// call c libs</span></span><br><span class="line"><span class="keyword">auto</span> fp = std::<span class="built_in">fopen</span>(path, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!fp) &#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">error_code</span>(errno, std::<span class="built_in">generic_category</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// call Win32 API</span></span><br><span class="line"><span class="keyword">if</span> (::<span class="built_in">CreatePipe</span>(&amp;fds[<span class="number">0</span>], &amp;fds[<span class="number">1</span>], &amp;sa, <span class="number">0</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">error_code</span>(::<span class="built_in">GetLastError</span>(), std::<span class="built_in">system_category</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// POSIX</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// call c libs</span></span><br><span class="line"><span class="keyword">auto</span> fp = std::<span class="built_in">fopen</span>(path, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!fp) &#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">error_code</span>(errno, std::<span class="built_in">generic_category</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// call syscall</span></span><br><span class="line"><span class="comment">// in terms of impl, you can use std::generic_category() too, but system category is more semantic</span></span><br><span class="line"><span class="comment">// compliant</span></span><br><span class="line"><span class="keyword">if</span> (::<span class="built_in">pipe</span>(fds) != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">error_code</span>(errno, std::<span class="built_in">system_category</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º POSIX errno çš„å½±å“å¤ªè¿‡æ·±è¿œï¼Œæ‰€ä»¥ä»–è¢«æ¨é€‰ä¸º generic categoryï¼›å…¶ä»–å¹³å°çš„ system category å†…éƒ¨å®ç°éœ€è¦è´Ÿè´£è‡ªå·±å¹³å°çš„é”™è¯¯ç æ˜ å°„å¹¶è½¬æ¢åˆ° generic category ä¸Šã€‚</p>
<p>è¿™ä¸ª decision ä¹Ÿå¸¦æ¥äº†å‡ ä¸ªå½±å“ï¼š</p>
<ul>
<li>POSIX ä¸Š generic category å’Œ system category åœ¨å…·ä½“å®ç°ä¸Šå¯ä»¥æ··ç”¨</li>
<li>å¯èƒ½å­˜åœ¨æœ‰å¹³å°çš„é”™è¯¯ç æ— æ³•å‡†ç¡®æ˜ å°„çš„æƒ…å†µï¼Œæ‰€ä»¥å¼•å…¥ <code>std::error_condition</code> åŒæ—¶ <code>std::errc</code> è¢«å®šä¹‰æˆäº† error conditionï¼Œä¸è¦æ±‚ lose any information</li>
<li><code>std::error_code</code> éœ€è¦ä¿ç•™åŸå§‹é”™è¯¯ç ï¼Œä¸ç„¶ä¼šå‡ºç° lose information</li>
</ul>
<p>ä¸€ä¸ª 3rd-party lib ä¹Ÿå¯ä»¥é€‰æ‹©å°†è‡ªå·±çš„ä¸šåŠ¡ error code é€‰æ‹©æ€§åœ°æ˜ å°„åˆ° generic category çš„ error condition ä¸Šï¼Œè¿™ä¹Ÿä½“ç°äº† POSIX errno çš„ genericã€‚</p>
<h3 id="what-about-std-make-error-code"><a href="#what-about-std-make-error-code" class="headerlink" title="what about std::make_error_code"></a>what about std::make_error_code</h3><p>è¿™ä¸ªå‡½æ•°çš„å­˜åœ¨æ˜¯ç»™ç±»ä¼¼ errc çš„ enum class åšéšå¼è½¬æ¢ç”¨çš„ï¼Œå³ç”¨åœ¨ error code çš„é”™è¯¯å¤„ç†æ¯”è¾ƒä¸Šã€‚</p>
<p>ä½ å¯ä»¥ç»™è‡ªå·±çš„ enum class æä¾›é‡è½½ç‰ˆæœ¬ï¼ŒC++ ä¼šåˆ©ç”¨ ADL è‡ªåŠ¨é€‰æ‹©ä½ çš„é‡è½½ï¼›æ‰€ä»¥è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ²¡æœ‰ error categoryï¼Œå› ä¸ºå¯¹åº”çš„ error category æ˜¯åœ¨å‡½æ•°å®ç°é‡ŒæŒ‡å®šçš„</p>
<h2 id="Testing-against-error-code-directly"><a href="#Testing-against-error-code-directly" class="headerlink" title="Testing against error code directly"></a>Testing against error code directly</h2><p>å‰é¢æåˆ°é’ˆå¯¹æ€§å¤„ç† error code æ—¶éœ€è¦å’Œ error condition æ¯”è¾ƒï¼Œä¾‹å¦‚ <code>std::errc</code>ï¼Œä½†æ˜¯è¿™ä¹Ÿå­˜åœ¨ä¸€äº›ä¾‹å¤–ã€‚</p>
<p>å¦‚æœä½ ä¸ºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œæˆ–è€… libraryï¼Œè®¾è®¡çš„ error code ä½“ç³»èƒ½ä¿è¯é”™è¯¯çš„åŸå§‹å€¼åœ¨ä¸åŒçš„å¹³å°ä¸åŒç¯å¢ƒéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆä½ çš„ enum class ç›´æ¥ä»£è¡¨ specific error code ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>å½“ç„¶ï¼Œå…¶å®è¿™ç§æƒ…å†µåè€Œæ˜¯å¤§å¤šæ•°æƒ…å†µâ€¦</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾ <code>http::error</code> ä»£è¡¨ http çŠ¶æ€ç ä¸­çš„é”™è¯¯ç ï¼Œé‚£ä¹ˆ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> http &#123;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">error</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  not_found = <span class="number">404</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::error_code ec;</span><br><span class="line">http::<span class="built_in">get</span>(url, ec);</span><br><span class="line"><span class="keyword">if</span> (ec) &#123;</span><br><span class="line">  <span class="comment">// http::error::not_found will implicit convert to std::error_code</span></span><br><span class="line">  <span class="keyword">if</span> (ec == http::error::not_found) &#123;</span><br><span class="line">    <span class="comment">// handle not found</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å¤„ç†é”™è¯¯æ˜¾ç„¶æ˜¯åˆç†çš„ã€‚</p>
<p>æ ‡å‡†åº“æä¾›çš„ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/io/io_errc"><code>std::io_errc</code></a> å’Œ <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/thread/future_errc"><code>std::future_errc</code></a> éƒ½æ˜¯å¯¹åº”çš„ specific error code è€Œä¸æ˜¯ error conditionã€‚</p>
<p><code>std::errc</code> çš„ç‰¹æ®Šæ€§åœ¨å‰é¢è®²è¿‡äº†ï¼Œå› ä¸ºæ— æ³•ä¿è¯å…¶ä»–å¹³å°çš„ç³»ç»Ÿè°ƒç”¨é”™è¯¯ç èƒ½å®Œç¾æ˜ å°„åˆ° POSIX errorï¼Œæ‰€ä»¥æ‰æŠ½è±¡ä¸º error conditionã€‚</p>
<h2 id="Error-enums"><a href="#Error-enums" class="headerlink" title="Error enums"></a>Error enums</h2><p>ä¸€ä¸ª error enum åœ¨è®¾è®¡ä¸Šå³å¯ä»¥é€‰æ‹©è½¬æ¢ä¸ºå¯¹åº”çš„ error code å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è½¬æ¢ä¸º error condition å¯¹è±¡ï¼Œå…·ä½“çš„è¡Œä¸ºéœ€è¦é€šè¿‡ç‰¹åŒ–ä¸‹é¢ä¸¤ä¸ª type traits å®Œæˆï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">is_error_code_enum</span></span><br><span class="line">  : <span class="keyword">public</span> false_type &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">is_error_condition_enum</span></span><br><span class="line">  : <span class="keyword">public</span> false_type &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸€ä¸ª enum class Eï¼Œåªæœ‰å½“ä½ ç‰¹åŒ–äº†ä¹‹åï¼ŒC++ æ‰ä¼šè¯•å›¾é€šè¿‡ ADL å¯»æ‰¾åŒ¹é…çš„ <code>make_error_code()</code> æˆ– <code>make_error_condition()</code>ã€‚</p>
<p>åŒæ—¶è¦æ³¨æ„è¿™ä¸¤ä¸ªæ¨¡æ¿æ˜¯å®šä¹‰åœ¨ std åå­—ç©ºé—´ä¸­ï¼Œä»–ä»¬çš„ç‰¹åŒ–ä¹Ÿè¦å®šä¹‰åœ¨ std åå­—ç©ºé—´ä¸­ã€‚</p>
<h2 id="Practice-Letâ€™s-design-our-http-client-error-family"><a href="#Practice-Letâ€™s-design-our-http-client-error-family" class="headerlink" title="Practice: Letâ€™s design our http client error-family"></a>Practice: Letâ€™s design our http client error-family</h2><p>å‰é¢ç†è®ºéƒ¨åˆ†å°†çš„å·®ä¸å¤šäº†ï¼Œç°åœ¨é€šè¿‡ç»™ä¸€ä¸ªå‡æƒ³çš„ http client library åŠ ä¸Šé”™è¯¯ç ä½“ç³»æ¥å·©å›ºç†è§£ã€‚</p>
<p>å®Œæ•´ä»£ç è§ï¼š<a target="_blank" rel="noopener" href="https://github.com/kingsamchen/Eureka/blob/master/cxx-define-specific-error-code-and-condition/errors/main.cpp">https://github.com/kingsamchen/Eureka/blob/master/cxx-define-specific-error-code-and-condition/errors/main.cpp</a></p>
<h3 id="0x0-Original-error-code"><a href="#0x0-Original-error-code" class="headerlink" title="0x0 Original error code"></a>0x0 Original error code</h3><p>HTTP status code æ¯”è¾ƒç‰¹æ®Šï¼Œ2xx ä»£è¡¨æˆåŠŸï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œè·³è¿‡ 1xx å’Œ 2xxï¼Œä» 3xx å¼€å§‹è€ƒè™‘ï¼Œå¹¶ä¸”åªä½¿ç”¨éæ­£å¸¸çŠ¶æ€ç ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> http &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Original result/error code.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">error</span> &#123;</span><br><span class="line">    <span class="comment">// Redirection</span></span><br><span class="line">    not_modified = <span class="number">304</span>,</span><br><span class="line">    temporary_redirect = <span class="number">307</span>,</span><br><span class="line">    permanent_rediret = <span class="number">308</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Client error</span></span><br><span class="line">    bad_request = <span class="number">400</span>,</span><br><span class="line">    unauthorized = <span class="number">401</span>,</span><br><span class="line">    forbidden = <span class="number">403</span>,</span><br><span class="line">    not_found = <span class="number">404</span>,</span><br><span class="line">    request_timeout = <span class="number">408</span>,</span><br><span class="line">    conflict = <span class="number">409</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Server error</span></span><br><span class="line">    internal_server_error = <span class="number">500</span>,</span><br><span class="line">    not_implemented = <span class="number">501</span>,</span><br><span class="line">    bad_gateway = <span class="number">502</span>,</span><br><span class="line">    service_unavailable = <span class="number">503</span>,</span><br><span class="line">    gateway_timeout = <span class="number">504</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">http_error_category_impl</span> : <span class="keyword">public</span> std::error_category &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">http_error_category_impl</span>() <span class="keyword">override</span> = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] <span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">name</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http_error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] <span class="function">std::string <span class="title">message</span><span class="params">(<span class="type">int</span> ev)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="built_in">static_cast</span>&lt;error&gt;(ev)) &#123;</span><br><span class="line">        <span class="keyword">case</span> error::not_modified:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Not Modified&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::temporary_redirect:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Temporary Redirect&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::permanent_rediret:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Permanent Redirect&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::bad_request:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Bad Request&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::unauthorized:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Unauthorized&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::forbidden:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Forbidden&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::not_found:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Not Found&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::request_timeout:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Request Timeout&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::conflict:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Conflict&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::internal_server_error:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Internal Server Error&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::not_implemented:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Not Implemented&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::bad_gateway:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Bad Gateway&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::service_unavailable:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Service Unavailable&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> error::gateway_timeout:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Gateway Timeout&quot;</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Unknown http error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> std::error_category&amp; <span class="title">http_error_category</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> http_error_category_impl instance;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::error_code <span class="title">make_error_code</span><span class="params">(error e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">error_code</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(e), <span class="built_in">http_error_category</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace http</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">std</span>::is_error_code_enum&lt;http::error&gt; : std::true_type &#123;&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>http::error</code> ä»£è¡¨æœ€åŸå§‹çš„ http status code</li>
<li>æä¾›äº†å¯¹åº”çš„ http error category ç”¨æ¥è§£é‡Šæ¯ä¸ªå…·ä½“çš„ code çš„å«ä¹‰ï¼›å…¶å®ç°æ˜¯ä¸ªå•ä¾‹ï¼Œè¿™æ ·æ˜¯ä»¿ç…§æ ‡å‡†åº“çš„åšæ³•</li>
<li>æœ€åæ˜¯é€šè¿‡ç‰¹åŒ– <code>std::is_error_code_enum</code> å…è®¸ä» enum åˆ° error code class çš„è‡ªåŠ¨è½¬æ¢</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·ç”¨</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">connect_always_fail</span><span class="params">(std::string_view addr, std::error_code&amp; ec)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;connecting to &quot;</span> &lt;&lt; addr &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="comment">// Because `is_error_code_enum&lt;http::error&gt;` is true, the corresponding overload is chosed,</span></span><br><span class="line">    <span class="comment">// and internally will use ADL to locate the `http::make_error_code` for error_code creation.</span></span><br><span class="line">    ec = http::error::bad_request;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::error_code ec;</span><br><span class="line">    <span class="built_in">connect_always_fail</span>(<span class="string">&quot;localhost&quot;</span>, ec);</span><br><span class="line">    <span class="keyword">if</span> (ec &amp;&amp; ec == http::error::bad_request) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;connect failed: &quot;</span> &lt;&lt; ec;</span><br><span class="line">        <span class="keyword">auto</span> econ = ec.<span class="built_in">default_error_condition</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\necon: &quot;</span> &lt;&lt; econ.<span class="built_in">value</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬æ²¡æœ‰é‡å†™ http error category çš„ <code>default_error_condition()</code> æ‰€ä»¥ä¸Šè¿°è°ƒç”¨è¿”å›çš„ error_condition åŒ…å«ç›¸åŒçš„å€¼å’Œ http error categoryï¼›è¿™åœ¨ä¸éœ€è¦ fine-tune çš„åœºæ™¯ä¸‹æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<h3 id="0x1-Using-general-condition-to-separate-client-x2F-server-errors"><a href="#0x1-Using-general-condition-to-separate-client-x2F-server-errors" class="headerlink" title="0x1 Using general condition to separate client&#x2F;server errors"></a>0x1 Using general condition to separate client&#x2F;server errors</h3><p>åœ¨ç³»åˆ—æ–‡ç« ä¸­ï¼ŒChristopher é€šè¿‡é‡å†™ <code>default_error_condition()</code> å°† http error å…³è”åˆ° <code>std::errc</code>ï¼›ä¾‹å¦‚å°† <code>http::error::unauthorized</code> å…³è”ä¸º <code>std::errc::permission_denied</code>ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æ¢ä¸€ä¸ªåšæ³•ï¼Œä¸“é—¨å®šä¹‰ error condition å°† 4xx é”™è¯¯ä» 5xx åŒºåˆ†å¼€æ¥ï¼›è¿™ä¸ªå‚è€ƒè‡ª <a target="_blank" rel="noopener" href="https://www.boost.org/doc/libs/1_81_0/libs/system/doc/html/system.html#usage_defining_library_specific_error_conditions">Boost.System â€” Defining Library-Specific Error Conditions</a>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> http &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// General condition that will be the default condition of error.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">general_condition</span> &#123;</span><br><span class="line">    need_redirect = <span class="number">1</span>, <span class="comment">// any non-zero positive value is fine.</span></span><br><span class="line">    client_side,</span><br><span class="line">    server_side,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">http_condition_category_impl</span> : <span class="keyword">public</span> std::error_category &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">http_condition_category_impl</span>() <span class="keyword">override</span> = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] <span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">name</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http_condition&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] <span class="function">std::string <span class="title">message</span><span class="params">(<span class="type">int</span> cond)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="built_in">static_cast</span>&lt;general_condition&gt;(cond)) &#123;</span><br><span class="line">        <span class="keyword">case</span> general_condition::need_redirect:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Need redirect request&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> general_condition::client_side:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Client side error&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> general_condition::server_side:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Server side error&quot;</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Unknown http general condition&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> std::error_category&amp; <span class="title">http_general_condition_category</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> http_condition_category_impl instance;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::error_condition <span class="title">make_error_condition</span><span class="params">(general_condition e)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">error_condition</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(e), <span class="built_in">http_general_condition_category</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace http</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">std</span>::is_error_condition_enum&lt;http::general_condition&gt; : std::true_type &#123;&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>error condition enum çš„å€¼åªè¦ä¸ä¸º0å°±è¡Œï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæˆ‘ä»¬å¹¶ä¸å…³å¿ƒ</li>
<li>è¿™ä¸ª general condition åŒæ ·éœ€è¦è‡ªå·±çš„ general condition category æ¥è¿›è¡Œè§£é‡Š</li>
<li>è¿™æ¬¡æ˜¯é€šè¿‡ç‰¹åŒ– <code>std::is_error_condition_enum</code> å…è®¸åˆ° error condition çš„è‡ªåŠ¨è½¬æ¢</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬è¦é‡å†™ <code>http_error_category_impl::default_error_condition()</code> å°† http error å…³è”åˆ° general conditionï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">http_error_category_impl</span> : <span class="keyword">public</span> std::error_category &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    [[nodiscard]]</span><br><span class="line">    <span class="function">std::error_condition <span class="title">default_error_condition</span><span class="params">(<span class="type">int</span> val)</span> <span class="type">const</span> <span class="keyword">noexcept</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (val / <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">make_error_condition</span>(general_condition::need_redirect);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">make_error_condition</span>(general_condition::client_side);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">make_error_condition</span>(general_condition::server_side);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">// fallback to error_code self value.</span></span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">error_condition</span>(val, *<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å¤„ç†é”™è¯¯æ—¶åˆ¤æ–­æŸä¸ª error code æ˜¯ client side error è¿˜æ˜¯ server side error äº†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">connect_always_fail</span><span class="params">(std::string_view addr, <span class="type">int</span> mock_resp_status, std::error_code&amp; ec)</span> </span>&#123;</span><br><span class="line">    fmt::<span class="built_in">println</span>(<span class="string">&quot;connecting to &#123;&#125;&quot;</span>, addr);</span><br><span class="line">    <span class="comment">// Because `is_error_code_enum&lt;http::error&gt;` is true, the corresponding overload is chosed,</span></span><br><span class="line">    <span class="comment">// and internally will use ADL to locate the `http::make_error_code` for error_code creation.</span></span><br><span class="line">    ec = <span class="built_in">static_cast</span>&lt;http::error&gt;(mock_resp_status);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::error_code ec;</span><br><span class="line"><span class="built_in">connect_always_fail</span>(<span class="string">&quot;localhost&quot;</span>, <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(http::error::bad_request), ec);</span><br><span class="line"><span class="built_in">assert</span>(ec);</span><br><span class="line"><span class="built_in">assert</span>(ec == http::error::bad_request);</span><br><span class="line"><span class="built_in">assert</span>(ec == http::general_condition::client_side);</span><br></pre></td></tr></table></figure>

<h3 id="0x3-Extending-error-handling-condition"><a href="#0x3-Extending-error-handling-condition" class="headerlink" title="0x3 Extending error handling condition"></a>0x3 Extending error handling condition</h3><p>å‰é¢æåˆ°è¿™å¥—é”™è¯¯ç ç³»ç»Ÿæ˜¯é«˜åº¦å¯æ‰©å±•çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±é’ˆå¯¹æŸä¸ª http error æ˜¯å¦å¯é‡è¯•è¿›è¡Œæ‰©å±•ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> http &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Operation condition</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">operation_condition</span> &#123;</span><br><span class="line">    should_retry = <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">http_operation_condition_category_impl</span> : <span class="keyword">public</span> std::error_category &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">http_operation_condition_category_impl</span>() <span class="keyword">override</span> = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] <span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">name</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http_operation_condition&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] <span class="function">std::string <span class="title">message</span><span class="params">(<span class="type">int</span> val)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="built_in">static_cast</span>&lt;operation_condition&gt;(val)) &#123;</span><br><span class="line">        <span class="keyword">case</span> operation_condition::should_retry:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Should retry later&quot;</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Unknown http operation condition&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] <span class="function"><span class="type">bool</span> <span class="title">equivalent</span><span class="params">(<span class="type">const</span> std::error_code&amp; ec, <span class="type">int</span> val)</span> <span class="type">const</span> <span class="keyword">noexcept</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="built_in">static_cast</span>&lt;operation_condition&gt;(val)) &#123;</span><br><span class="line">        <span class="keyword">case</span> operation_condition::should_retry:</span><br><span class="line">            <span class="keyword">return</span> ec == error::gateway_timeout ||</span><br><span class="line">                   ec == error::conflict ||</span><br><span class="line">                   ec == error::request_timeout ||</span><br><span class="line">                   ec == error::service_unavailable;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> std::error_category&amp; <span class="title">http_operation_condition_category</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> http_operation_condition_category_impl instance;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::error_condition <span class="title">make_error_condition</span><span class="params">(operation_condition e)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">error_condition</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(e), <span class="built_in">http_operation_condition_category</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace http</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">std</span>::is_error_condition_enum&lt;http::operation_condition&gt; : std::true_type &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>éå¸¸ç±»ä¼¼çš„åšæ³•ï¼Œåªä¸è¿‡è¿™æ¬¡æˆ‘ä»¬é‡å†™äº† <code>http_operation_condition_category_impl::equivalent()</code> é’ˆå¯¹ error code çš„é‡è½½ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ä¹Ÿå¯ä»¥åšåˆ°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::error_code ec;</span><br><span class="line"><span class="built_in">connect_always_fail</span>(<span class="string">&quot;localhost&quot;</span>, <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(http::error::bad_request), ec);</span><br><span class="line"><span class="built_in">assert</span>(ec);</span><br><span class="line"><span class="built_in">assert</span>(ec == http::error::bad_request);</span><br><span class="line"><span class="built_in">assert</span>(ec == http::general_condition::client_side);</span><br><span class="line"><span class="built_in">assert</span>(ec != http::operation_condition::should_retry);</span><br></pre></td></tr></table></figure>

<p>æ€è€ƒä¸€ä¸‹ä¸éš¾å‘ç°ï¼Œè™½ç„¶ error code å…³è”çš„ default error condition åªèƒ½æœ‰ä¸€ä¸ªï¼Œä½†æ˜¯å‚ä¸é”™è¯¯å¤„ç†çš„ error condition æ˜¯å¯ä»¥éšæ„æ‰©å±•çš„ï¼Œåªè¦é‡å†™ error condition category çš„ equivalence å°±è¡Œã€‚</p>
<p>è¿™æ ·å°±èƒ½åšåˆ°åŒä¸€ä¸ªå…·ä½“é”™è¯¯åœ¨ä¸åŒæŠ½è±¡å±‚æ¬¡ä¸åŒè¯­ä¹‰ä¸‹çš„å¤„ç†</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a target="_blank" rel="noopener" href="http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-1.html">system-error-support-in-c0x-part-1.html</a><br><a target="_blank" rel="noopener" href="http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-2.html">system-error-support-in-c0x-part-2.html</a><br><a target="_blank" rel="noopener" href="http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-3.html">system-error-support-in-c0x-part-3.html</a><br><a target="_blank" rel="noopener" href="http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-4.html">system-error-support-in-c0x-part-4.html</a><br><a target="_blank" rel="noopener" href="http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-5.html">system-error-support-in-c0x-part-5.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.boost.org/doc/libs/1_81_0/libs/system/doc/html/system.html">Boost.System Library</a></p>
</div><div class="tags"><a href="/tags/cpp/"><i class="fa fa-tag"></i>cpp</a><a href="/tags/error-handling/"><i class="fa fa-tag"></i>error handling</a></div><div class="post-nav"><a class="pre" href="/2024/02/26/weekly-2024-feb-4/">ä¸€å‘¨æ‚è®° in Week 4 Feb 2024</a><a class="next" href="/2024/02/19/weekly-2024-feb-3/">ä¸€å‘¨æ‚è®° in Week 3 Feb 2024</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">é˜…è¯»è¯„è®ºï¼ˆè¯·ç¡®ä¿ Disqus å¯ä»¥æ­£å¸¸åŠ è½½ï¼‰</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://kingsamchen.github.io/2024/02/25/dive-into-error-code-error-condition-and-error-category-in-cxx/';
    this.page.identifier = '2024/02/25/dive-into-error-code-error-condition-and-error-category-in-cxx/';
    this.page.title = 'Dive into error_code, error_condition and error_category in C++';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//kingsamchen-github-io.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//kingsamchen-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://kingsamchen-github-io.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://kingsamchen.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CODE-LIFE/">CODE-LIFE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PROGRAMMING/">PROGRAMMING</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/05/05/weekly-2025-may-1/">ä¸€å‘¨æ‚è®° in Week 1 May 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/04/28/weekly-2025-apr-4/">ä¸€å‘¨æ‚è®° in Week 4 Apr 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/04/21/weekly-2025-apr-3/">ä¸€å‘¨æ‚è®° in Week 3 Apr 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/04/13/weekly-2025-apr-2/">ä¸€å‘¨æ‚è®° in Week 2 Apr 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/04/07/weekly-2025-apr-1/">ä¸€å‘¨æ‚è®° in Week 1 Apr 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/30/weekly-2025-mar-4/">ä¸€å‘¨æ‚è®° in Week 4 Mar 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/24/weekly-2025-mar-3/">ä¸€å‘¨æ‚è®° in Week 3 Mar 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/18/weekly-2025-mar-2/">ä¸€å‘¨æ‚è®° in Week 2 Mar 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/11/weekly-2025-mar-1/">ä¸€å‘¨æ‚è®° in Week 1 Mar 2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/04/weekly-2025-feb-4/">ä¸€å‘¨æ‚è®° in Week 4 Feb 2025</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/rant/" style="font-size: 15px;">rant</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/crash/" style="font-size: 15px;">crash</a> <a href="/tags/breakpad/" style="font-size: 15px;">breakpad</a> <a href="/tags/cpp/" style="font-size: 15px;">cpp</a> <a href="/tags/exception/" style="font-size: 15px;">exception</a> <a href="/tags/memory-fence/" style="font-size: 15px;">memory fence</a> <a href="/tags/memory-ordering/" style="font-size: 15px;">memory ordering</a> <a href="/tags/multiple-instance/" style="font-size: 15px;">multiple instance</a> <a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/enum/" style="font-size: 15px;">enum</a> <a href="/tags/flag/" style="font-size: 15px;">flag</a> <a href="/tags/bitwise%EF%BC%8C-SFINAE/" style="font-size: 15px;">bitwiseï¼Œ SFINAE</a> <a href="/tags/KBase/" style="font-size: 15px;">KBase</a> <a href="/tags/command-line/" style="font-size: 15px;">command-line</a> <a href="/tags/abstraction/" style="font-size: 15px;">abstraction</a> <a href="/tags/%E6%A2%AF%E5%AD%90/" style="font-size: 15px;">æ¢¯å­</a> <a href="/tags/shadowsocks/" style="font-size: 15px;">shadowsocks</a> <a href="/tags/trojan/" style="font-size: 15px;">trojan</a> <a href="/tags/socat/" style="font-size: 15px;">socat</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/design/" style="font-size: 15px;">design</a> <a href="/tags/environment/" style="font-size: 15px;">environment</a> <a href="/tags/buddy-allocator/" style="font-size: 15px;">buddy-allocator</a> <a href="/tags/algorithms/" style="font-size: 15px;">algorithms</a> <a href="/tags/C-17/" style="font-size: 15px;">C++ 17</a> <a href="/tags/string-view/" style="font-size: 15px;">string_view</a> <a href="/tags/tokenizer/" style="font-size: 15px;">tokenizer</a> <a href="/tags/asio/" style="font-size: 15px;">asio</a> <a href="/tags/cmake/" style="font-size: 15px;">cmake</a> <a href="/tags/anvil/" style="font-size: 15px;">anvil</a> <a href="/tags/project-management/" style="font-size: 15px;">project management</a> <a href="/tags/atoi/" style="font-size: 15px;">atoi</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/cfs/" style="font-size: 15px;">cfs</a> <a href="/tags/non-capturing-lambda/" style="font-size: 15px;">non-capturing lambda</a> <a href="/tags/function-pointer/" style="font-size: 15px;">function pointer</a> <a href="/tags/obs-studio/" style="font-size: 15px;">obs-studio</a> <a href="/tags/inno-setup/" style="font-size: 15px;">inno setup</a> <a href="/tags/installer/" style="font-size: 15px;">installer</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Unix/" style="font-size: 15px;">Unix</a> <a href="/tags/signal/" style="font-size: 15px;">signal</a> <a href="/tags/signalfd/" style="font-size: 15px;">signalfd</a> <a href="/tags/self-pipe-trick/" style="font-size: 15px;">self-pipe trick</a> <a href="/tags/cant/" style="font-size: 15px;">cant</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/HandlerThread/" style="font-size: 15px;">HandlerThread</a> <a href="/tags/Looper/" style="font-size: 15px;">Looper</a> <a href="/tags/Handler/" style="font-size: 15px;">Handler</a> <a href="/tags/MessageLoop/" style="font-size: 15px;">MessageLoop</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/proxy/" style="font-size: 15px;">proxy</a> <a href="/tags/thread-pool/" style="font-size: 15px;">thread-pool</a> <a href="/tags/chromium/" style="font-size: 15px;">chromium</a> <a href="/tags/urlfetcher/" style="font-size: 15px;">urlfetcher</a> <a href="/tags/wireshark/" style="font-size: 15px;">wireshark</a> <a href="/tags/localhost/" style="font-size: 15px;">localhost</a> <a href="/tags/source-internals/" style="font-size: 15px;">source internals</a> <a href="/tags/message-loop/" style="font-size: 15px;">message-loop</a> <a href="/tags/SFINAE/" style="font-size: 15px;">SFINAE</a> <a href="/tags/template/" style="font-size: 15px;">template</a> <a href="/tags/visual-studio/" style="font-size: 15px;">visual studio</a> <a href="/tags/libx264/" style="font-size: 15px;">libx264</a> <a href="/tags/vcpkg/" style="font-size: 15px;">vcpkg</a> <a href="/tags/shared-ptr/" style="font-size: 15px;">shared_ptr</a> <a href="/tags/type-injection/" style="font-size: 15px;">type injection</a> <a href="/tags/shared-ptr-internals/" style="font-size: 15px;">shared_ptr-internals</a> <a href="/tags/source-code-study/" style="font-size: 15px;">source-code-study</a> <a href="/tags/weak-ptr/" style="font-size: 15px;">weak_ptr</a> <a href="/tags/base-lib/" style="font-size: 15px;">base lib</a> <a href="/tags/tag-dispatching/" style="font-size: 15px;">tag dispatching</a> <a href="/tags/boost/" style="font-size: 15px;">boost</a> <a href="/tags/libstdc/" style="font-size: 15px;">libstdc++</a> <a href="/tags/gcc/" style="font-size: 15px;">gcc</a> <a href="/tags/clang/" style="font-size: 15px;">clang</a> <a href="/tags/sfinae/" style="font-size: 15px;">sfinae</a> <a href="/tags/google-breakpad/" style="font-size: 15px;">google-breakpad</a> <a href="/tags/invalid-paramter/" style="font-size: 15px;">invalid paramter</a> <a href="/tags/operator/" style="font-size: 15px;">operator[]</a> <a href="/tags/owner-semantics/" style="font-size: 15px;">owner semantics</a> <a href="/tags/view-semantics/" style="font-size: 15px;">view semantics</a> <a href="/tags/msvc/" style="font-size: 15px;">msvc</a> <a href="/tags/ebo/" style="font-size: 15px;">ebo</a> <a href="/tags/multiple-inheritance/" style="font-size: 15px;">multiple inheritance</a> <a href="/tags/Visual-Studio/" style="font-size: 15px;">Visual Studio</a> <a href="/tags/debugger/" style="font-size: 15px;">debugger</a> <a href="/tags/UTF-8/" style="font-size: 15px;">UTF-8</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/haskell/" style="font-size: 15px;">haskell</a> <a href="/tags/infix-operator/" style="font-size: 15px;">infix operator</a> <a href="/tags/error-handling/" style="font-size: 15px;">error handling</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mint/" style="font-size: 15px;">mint</a> <a href="/tags/%E7%A3%81%E7%9B%98/" style="font-size: 15px;">ç£ç›˜</a> <a href="/tags/%E6%89%A9%E5%AE%B9/" style="font-size: 15px;">æ‰©å®¹</a> <a href="/tags/line-ending/" style="font-size: 15px;">line ending</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://www.daozhihun.com/" title="åˆ€ä¹‹é­‚ | å¤§æœ¨è€å¸ˆæˆé•¿æ—¥è®°" target="_blank">åˆ€ä¹‹é­‚ | å¤§æœ¨è€å¸ˆæˆé•¿æ—¥è®°</a><ul></ul><a href="https://blog.nlogn.cn/" title="å¸§å“¥ | ç¡…è°·è°ˆæ’¸ç®¡" target="_blank">å¸§å“¥ | ç¡…è°·è°ˆæ’¸ç®¡</a><ul></ul><a href="https://blog.chichou.me/" title="ChiChou | é¦–å¸­å®‰å…¨åœ°çƒä»ªåˆ‡å›¾æ€»å¥¸" target="_blank">ChiChou | é¦–å¸­å®‰å…¨åœ°çƒä»ªåˆ‡å›¾æ€»å¥¸</a><ul></ul><a href="https://fleurer.github.io/" title="Fleurer-lee | Få”çš„è¯»ä¹¦ç¬”è®°ï¼ˆå¤§é‡å¹²è´§ï¼‰" target="_blank">Fleurer-lee | Få”çš„è¯»ä¹¦ç¬”è®°ï¼ˆå¤§é‡å¹²è´§ï¼‰</a><ul></ul><a href="https://vizee.org/" title="Vizee | å³å°†èµ°ä¸Šäººç”Ÿå·…å³°æ¨èè‰çš„ç« æ€»" target="_blank">Vizee | å³å°†èµ°ä¸Šäººç”Ÿå·…å³°æ¨èè‰çš„ç« æ€»</a><ul></ul><a href="https://blog.thecjw.me/" title="TheCJW | çˆ±å¼¹æ£‰èŠ±çš„å°ä¼Ÿ" target="_blank">TheCJW | çˆ±å¼¹æ£‰èŠ±çš„å°ä¼Ÿ</a><ul></ul><a href="https://newbiecoder.0ginr.com/blog/" title="Newbie Coder | èŒèŒå“’çš„ç‚‰å­" target="_blank">Newbie Coder | èŒèŒå“’çš„ç‚‰å­</a><ul></ul><a href="https://frankpie.github.io/" title="è£´è‰è“ | æ„¤æ€’çš„è€å¸æœº" target="_blank">è£´è‰è“ | æ„¤æ€’çš„è€å¸æœº</a><ul></ul><a href="https://beanbee.me/" title="é™ˆè€å¸ˆ | Beanbee.Max" target="_blank">é™ˆè€å¸ˆ | Beanbee.Max</a><ul></ul><a href="https://sunus.me/" title="Sunus | æå¸ˆå‚…é£Ÿå“å‚CEO" target="_blank">Sunus | æå¸ˆå‚…é£Ÿå“å‚CEO</a><ul></ul><a href="http://www.tolower.net/" title="Lower | å–Šå¤§æœ¨å¤§å“¥çš„å°å¼Ÿ" target="_blank">Lower | å–Šå¤§æœ¨å¤§å“¥çš„å°å¼Ÿ</a><ul></ul><a href="http://mrljdx.com/" title="Mrljdx | å¤§ä¿å¥è€å¸æœº" target="_blank">Mrljdx | å¤§ä¿å¥è€å¸æœº</a><ul></ul><a href="https://www.mydavelv.net/" title="Davelv | æ±Ÿæ¹–äººç§°å¤§å°¾é©´" target="_blank">Davelv | æ±Ÿæ¹–äººç§°å¤§å°¾é©´</a></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div><script type="text/javascript" src="//kingsamchen-github-io.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2025 <a href="/." rel="nofollow">KCçš„åºŸå¢Ÿå †.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>
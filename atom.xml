<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>KC的废墟堆</title>
  
  <subtitle>Will you serve in Heaven, or rule in Hell</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://kingsamchen.github.io/"/>
  <updated>2022-06-06T05:32:06.482Z</updated>
  <id>http://kingsamchen.github.io/</id>
  
  <author>
    <name>Kingsley Chen</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一周杂记 in Week 1 June 2022</title>
    <link href="http://kingsamchen.github.io/2022/06/05/weekly-2022-jun-1/"/>
    <id>http://kingsamchen.github.io/2022/06/05/weekly-2022-jun-1/</id>
    <published>2022-06-05T14:13:01.000Z</published>
    <updated>2022-06-06T05:32:06.482Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot;
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 4 May 2022</title>
    <link href="http://kingsamchen.github.io/2022/05/29/weekly-2022-may-4/"/>
    <id>http://kingsamchen.github.io/2022/05/29/weekly-2022-may-4/</id>
    <published>2022-05-29T15:43:18.000Z</published>
    <updated>2022-05-29T16:03:45.657Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot;
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 3 May 2022</title>
    <link href="http://kingsamchen.github.io/2022/05/22/weekly-2022-may-3/"/>
    <id>http://kingsamchen.github.io/2022/05/22/weekly-2022-may-3/</id>
    <published>2022-05-22T15:23:17.000Z</published>
    <updated>2022-05-22T16:10:06.787Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot;
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 2 May 2022</title>
    <link href="http://kingsamchen.github.io/2022/05/15/weekly-2022-may-2/"/>
    <id>http://kingsamchen.github.io/2022/05/15/weekly-2022-may-2/</id>
    <published>2022-05-15T14:22:59.000Z</published>
    <updated>2022-05-15T14:57:32.406Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot;
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 1 May 2022</title>
    <link href="http://kingsamchen.github.io/2022/05/08/weekly-2022-may-1/"/>
    <id>http://kingsamchen.github.io/2022/05/08/weekly-2022-may-1/</id>
    <published>2022-05-08T14:08:40.000Z</published>
    <updated>2022-05-08T14:08:20.993Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot;
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>实现 subprocess 中踩过的坑</title>
    <link href="http://kingsamchen.github.io/2022/05/03/lesson-learned-from-writing-subprocess/"/>
    <id>http://kingsamchen.github.io/2022/05/03/lesson-learned-from-writing-subprocess/</id>
    <published>2022-05-03T15:50:30.000Z</published>
    <updated>2022-05-04T13:22:23.770Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;&lt;code&gt;subprocess&lt;/code&gt; 是我为 Lumper 实现的一个基础类，主要功能是创建子进程运行指定的 executable，同时支持 I/O 重定向和 clone flags。&lt;/p&gt;
&lt;p&gt;因为 Lumper 的目的是实现一个类似 Docker
        
      
    
    </summary>
    
      <category term="PROGRAMMING" scheme="http://kingsamchen.github.io/categories/PROGRAMMING/"/>
    
    
      <category term="cpp" scheme="http://kingsamchen.github.io/tags/cpp/"/>
    
      <category term="Linux" scheme="http://kingsamchen.github.io/tags/Linux/"/>
    
      <category term="clone" scheme="http://kingsamchen.github.io/tags/clone/"/>
    
      <category term="fork" scheme="http://kingsamchen.github.io/tags/fork/"/>
    
      <category term="多进程" scheme="http://kingsamchen.github.io/tags/%E5%A4%9A%E8%BF%9B%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 4 Apr 2022</title>
    <link href="http://kingsamchen.github.io/2022/05/02/weekly-2022-apr-4/"/>
    <id>http://kingsamchen.github.io/2022/05/02/weekly-2022-apr-4/</id>
    <published>2022-05-02T14:30:00.000Z</published>
    <updated>2022-05-03T13:47:17.833Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;亲自补上四月份最后一周的周报…&lt;/p&gt;
&lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot;
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 3 Apr 2022</title>
    <link href="http://kingsamchen.github.io/2022/04/24/weekly-2022-apr-3/"/>
    <id>http://kingsamchen.github.io/2022/04/24/weekly-2022-apr-3/</id>
    <published>2022-04-24T14:52:21.000Z</published>
    <updated>2022-04-25T16:17:32.837Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot;
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 2 Apr 2022</title>
    <link href="http://kingsamchen.github.io/2022/04/17/weekly-2022-apr-2/"/>
    <id>http://kingsamchen.github.io/2022/04/17/weekly-2022-apr-2/</id>
    <published>2022-04-17T14:52:21.000Z</published>
    <updated>2022-04-17T16:18:48.870Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot; title=&quot;Life&quot;&gt;&lt;/a&gt;Life&lt;/h2&gt;&lt;p&gt;#1&lt;/p&gt;
&lt;p&gt;上周因为用了三年多的 MIX2S 屏幕碎裂连带排线断了无法使用，下单买了 iPhone
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 1 Apr 2022</title>
    <link href="http://kingsamchen.github.io/2022/04/10/weekly-2022-apr-1/"/>
    <id>http://kingsamchen.github.io/2022/04/10/weekly-2022-apr-1/</id>
    <published>2022-04-10T14:52:21.000Z</published>
    <updated>2022-04-10T16:10:11.902Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot; title=&quot;Life&quot;&gt;&lt;/a&gt;Life&lt;/h2&gt;&lt;p&gt;本周掺杂了一个清明假期，节后三天工作日还算恰到好处，没有太明显的假期综合症。&lt;/p&gt;
&lt;p&gt;#1&lt;/p&gt;
&lt;p&gt;电影上看了
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 5 Mar 2022</title>
    <link href="http://kingsamchen.github.io/2022/03/29/weekly-2022-mar-5/"/>
    <id>http://kingsamchen.github.io/2022/03/29/weekly-2022-mar-5/</id>
    <published>2022-03-29T07:52:21.000Z</published>
    <updated>2022-04-05T06:16:33.659Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot; title=&quot;Life&quot;&gt;&lt;/a&gt;Life&lt;/h2&gt;&lt;p&gt;#1&lt;/p&gt;
&lt;p&gt;本周是清明假前的最后一周，要上6天班。周二的时候把去年遗留的一天年假用了，结果到了周三 3/30
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 4 Mar 2022</title>
    <link href="http://kingsamchen.github.io/2022/03/27/weekly-2022-mar-4/"/>
    <id>http://kingsamchen.github.io/2022/03/27/weekly-2022-mar-4/</id>
    <published>2022-03-27T13:24:19.000Z</published>
    <updated>2022-03-27T15:49:04.470Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot; title=&quot;Life&quot;&gt;&lt;/a&gt;Life&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;本周看了三部电影：&lt;em&gt;Cruella&lt;/em&gt;, &lt;em&gt;Sully&lt;/em&gt; and &lt;em&gt;The
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 3 Mar 2022</title>
    <link href="http://kingsamchen.github.io/2022/03/20/weekly-2022-mar-3/"/>
    <id>http://kingsamchen.github.io/2022/03/20/weekly-2022-mar-3/</id>
    <published>2022-03-20T12:57:09.000Z</published>
    <updated>2022-03-27T12:19:36.552Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;感觉这周时间过得特别快。&lt;/p&gt;
&lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot; title=&quot;Life&quot;&gt;&lt;/a&gt;Life&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;周六去医院打了最后一针狂犬疫苗，只要疫苗是真的有效，那么至少 1-2
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 2 Mar 2022</title>
    <link href="http://kingsamchen.github.io/2022/03/13/weekly-2022-mar-2/"/>
    <id>http://kingsamchen.github.io/2022/03/13/weekly-2022-mar-2/</id>
    <published>2022-03-13T15:22:57.000Z</published>
    <updated>2022-03-13T16:21:34.545Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot;
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 1 Mar 2022</title>
    <link href="http://kingsamchen.github.io/2022/03/06/weekly-2022-mar-1/"/>
    <id>http://kingsamchen.github.io/2022/03/06/weekly-2022-mar-1/</id>
    <published>2022-03-06T15:37:29.000Z</published>
    <updated>2022-03-06T16:43:35.425Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot; title=&quot;Life&quot;&gt;&lt;/a&gt;Life&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;这周沉迷 The Witcher
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 4 Feb 2022</title>
    <link href="http://kingsamchen.github.io/2022/02/24/weekly-2022-feb-4/"/>
    <id>http://kingsamchen.github.io/2022/02/24/weekly-2022-feb-4/</id>
    <published>2022-02-24T14:42:33.000Z</published>
    <updated>2022-02-27T15:11:20.609Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot; title=&quot;Life&quot;&gt;&lt;/a&gt;Life&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;刷完了 The Expanse
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 3 Feb 2022</title>
    <link href="http://kingsamchen.github.io/2022/02/20/weekly-2022-feb-3/"/>
    <id>http://kingsamchen.github.io/2022/02/20/weekly-2022-feb-3/</id>
    <published>2022-02-20T15:41:06.000Z</published>
    <updated>2022-02-20T16:21:39.645Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;节后第二周，生活和工作节奏都慢慢恢复到了之前的状态。&lt;/p&gt;
&lt;h2 id=&quot;Life&quot;&gt;&lt;a href=&quot;#Life&quot; class=&quot;headerlink&quot; title=&quot;Life&quot;&gt;&lt;/a&gt;Life&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;一口气刷了好几集 The Expanse
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>一周杂记 in Week 2 Feb 2022</title>
    <link href="http://kingsamchen.github.io/2022/02/13/weekly-2022-feb-2/"/>
    <id>http://kingsamchen.github.io/2022/02/13/weekly-2022-feb-2/</id>
    <published>2022-02-13T15:11:31.000Z</published>
    <updated>2022-02-13T16:08:15.491Z</updated>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;Blog 从上次更新到现在至少荒几个月。一直没更新主要是太懒了并且没有想到有什么需要特别写的。&lt;/p&gt;
&lt;p&gt;春节休假期间偶尔反思了一下觉得还是需要日常回顾自省一下，就算没有什么新的体会或者收获，当 journal 留着万一哪天得了阿兹海默症没准还能起到正向作用
        
      
    
    </summary>
    
      <category term="CODE-LIFE" scheme="http://kingsamchen.github.io/categories/CODE-LIFE/"/>
    
    
      <category term="杂记" scheme="http://kingsamchen.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>unique_ptr For Generic Scoped Handle</title>
    <link href="http://kingsamchen.github.io/2021/11/09/unique-ptr-for-generic-scoped-handle/"/>
    <id>http://kingsamchen.github.io/2021/11/09/unique-ptr-for-generic-scoped-handle/</id>
    <published>2021-11-09T14:43:31.000Z</published>
    <updated>2021-11-10T13:58:50.776Z</updated>
    
    <summary type="html">
    
      &lt;p&gt;之前在 &lt;a href=&quot;/2021/06/14/wrap-win32-handle-into-unique-ptr/&quot; title=&quot;用 unique_ptr 管理 Windows HANDLE&quot;&gt;用 unique_ptr 管理 Windows HANDLE&lt;/a&gt; 中介绍了如何基于 &lt;code&gt;std::unique_ptr&lt;/code&gt; 快速实现对 Windows HANDLE 的 RAII 化。&lt;/p&gt;
&lt;p&gt;但是如果我们也要对 &lt;code&gt;fd&lt;/code&gt; 或者 Windows 上的 &lt;code&gt;SOCKET&lt;/code&gt; 做类似的处理，重复实现 &lt;code&gt;xx_handle&lt;/code&gt; 和 &lt;code&gt;xx_handle_deleter&lt;/code&gt; 就显得过于琐碎。&lt;/p&gt;
&lt;p&gt;实际上我们可以利用模板参数注入，将共同点抽象出来，不同点实现成各自的 type traits，然后利用模板进行注入。&lt;/p&gt;
&lt;p&gt;这样一来，我们只需要简单实现每个 handle type 对应的基础属性，就可以直接复用核心实现。&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt; Traits&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;handle_ptr&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; handle_type = &lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt; Traits::handle_type;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    handle_ptr() &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// implicit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    handle_ptr(&lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::&lt;span class=&quot;keyword&quot;&gt;nullptr_t&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// implicit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    handle_ptr(handle_type handle) &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        : handle_(handle) &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ~handle_ptr() = &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;explicit&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;operator&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; Traits::is_valid(handle_);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// implicit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;operator&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;handle_type&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; handle_;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;friend&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;operator&lt;/span&gt;==(handle_ptr lhs, handle_ptr rhs) &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; lhs.handle_ == rhs.handle_;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;friend&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;operator&lt;/span&gt;!=(handle_ptr lhs, handle_ptr rhs) &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; !(lhs == rhs);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    handle_type handle_&amp;#123;Traits::null_handle&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt; Traits&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;handle_ptr_deleter&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; pointer = handle_ptr&amp;lt;Traits&amp;gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;operator&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(pointer ptr)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Traits::close(ptr);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;PS：不同于文章中的例子，基底类起名 &lt;code&gt;handle_ptr&lt;/code&gt; 更为确切；因为在 &lt;code&gt;unique_ptr&lt;/code&gt; 的内部会用来定义 &lt;code&gt;pointer&lt;/code&gt;；而几乎 unique_ptr 的语义行为都是围绕 &lt;code&gt;pointer&lt;/code&gt; 来完成的。&lt;/p&gt;
&lt;p&gt;有了上面这个基底之后，针对 fd-wrapper，我们只需要&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;fd_traits&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; handle_type = &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;is_valid&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(handle_type handle)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; handle != null_handle;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(handle_type handle)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ::close(handle);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;constexpr&lt;/span&gt; handle_type null_handle&amp;#123;&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; fd_deleter = handle_ptr_deleter&amp;lt;fd_traits&amp;gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; unique_fd = &lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::&lt;span class=&quot;built_in&quot;&gt;unique_ptr&lt;/span&gt;&amp;lt;fd_traits::handle_type, fd_deleter&amp;gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt; unique_fd &lt;span class=&quot;title&quot;&gt;wrap_unique_fd&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; raw_fd)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; unique_fd(raw_fd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这样一来，实现一个新的 unique handle wrapper，我们只需要确定四个东西：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;handle type 的实际类型&lt;/li&gt;
&lt;li&gt;null handle 的值，用来确定 default/zero initialized 之后 handle 状态&lt;/li&gt;
&lt;li&gt;实现 &lt;code&gt;is_valid()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;实现 &lt;code&gt;close()&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;剩下的就是常规的类型实例化。&lt;/p&gt;
    
    </summary>
    
      <category term="PROGRAMMING" scheme="http://kingsamchen.github.io/categories/PROGRAMMING/"/>
    
    
      <category term="cpp" scheme="http://kingsamchen.github.io/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title>(Ab)use system_error exception for System Calls</title>
    <link href="http://kingsamchen.github.io/2021/10/17/abuse-system-error-exception-for-system-calls/"/>
    <id>http://kingsamchen.github.io/2021/10/17/abuse-system-error-exception-for-system-calls/</id>
    <published>2021-10-17T13:31:34.000Z</published>
    <updated>2021-10-17T15:54:44.575Z</updated>
    
    <summary type="html">
    
      &lt;p&gt;C++ 11 引入了没有掀起什么波澜的 &lt;a href=&quot;https://en.cppreference.com/w/cpp/error/error_code&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;std::error_code&lt;/a&gt; 和几乎没收到什么关注的 &lt;a href=&quot;https://en.cppreference.com/w/cpp/error/system_error&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;std::system_error&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;偶然发现后者可以用来做针对 system calls 的异常汇报处理。&lt;/p&gt;
&lt;h3 id=&quot;0x0-A-Traditional-Approach&quot;&gt;&lt;a href=&quot;#0x0-A-Traditional-Approach&quot; class=&quot;headerlink&quot; title=&quot;0x0 A Traditional Approach&quot;&gt;&lt;/a&gt;0x0 A Traditional Approach&lt;/h3&gt;&lt;p&gt;Win32 API 调用失败后具体的错误码可以通过 &lt;code&gt;::GetLastError()&lt;/code&gt; 获取；Linux 上 syscall 的错误码则用更 C-ish 的 &lt;code&gt;errno&lt;/code&gt; 获取。&lt;/p&gt;
&lt;p&gt;如果希望通过异常来汇报这些系统调用失败，那么通常会从 &lt;code&gt;std::runtime_error&lt;/code&gt; 继承出一个 exception class，额外包含系统调用的错误码。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;win_last_error&lt;/span&gt; :&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::runtime_error &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; error_code_type = &lt;span class=&quot;keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;explicit&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;win_last_error&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* msg)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        : runtime_error(msg),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          error_code_(::GetLastError()) &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [[nodiscard]] &lt;span class=&quot;function&quot;&gt;error_code_type &lt;span class=&quot;title&quot;&gt;error_code&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;noexcept&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; error_code_;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    error_code_type error_code_;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面的代码稍加处理后可以同时支持 &lt;code&gt;GetLastError()&lt;/code&gt; 和 &lt;code&gt;errno&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;0x1-Using-std-system-error&quot;&gt;&lt;a href=&quot;#0x1-Using-std-system-error&quot; class=&quot;headerlink&quot; title=&quot;0x1 Using std::system_error&quot;&gt;&lt;/a&gt;0x1 Using std::system_error&lt;/h3&gt;&lt;p&gt;&lt;code&gt;std::system_error&lt;/code&gt; 恰好也是一个和 system facilities 有关的异常类，汇报系统相关的错误。&lt;/p&gt;
&lt;p&gt;除了传统的 &lt;code&gt;what()&lt;/code&gt; 之外它还提供一个 &lt;code&gt;code()&lt;/code&gt; 函数返回对应的 &lt;code&gt;error_code&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;而 &lt;code&gt;std::error_code&lt;/code&gt; 可以通过指定不同的 category 来指示其包含的错误码语义。&lt;/p&gt;
&lt;p&gt;所以实际上我们可以这么用：&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt; pipe &lt;span class=&quot;title&quot;&gt;make_pipe&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;if&lt;/span&gt; defined(OS_WIN)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (::CreatePipe(&amp;amp;fds[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], &amp;amp;fds[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], &amp;amp;sa, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::system_error(&lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::error_code(::GetLastError(), &lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::system_category()),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;string&quot;&gt;&quot;CreatePipe() failure&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (::pipe(fds) != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::system_error(&lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::error_code(errno, &lt;span class=&quot;built_in&quot;&gt;std&lt;/span&gt;::system_category()),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                &lt;span class=&quot;string&quot;&gt;&quot;pipe() failure&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意这里使用的 &lt;code&gt;system_category()&lt;/code&gt;，它代表 error code 是 reported by the system.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;有些地方可能会说这里要使用 &lt;code&gt;std::generic_category&lt;/code&gt;；但是通过试验发现使用 &lt;code&gt;std::generic_category&lt;/code&gt; 的 Windows last-error 和 &lt;code&gt;ec.message()&lt;/code&gt; 是对不上的；而 &lt;code&gt;std::system_category()&lt;/code&gt; 则是正确的。&lt;/p&gt;
&lt;p&gt;猜测 generic category 可能针对的是 CRT 的错误码&lt;/p&gt;
&lt;h3 id=&quot;0x2-Q-amp-A&quot;&gt;&lt;a href=&quot;#0x2-Q-amp-A&quot; class=&quot;headerlink&quot; title=&quot;0x2 Q&amp;amp;A&quot;&gt;&lt;/a&gt;0x2 Q&amp;amp;A&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Q: error_code 是啥？&lt;/strong&gt;&lt;br&gt;A: 这玩意儿实际上是 ASIO 的作者针对 async-handler 的错误处理设计的；boost 中 ASIO 和 filesystem 都大量支持了它。&lt;/p&gt;
&lt;p&gt;但是这玩意儿的设计门槛有点高，以至于不看完几篇文章压根没法理解这东西的设计意图；导致除了 ASIO 和 filesystem 及他们相关的衍生 lib 之外都没啥人去用它。&lt;/p&gt;
&lt;p&gt;而 filesystem C++ 17 才进入标准；而 ASIO/network TS 几天前也差不多宣告死亡了…&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Q: 为啥要用异常？&lt;/strong&gt;&lt;br&gt;A: Why not？我不排斥使用异常，而且我觉得我写的东西还没关键到需要考虑目前异常实现带来的性能问题。&lt;/p&gt;
&lt;p&gt;并且我觉得 exception 在充满大量业务逻辑的应用层是非常优秀的错误处理机制。&lt;/p&gt;
&lt;p&gt;即使提供了支持 chaining operations 的 sum type（例如这个 &lt;a href=&quot;https://github.com/TartanLlama/expected&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;expected&lt;/a&gt;），在业务层基本也需要人肉实现 failure cascading 层层上抛。&lt;/p&gt;
    
    </summary>
    
      <category term="PROGRAMMING" scheme="http://kingsamchen.github.io/categories/PROGRAMMING/"/>
    
    
      <category term="cpp" scheme="http://kingsamchen.github.io/tags/cpp/"/>
    
      <category term="exception" scheme="http://kingsamchen.github.io/tags/exception/"/>
    
  </entry>
  
</feed>

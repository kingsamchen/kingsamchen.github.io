---
title: 一周杂记 in Week 4 Apr 2022
categories: CODE-LIFE
date: 2022-05-02 22:30:00
tags: [杂记]
---

亲自补上四月份最后一周的周报...


## Life

\#1

因为劳动节调休安排的缘故，这周上了6天班，那是真的累。虽然最后一个工作日周五的时候感觉到大家明显都想放假了。

实话说我还是非常讨厌这种为了凑长假的调休安排的，因为长时间的透支工作并不是几天假期就能挽救的。

不过在这个劳动法毫无地位可言的地方除了发发牢骚之外还能怎么样呢。

估计四个月后我还要再喷一次这个问题。

\#2

虽然杭州这次疫情整体上被控制住了，但是地方官员应该是被吓尿了，以至于开始搞 48 小时常态化核酸的套路。

也就是说在杭州出入公共场所，比如去办公楼上班，去商场吃饭，学校上学等等，都需要提供最近48小时核酸阴性的证明。

我除了想说操你妈之外，剩下的就恭祝经济扛得住这么折腾吧。

疫情的另外一个明显的影响是物流的效率严重受到了拖慢。

JD 昆山货仓还没解禁，所以昆山货仓的订单基本处于每日都在延迟处理的状态；而其他仓库的虽然还可以发货，但是从往日的第二天派送变成了平均延迟3-4天派送。

淘宝上店家的发货也是受到了不同程度的影响。

只能说这波动态清零真的牛逼。

\#3

在包子亲自指挥亲自部署，毫不动摇地坚持动态清零下，在包子微管理给各行各业指明方向 or 锤爆下，经济增长放缓，进入衰退应该是避无可避了。

股市也是连日拉稀，反弹全靠一些政策消息刺激。

但是总不可能一周来一针肾上腺吧？

每天看着账上的收益和减损，只能望天叹口气。

\#4

这周看了老雷的 _The Last Duel_ 和短片 _完美女婿_

The Last Duel 不算是特别典型的那种影片，本质上是关于女性权益的影片。三段三个视角，通过一些叙事呈现的不同来呈现细节。

整体上是一部非常不错的影片，前提是你得看得下去；因为本片的娱乐性一般。

完美女婿是一个法国个人短片，有点类似 The Usual Suspect 的反转型电影。

整体合格，就是部分反转有点生硬且刻意。

## Work

\#1

工作上 zmail-search 大部分的功能性 tasks 都完成了， tests 也覆盖的差不多了，并且在一个测试环境部署新版后也正常工作。

后续的目标主要应该是性能的 benchmark 和 improvement 了。

另外本周围绕 zmail-search 做了一些清扫工作，主要是清理遗留代码在构建、打包中的残留等等。

\#2

周六，即假期第一天，的时候发现虚拟机里的 mint 的 x-server 环境好像被我搞坏了，`startx` 进入桌面后只能显示一小块区域，而且重装 vmware-tool 也无济于事。

并且在 GUI 中的几乎所有操作都会被卡住...

最后一狠心把一些重要的文件通过 scp 导出备份后把 vm 删了重新安装了 mint 20.3

因为之前没有做自动化 bootstrap 的脚本，所以重装后差不多花了半天到一天的时间才把整个开发环境配置完毕。

这其中又被代理给搞的头疼，毕竟家里不像公司，可以直连墙外。

不过这次我学乖了，一边弄，一边写 setup.sh，方便后面新环境的快速 bootstrap。毕竟 ubuntu 22.04 LTS 已经发布了，Mint 跟进发布新的大版本也是板上钉钉的事情。

https://gist.github.com/kingsamchen/3a9402efadd1bf9cadc8a16cbd16c687

脚本可以看出来为了让代理使用一个固定的 `ip:port` 我把 socat 做成了系统服务让 systemd 托管，并进行端口转发到外面宿主机的 clash 上。

这样就可以做到 mint 上应用使用的代理地址和真是代理地址的解耦，毕竟可能哪天宿主机的 ip 地址变了呢。

说起来这还是因为这个版本的 vmware 不知道有啥毛病，没法直接通过 NAT 网卡的网关地址来访问宿主机，所以只能使用这个一个招数。

\#3

这周零零碎碎的终于把 `base/subprocess` 给写完了。

后面可以基于这个实现 lumper 第一步的在隔离空间中运行指定程序了。

代码可以看这里：https://github.com/kingsamchen/Eureka/tree/master/Lumper/base

实现过程也踩了不少坑，后面有时间的话我会专门写篇文章总结一下 Linux 上创建子进程执行指定程序中的一些实践经验😊。

毕竟工业级的实现代码可不是简单的 fork + exec 就可以完事了。

---

这周就这样，下周见
